{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35873.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "156777525680885171663144425755157268361",
                "106378031876682170571191055036291009643",
                "58413506324096247487579689506044003972",
                "154900368293020945058566769769809627234",
                "2668081267676618135968254045345190090",
                "313815447870554290807653872275390754218",
                "207423381168775598504373197757797978370",
                "153362682879897601870291273267808149018",
                "262785538224484986377145613147963150267",
                "209665379613892476724865628084317389776",
                "163641613300011364415814503525018764446"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-35873-1149fbc6",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c27fa53b858b4ee6552a719aa599c250cf98a586",
            "target": {
              "file": "arch/riscv/kernel/signal.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "138696622853014913640993548197427111137",
              "length": 513.0
            },
            "id": "CVE-2024-35873-55545e2c",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@5b16d904e910183181b9d90efa957c787a8ac91b",
            "target": {
              "file": "arch/riscv/kernel/signal.c",
              "function": "__restore_v_state"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "138696622853014913640993548197427111137",
              "length": 513.0
            },
            "id": "CVE-2024-35873-daef330a",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c27fa53b858b4ee6552a719aa599c250cf98a586",
            "target": {
              "file": "arch/riscv/kernel/signal.c",
              "function": "__restore_v_state"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "156777525680885171663144425755157268361",
                "106378031876682170571191055036291009643",
                "58413506324096247487579689506044003972",
                "154900368293020945058566769769809627234",
                "2668081267676618135968254045345190090",
                "313815447870554290807653872275390754218",
                "207423381168775598504373197757797978370",
                "153362682879897601870291273267808149018",
                "262785538224484986377145613147963150267",
                "209665379613892476724865628084317389776",
                "163641613300011364415814503525018764446"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-35873-e5ccd8a8",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@5b16d904e910183181b9d90efa957c787a8ac91b",
            "target": {
              "file": "arch/riscv/kernel/signal.c"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "c2a658d419246108c9bf065ec347355de5ba8a05"
            },
            {
              "fixed": "5b16d904e910183181b9d90efa957c787a8ac91b"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "c2a658d419246108c9bf065ec347355de5ba8a05"
            },
            {
              "fixed": "c27fa53b858b4ee6552a719aa599c250cf98a586"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v6.7",
        "v6.7-rc2",
        "v6.7-rc3",
        "v6.7-rc4",
        "v6.7-rc5",
        "v6.7-rc6",
        "v6.7-rc7",
        "v6.7-rc8",
        "v6.8",
        "v6.8-rc1",
        "v6.8-rc2",
        "v6.8-rc3",
        "v6.8-rc4",
        "v6.8-rc5",
        "v6.8-rc6",
        "v6.8-rc7",
        "v6.8.1",
        "v6.8.2",
        "v6.8.3",
        "v6.8.4",
        "v6.9-rc1"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35873.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "6.8.0"
            },
            {
              "fixed": "6.8.5"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nriscv: Fix vector state restore in rt_sigreturn()\n\nThe RISC-V Vector specification states in \"Appendix D: Calling\nConvention for Vector State\" [1] that \"Executing a system call causes\nall caller-saved vector registers (v0-v31, vl, vtype) and vstart to\nbecome unspecified.\". In the RISC-V kernel this is called \"discarding\nthe vstate\".\n\nReturning from a signal handler via the rt_sigreturn() syscall, vector\ndiscard is also performed. However, this is not an issue since the\nvector state should be restored from the sigcontext, and therefore not\ncare about the vector discard.\n\nThe \"live state\" is the actual vector register in the running context,\nand the \"vstate\" is the vector state of the task. A dirty live state,\nmeans that the vstate and live state are not in synch.\n\nWhen vectorized user_from_copy() was introduced, an bug sneaked in at\nthe restoration code, related to the discard of the live state.\n\nAn example when this go wrong:\n\n  1. A userland application is executing vector code\n  2. The application receives a signal, and the signal handler is\n     entered.\n  3. The application returns from the signal handler, using the\n     rt_sigreturn() syscall.\n  4. The live vector state is discarded upon entering the\n     rt_sigreturn(), and the live state is marked as \"dirty\", indicating\n     that the live state need to be synchronized with the current\n     vstate.\n  5. rt_sigreturn() restores the vstate, except the Vector registers,\n     from the sigcontext\n  6. rt_sigreturn() restores the Vector registers, from the sigcontext,\n     and now the vectorized user_from_copy() is used. The dirty live\n     state from the discard is saved to the vstate, making the vstate\n     corrupt.\n  7. rt_sigreturn() returns to the application, which crashes due to\n     corrupted vstate.\n\nNote that the vectorized user_from_copy() is invoked depending on the\nvalue of CONFIG_RISCV_ISA_V_UCOPY_THRESHOLD. Default is 768, which\nmeans that vlen has to be larger than 128b for this bug to trigger.\n\nThe fix is simply to mark the live state as non-dirty/clean prior\nperforming the vstate restore.",
  "id": "CVE-2024-35873",
  "modified": "2025-10-15T10:24:28.530824Z",
  "published": "2024-05-19T08:34:30Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/5b16d904e910183181b9d90efa957c787a8ac91b"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/c27fa53b858b4ee6552a719aa599c250cf98a586"
    }
  ],
  "schema_version": "1.7.3",
  "summary": "riscv: Fix vector state restore in rt_sigreturn()"
}