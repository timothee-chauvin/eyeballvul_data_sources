{"schema_version":"1.7.3","id":"CVE-2022-49636","published":"2025-02-26T02:23:46Z","modified":"2025-10-21T11:23:54.298715Z","summary":"vlan: fix memory leak in vlan_newlink()","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nvlan: fix memory leak in vlan_newlink()\n\nBlamed commit added back a bug I fixed in commit 9bbd917e0bec\n(\"vlan: fix memory leak in vlan_dev_set_egress_priority\")\n\nIf a memory allocation fails in vlan_changelink() after other allocations\nsucceeded, we need to call vlan_dev_free_egress_priority()\nto free all allocated memory because after a failed ->newlink()\nwe do not call any methods like ndo_uninit() or dev->priv_destructor().\n\nIn following example, if the allocation for last element 2000:2001 fails,\nwe need to free eight prior allocations:\n\nip link add link dummy0 dummy0.100 type vlan id 100 \\\n\tegress-qos-map 1:2 2:3 3:4 4:5 5:6 6:7 7:8 8:9 2000:2001\n\nsyzbot report was:\n\nBUG: memory leak\nunreferenced object 0xffff888117bd1060 (size 32):\ncomm \"syz-executor408\", pid 3759, jiffies 4294956555 (age 34.090s)\nhex dump (first 32 bytes):\n09 00 00 00 00 a0 00 00 00 00 00 00 00 00 00 00 ................\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\nbacktrace:\n[<ffffffff83fc60ad>] kmalloc include/linux/slab.h:600 [inline]\n[<ffffffff83fc60ad>] vlan_dev_set_egress_priority+0xed/0x170 net/8021q/vlan_dev.c:193\n[<ffffffff83fc6628>] vlan_changelink+0x178/0x1d0 net/8021q/vlan_netlink.c:128\n[<ffffffff83fc67c8>] vlan_newlink+0x148/0x260 net/8021q/vlan_netlink.c:185\n[<ffffffff838b1278>] rtnl_newlink_create net/core/rtnetlink.c:3363 [inline]\n[<ffffffff838b1278>] __rtnl_newlink+0xa58/0xdc0 net/core/rtnetlink.c:3580\n[<ffffffff838b1629>] rtnl_newlink+0x49/0x70 net/core/rtnetlink.c:3593\n[<ffffffff838ac66c>] rtnetlink_rcv_msg+0x21c/0x5c0 net/core/rtnetlink.c:6089\n[<ffffffff839f9c37>] netlink_rcv_skb+0x87/0x1d0 net/netlink/af_netlink.c:2501\n[<ffffffff839f8da7>] netlink_unicast_kernel net/netlink/af_netlink.c:1319 [inline]\n[<ffffffff839f8da7>] netlink_unicast+0x397/0x4c0 net/netlink/af_netlink.c:1345\n[<ffffffff839f9266>] netlink_sendmsg+0x396/0x710 net/netlink/af_netlink.c:1921\n[<ffffffff8384dbf6>] sock_sendmsg_nosec net/socket.c:714 [inline]\n[<ffffffff8384dbf6>] sock_sendmsg+0x56/0x80 net/socket.c:734\n[<ffffffff8384e15c>] ____sys_sendmsg+0x36c/0x390 net/socket.c:2488\n[<ffffffff838523cb>] ___sys_sendmsg+0x8b/0xd0 net/socket.c:2542\n[<ffffffff838525b8>] __sys_sendmsg net/socket.c:2571 [inline]\n[<ffffffff838525b8>] __do_sys_sendmsg net/socket.c:2580 [inline]\n[<ffffffff838525b8>] __se_sys_sendmsg net/socket.c:2578 [inline]\n[<ffffffff838525b8>] __x64_sys_sendmsg+0x78/0xf0 net/socket.c:2578\n[<ffffffff845ad8d5>] do_syscall_x64 arch/x86/entry/common.c:50 [inline]\n[<ffffffff845ad8d5>] do_syscall_64+0x35/0xb0 arch/x86/entry/common.c:80\n[<ffffffff8460006a>] entry_SYSCALL_64_after_hwframe+0x46/0xb0","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"b195d229de401377f70c04e0dff93b342464ec8e"},{"fixed":"549de58dba4bf1b2adc72e9948b9c76fa88be9d2"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"62d7ad2c191122119c66361ba6d9f04974b51afe"},{"fixed":"df27729a4fe0002dfd80c96fe1c142829c672728"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"842801181864690fdcde73b017cce4c1353a7083"},{"fixed":"f5dc10b910bdac523e5947336445a77066c51bf9"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"37aa50c539bcbcc01767e515bd170787fcfc0f33"},{"fixed":"4c43069bb1097dd6cc1cf0f7c43a36d1f7b3910b"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"37aa50c539bcbcc01767e515bd170787fcfc0f33"},{"fixed":"72a0b329114b1caa8e69dfa7cdad1dd3c69b8602"}]}],"versions":["v5.10.235","v5.15.142","v5.15.143","v5.15.144","v5.15.145","v5.15.146","v5.15.147","v5.15.148","v5.15.149","v5.15.150","v5.15.151","v5.15.152","v5.15.153","v5.15.154","v5.15.155","v5.15.156","v5.15.157","v5.15.158","v5.15.159","v5.15.160","v5.15.161","v5.15.162","v5.15.163","v5.15.164","v5.15.165","v5.15.166","v5.15.167","v5.15.168","v5.15.169","v5.15.170","v5.15.171","v5.15.172","v5.15.173","v5.15.174","v5.15.175","v5.15.176","v5.15.177","v5.15.178","v5.15.179","v5.17","v5.17-rc3","v5.17-rc4","v5.17-rc5","v5.17-rc6","v5.17-rc7","v5.17-rc8","v5.18","v5.18-rc1","v5.18-rc2","v5.18-rc3","v5.18-rc4","v5.18-rc5","v5.18-rc6","v5.18-rc7","v5.18.1","v5.18.10","v5.18.11","v5.18.12","v5.18.2","v5.18.3","v5.18.4","v5.18.5","v5.18.6","v5.18.7","v5.18.8","v5.18.9","v5.19-rc1","v5.19-rc2","v5.19-rc3","v5.19-rc4","v5.19-rc5","v5.4.291"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49636.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"93897962379425989360089693779848667440","length":1294},"id":"CVE-2022-49636-00d880bd","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f5dc10b910bdac523e5947336445a77066c51bf9","target":{"file":"net/8021q/vlan_netlink.c","function":"vlan_newlink"}},{"deprecated":false,"digest":{"function_hash":"93897962379425989360089693779848667440","length":1294},"id":"CVE-2022-49636-06ec8a03","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@df27729a4fe0002dfd80c96fe1c142829c672728","target":{"file":"net/8021q/vlan_netlink.c","function":"vlan_newlink"}},{"deprecated":false,"digest":{"function_hash":"93897962379425989360089693779848667440","length":1294},"id":"CVE-2022-49636-155408d4","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@549de58dba4bf1b2adc72e9948b9c76fa88be9d2","target":{"file":"net/8021q/vlan_netlink.c","function":"vlan_newlink"}},{"deprecated":false,"digest":{"line_hashes":["193464501514445085159482663647520163449","21207887940075083336442186447923885520","251322196898798725806890659747144736368","197296028016379736903603127533816767531","147744152573252512416561073312908985790","157552167248836071024448692672199040675","21615195174898310135962723609528135056"],"threshold":0.9},"id":"CVE-2022-49636-255670e9","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@df27729a4fe0002dfd80c96fe1c142829c672728","target":{"file":"net/8021q/vlan_netlink.c"}},{"deprecated":false,"digest":{"function_hash":"93897962379425989360089693779848667440","length":1294},"id":"CVE-2022-49636-2f769e89","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4c43069bb1097dd6cc1cf0f7c43a36d1f7b3910b","target":{"file":"net/8021q/vlan_netlink.c","function":"vlan_newlink"}},{"deprecated":false,"digest":{"line_hashes":["193464501514445085159482663647520163449","21207887940075083336442186447923885520","251322196898798725806890659747144736368","197296028016379736903603127533816767531","147744152573252512416561073312908985790","157552167248836071024448692672199040675","21615195174898310135962723609528135056"],"threshold":0.9},"id":"CVE-2022-49636-3cab95b7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@72a0b329114b1caa8e69dfa7cdad1dd3c69b8602","target":{"file":"net/8021q/vlan_netlink.c"}},{"deprecated":false,"digest":{"function_hash":"93897962379425989360089693779848667440","length":1294},"id":"CVE-2022-49636-7836a307","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@72a0b329114b1caa8e69dfa7cdad1dd3c69b8602","target":{"file":"net/8021q/vlan_netlink.c","function":"vlan_newlink"}},{"deprecated":false,"digest":{"line_hashes":["193464501514445085159482663647520163449","21207887940075083336442186447923885520","251322196898798725806890659747144736368","197296028016379736903603127533816767531","147744152573252512416561073312908985790","157552167248836071024448692672199040675","21615195174898310135962723609528135056"],"threshold":0.9},"id":"CVE-2022-49636-bccdef85","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4c43069bb1097dd6cc1cf0f7c43a36d1f7b3910b","target":{"file":"net/8021q/vlan_netlink.c"}},{"deprecated":false,"digest":{"line_hashes":["193464501514445085159482663647520163449","21207887940075083336442186447923885520","251322196898798725806890659747144736368","197296028016379736903603127533816767531","147744152573252512416561073312908985790","157552167248836071024448692672199040675","21615195174898310135962723609528135056"],"threshold":0.9},"id":"CVE-2022-49636-c0f558c4","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@549de58dba4bf1b2adc72e9948b9c76fa88be9d2","target":{"file":"net/8021q/vlan_netlink.c"}},{"deprecated":false,"digest":{"line_hashes":["193464501514445085159482663647520163449","21207887940075083336442186447923885520","251322196898798725806890659747144736368","197296028016379736903603127533816767531","147744152573252512416561073312908985790","157552167248836071024448692672199040675","21615195174898310135962723609528135056"],"threshold":0.9},"id":"CVE-2022-49636-ec942b89","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f5dc10b910bdac523e5947336445a77066c51bf9","target":{"file":"net/8021q/vlan_netlink.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"0"},{"fixed":"5.4.292"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.5.0"},{"fixed":"5.10.236"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.11.0"},{"fixed":"5.15.180"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.16.0"},{"fixed":"5.18.13"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49636.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/4c43069bb1097dd6cc1cf0f7c43a36d1f7b3910b"},{"type":"WEB","url":"https://git.kernel.org/stable/c/549de58dba4bf1b2adc72e9948b9c76fa88be9d2"},{"type":"WEB","url":"https://git.kernel.org/stable/c/72a0b329114b1caa8e69dfa7cdad1dd3c69b8602"},{"type":"WEB","url":"https://git.kernel.org/stable/c/df27729a4fe0002dfd80c96fe1c142829c672728"},{"type":"WEB","url":"https://git.kernel.org/stable/c/f5dc10b910bdac523e5947336445a77066c51bf9"}]}