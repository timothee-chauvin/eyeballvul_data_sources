{"schema_version":"1.7.3","id":"CVE-2022-48848","published":"2024-07-16T12:25:16.457Z","modified":"2025-11-19T12:30:29.644601Z","summary":"tracing/osnoise: Do not unregister events twice","details":"In the Linux kernel, the following vulnerability has been resolved:\n\ntracing/osnoise: Do not unregister events twice\n\nNicolas reported that using:\n\n # trace-cmd record -e all -M 10 -p osnoise --poll\n\nResulted in the following kernel warning:\n\n ------------[ cut here ]------------\n WARNING: CPU: 0 PID: 1217 at kernel/tracepoint.c:404 tracepoint_probe_unregister+0x280/0x370\n [...]\n CPU: 0 PID: 1217 Comm: trace-cmd Not tainted 5.17.0-rc6-next-20220307-nico+ #19\n RIP: 0010:tracepoint_probe_unregister+0x280/0x370\n [...]\n CR2: 00007ff919b29497 CR3: 0000000109da4005 CR4: 0000000000170ef0\n Call Trace:\n  <TASK>\n  osnoise_workload_stop+0x36/0x90\n  tracing_set_tracer+0x108/0x260\n  tracing_set_trace_write+0x94/0xd0\n  ? __check_object_size.part.0+0x10a/0x150\n  ? selinux_file_permission+0x104/0x150\n  vfs_write+0xb5/0x290\n  ksys_write+0x5f/0xe0\n  do_syscall_64+0x3b/0x90\n  entry_SYSCALL_64_after_hwframe+0x44/0xae\n RIP: 0033:0x7ff919a18127\n [...]\n ---[ end trace 0000000000000000 ]---\n\nThe warning complains about an attempt to unregister an\nunregistered tracepoint.\n\nThis happens on trace-cmd because it first stops tracing, and\nthen switches the tracer to nop. Which is equivalent to:\n\n  # cd /sys/kernel/tracing/\n  # echo osnoise > current_tracer\n  # echo 0 > tracing_on\n  # echo nop > current_tracer\n\nThe osnoise tracer stops the workload when no trace instance\nis actually collecting data. This can be caused both by\ndisabling tracing or disabling the tracer itself.\n\nTo avoid unregistering events twice, use the existing\ntrace_osnoise_callback_enabled variable to check if the events\n(and the workload) are actually active before trying to\ndeactivate them.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"2fac8d6486d5c34e2ec7028580142b8209da3f92"},{"fixed":"4e10787d18379d9b296290c2288097feddef16d4"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"2fac8d6486d5c34e2ec7028580142b8209da3f92"},{"fixed":"f0cfe17bcc1dd2f0872966b554a148e888833ee9"}]}],"versions":["v5.15","v5.15-rc4","v5.15-rc5","v5.15-rc6","v5.15-rc7","v5.16","v5.16-rc1","v5.16-rc2","v5.16-rc3","v5.16-rc4","v5.16-rc5","v5.16-rc6","v5.16-rc7","v5.16-rc8","v5.16.1","v5.16.10","v5.16.11","v5.16.12","v5.16.13","v5.16.14","v5.16.2","v5.16.3","v5.16.4","v5.16.5","v5.16.6","v5.16.7","v5.16.8","v5.16.9","v5.17-rc1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-48848.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"320796812023822703507980352594846407826","length":150},"id":"CVE-2022-48848-0dacc93a","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4e10787d18379d9b296290c2288097feddef16d4","target":{"file":"kernel/trace/trace_osnoise.c","function":"osnoise_workload_stop"}},{"deprecated":false,"digest":{"function_hash":"320796812023822703507980352594846407826","length":150},"id":"CVE-2022-48848-68ef08f0","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f0cfe17bcc1dd2f0872966b554a148e888833ee9","target":{"file":"kernel/trace/trace_osnoise.c","function":"osnoise_workload_stop"}},{"deprecated":false,"digest":{"line_hashes":["286648555976291229237557167793986326485","305517417356316711320183718234674392467","116239692970834758897249214618120433341"],"threshold":0.9},"id":"CVE-2022-48848-7f37fc6b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f0cfe17bcc1dd2f0872966b554a148e888833ee9","target":{"file":"kernel/trace/trace_osnoise.c"}},{"deprecated":false,"digest":{"line_hashes":["286648555976291229237557167793986326485","305517417356316711320183718234674392467","116239692970834758897249214618120433341"],"threshold":0.9},"id":"CVE-2022-48848-c36e4931","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4e10787d18379d9b296290c2288097feddef16d4","target":{"file":"kernel/trace/trace_osnoise.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"5.16.0"},{"fixed":"5.16.15"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-48848.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/4e10787d18379d9b296290c2288097feddef16d4"},{"type":"WEB","url":"https://git.kernel.org/stable/c/f0cfe17bcc1dd2f0872966b554a148e888833ee9"}]}