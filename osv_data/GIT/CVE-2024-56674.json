{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-56674.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "46634925974281941361410766848842894333",
                "217088932889927165596421795145495916440",
                "251031171356621246558628305501011145103",
                "216072914826790470781903136814469095268",
                "13158575165267888181094402302532466706",
                "116518982252135226887243684075271210522",
                "94503494092716835227376944859580156994",
                "245017399515876550259051792706578529722",
                "146789761232761453099522452574396428051",
                "173786282837580415067828959772535336062"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-56674-14a5ddff",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@b4294d4ac61fbb382811a1d64eaf81f446ce2af4",
            "target": {
              "file": "drivers/net/virtio_net.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "46634925974281941361410766848842894333",
                "217088932889927165596421795145495916440",
                "251031171356621246558628305501011145103",
                "216072914826790470781903136814469095268",
                "13158575165267888181094402302532466706",
                "116518982252135226887243684075271210522",
                "94503494092716835227376944859580156994",
                "245017399515876550259051792706578529722",
                "146789761232761453099522452574396428051",
                "173786282837580415067828959772535336062"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-56674-5fa985ff",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3ddccbefebdbe0c4c72a248676e4d39ac66a8e26",
            "target": {
              "file": "drivers/net/virtio_net.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "271272615664186268333869935728804019293",
              "length": 669.0
            },
            "id": "CVE-2024-56674-8a0d0ab0",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3ddccbefebdbe0c4c72a248676e4d39ac66a8e26",
            "target": {
              "file": "drivers/net/virtio_net.c",
              "function": "virtnet_enable_queue_pair"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "115227088629674226954252114530214270115",
              "length": 156.0
            },
            "id": "CVE-2024-56674-8faadaf5",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3ddccbefebdbe0c4c72a248676e4d39ac66a8e26",
            "target": {
              "file": "drivers/net/virtio_net.c",
              "function": "remove_vq_common"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "271272615664186268333869935728804019293",
              "length": 669.0
            },
            "id": "CVE-2024-56674-a967a47f",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@b4294d4ac61fbb382811a1d64eaf81f446ce2af4",
            "target": {
              "file": "drivers/net/virtio_net.c",
              "function": "virtnet_enable_queue_pair"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "115227088629674226954252114530214270115",
              "length": 156.0
            },
            "id": "CVE-2024-56674-febe0ea7",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@b4294d4ac61fbb382811a1d64eaf81f446ce2af4",
            "target": {
              "file": "drivers/net/virtio_net.c",
              "function": "remove_vq_common"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "c8bd1f7f3e61fc6c562c806045f3ccd2cc819c01"
            },
            {
              "fixed": "b4294d4ac61fbb382811a1d64eaf81f446ce2af4"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "c8bd1f7f3e61fc6c562c806045f3ccd2cc819c01"
            },
            {
              "fixed": "3ddccbefebdbe0c4c72a248676e4d39ac66a8e26"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v6.10",
        "v6.10-rc4",
        "v6.10-rc5",
        "v6.10-rc6",
        "v6.10-rc7",
        "v6.11",
        "v6.11-rc1",
        "v6.11-rc2",
        "v6.11-rc3",
        "v6.11-rc4",
        "v6.11-rc5",
        "v6.11-rc6",
        "v6.11-rc7",
        "v6.12",
        "v6.12-rc1",
        "v6.12-rc2",
        "v6.12-rc3",
        "v6.12-rc4",
        "v6.12-rc5",
        "v6.12-rc6",
        "v6.12-rc7",
        "v6.12.1",
        "v6.12.2",
        "v6.12.3",
        "v6.12.4",
        "v6.12.5",
        "v6.13-rc1"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-56674.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "6.11.0"
            },
            {
              "fixed": "6.12.6"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nvirtio_net: correct netdev_tx_reset_queue() invocation point\n\nWhen virtnet_close is followed by virtnet_open, some TX completions can\npossibly remain unconsumed, until they are finally processed during the\nfirst NAPI poll after the netdev_tx_reset_queue(), resulting in a crash\n[1]. Commit b96ed2c97c79 (\"virtio_net: move netdev_tx_reset_queue() call\nbefore RX napi enable\") was not sufficient to eliminate all BQL crash\ncases for virtio-net.\n\nThis issue can be reproduced with the latest net-next master by running:\n`while :; do ip l set DEV down; ip l set DEV up; done` under heavy network\nTX load from inside the machine.\n\nnetdev_tx_reset_queue() can actually be dropped from virtnet_open path;\nthe device is not stopped in any case. For BQL core part, it's just like\ntraffic nearly ceases to exist for some period. For stall detector added\nto BQL, even if virtnet_close could somehow lead to some TX completions\ndelayed for long, followed by virtnet_open, we can just take it as stall\nas mentioned in commit 6025b9135f7a (\"net: dqs: add NIC stall detector\nbased on BQL\"). Note also that users can still reset stall_max via sysfs.\n\nSo, drop netdev_tx_reset_queue() from virtnet_enable_queue_pair(). This\neliminates the BQL crashes. As a result, netdev_tx_reset_queue() is now\nexplicitly required in freeze/restore path. This patch adds it to\nimmediately after free_unused_bufs(), following the rule of thumb:\nnetdev_tx_reset_queue() should follow any SKB freeing not followed by\nnetdev_tx_completed_queue(). This seems the most consistent and\nstreamlined approach, and now netdev_tx_reset_queue() runs whenever\nfree_unused_bufs() is done.\n\n[1]:\n------------[ cut here ]------------\nkernel BUG at lib/dynamic_queue_limits.c:99!\nOops: invalid opcode: 0000 [#1] PREEMPT SMP NOPTI\nCPU: 7 UID: 0 PID: 1598 Comm: ip Tainted: G    N 6.12.0net-next_main+ #2\nTainted: [N]=TEST\nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), \\\nBIOS rel-1.16.3-0-ga6ed6b701f0a-prebuilt.qemu.org 04/01/2014\nRIP: 0010:dql_completed+0x26b/0x290\nCode: b7 c2 49 89 e9 44 89 da 89 c6 4c 89 d7 e8 ed 17 47 00 58 65 ff 0d\n4d 27 90 7e 0f 85 fd fe ff ff e8 ea 53 8d ff e9 f3 fe ff ff <0f> 0b 01\nd2 44 89 d1 29 d1 ba 00 00 00 00 0f 48 ca e9 28 ff ff ff\nRSP: 0018:ffffc900002b0d08 EFLAGS: 00010297\nRAX: 0000000000000000 RBX: ffff888102398c80 RCX: 0000000080190009\nRDX: 0000000000000000 RSI: 000000000000006a RDI: 0000000000000000\nRBP: ffff888102398c00 R08: 0000000000000000 R09: 0000000000000000\nR10: 00000000000000ca R11: 0000000000015681 R12: 0000000000000001\nR13: ffffc900002b0d68 R14: ffff88811115e000 R15: ffff8881107aca40\nFS:  00007f41ded69500(0000) GS:ffff888667dc0000(0000)\nknlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000556ccc2dc1a0 CR3: 0000000104fd8003 CR4: 0000000000772ef0\nPKRU: 55555554\nCall Trace:\n <IRQ>\n ? die+0x32/0x80\n ? do_trap+0xd9/0x100\n ? dql_completed+0x26b/0x290\n ? dql_completed+0x26b/0x290\n ? do_error_trap+0x6d/0xb0\n ? dql_completed+0x26b/0x290\n ? exc_invalid_op+0x4c/0x60\n ? dql_completed+0x26b/0x290\n ? asm_exc_invalid_op+0x16/0x20\n ? dql_completed+0x26b/0x290\n __free_old_xmit+0xff/0x170 [virtio_net]\n free_old_xmit+0x54/0xc0 [virtio_net]\n virtnet_poll+0xf4/0xe30 [virtio_net]\n ? __update_load_avg_cfs_rq+0x264/0x2d0\n ? update_curr+0x35/0x260\n ? reweight_entity+0x1be/0x260\n __napi_poll.constprop.0+0x28/0x1c0\n net_rx_action+0x329/0x420\n ? enqueue_hrtimer+0x35/0x90\n ? trace_hardirqs_on+0x1d/0x80\n ? kvm_sched_clock_read+0xd/0x20\n ? sched_clock+0xc/0x30\n ? kvm_sched_clock_read+0xd/0x20\n ? sched_clock+0xc/0x30\n ? sched_clock_cpu+0xd/0x1a0\n handle_softirqs+0x138/0x3e0\n do_softirq.part.0+0x89/0xc0\n </IRQ>\n <TASK>\n __local_bh_enable_ip+0xa7/0xb0\n virtnet_open+0xc8/0x310 [virtio_net]\n __dev_open+0xfa/0x1b0\n __dev_change_flags+0x1de/0x250\n dev_change_flags+0x22/0x60\n do_setlink.isra.0+0x2df/0x10b0\n ? rtnetlink_rcv_msg+0x34f/0x3f0\n ? netlink_rcv_skb+0x54/0x100\n ? netlink_unicas\n---truncated---",
  "id": "CVE-2024-56674",
  "modified": "2025-10-22T06:36:58.038504Z",
  "published": "2024-12-27T15:06:35Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/3ddccbefebdbe0c4c72a248676e4d39ac66a8e26"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/b4294d4ac61fbb382811a1d64eaf81f446ce2af4"
    }
  ],
  "related": [
    "USN-7276-1",
    "USN-7277-1"
  ],
  "schema_version": "1.7.3",
  "severity": [
    {
      "score": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
      "type": "CVSS_V3"
    }
  ],
  "summary": "virtio_net: correct netdev_tx_reset_queue() invocation point"
}