{"schema_version":"1.7.3","id":"CVE-2025-22123","published":"2025-04-16T14:13:07Z","modified":"2025-10-22T10:26:52.675722Z","summary":"f2fs: fix to avoid accessing uninitialized curseg","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nf2fs: fix to avoid accessing uninitialized curseg\n\nsyzbot reports a f2fs bug as below:\n\nF2FS-fs (loop3): Stopped filesystem due to reason: 7\nkworker/u8:7: attempt to access beyond end of device\nBUG: unable to handle page fault for address: ffffed1604ea3dfa\nRIP: 0010:get_ckpt_valid_blocks fs/f2fs/segment.h:361 [inline]\nRIP: 0010:has_curseg_enough_space fs/f2fs/segment.h:570 [inline]\nRIP: 0010:__get_secs_required fs/f2fs/segment.h:620 [inline]\nRIP: 0010:has_not_enough_free_secs fs/f2fs/segment.h:633 [inline]\nRIP: 0010:has_enough_free_secs+0x575/0x1660 fs/f2fs/segment.h:649\n <TASK>\n f2fs_is_checkpoint_ready fs/f2fs/segment.h:671 [inline]\n f2fs_write_inode+0x425/0x540 fs/f2fs/inode.c:791\n write_inode fs/fs-writeback.c:1525 [inline]\n __writeback_single_inode+0x708/0x10d0 fs/fs-writeback.c:1745\n writeback_sb_inodes+0x820/0x1360 fs/fs-writeback.c:1976\n wb_writeback+0x413/0xb80 fs/fs-writeback.c:2156\n wb_do_writeback fs/fs-writeback.c:2303 [inline]\n wb_workfn+0x410/0x1080 fs/fs-writeback.c:2343\n process_one_work kernel/workqueue.c:3236 [inline]\n process_scheduled_works+0xa66/0x1840 kernel/workqueue.c:3317\n worker_thread+0x870/0xd30 kernel/workqueue.c:3398\n kthread+0x7a9/0x920 kernel/kthread.c:464\n ret_from_fork+0x4b/0x80 arch/x86/kernel/process.c:148\n ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S:244\n\nCommit 8b10d3653735 (\"f2fs: introduce FAULT_NO_SEGMENT\") allows to trigger\nno free segment fault in allocator, then it will update curseg->segno to\nNULL_SEGNO, though, CP_ERROR_FLAG has been set, f2fs_write_inode() missed\nto check the flag, and access invalid curseg->segno directly in below call\npath, then resulting in panic:\n\n- f2fs_write_inode\n - f2fs_is_checkpoint_ready\n  - has_enough_free_secs\n   - has_not_enough_free_secs\n    - __get_secs_required\n     - has_curseg_enough_space\n      - get_ckpt_valid_blocks\n      : access invalid curseg->segno\n\nTo avoid this issue, let's:\n- check CP_ERROR_FLAG flag in prior to f2fs_is_checkpoint_ready() in\nf2fs_write_inode().\n- in has_curseg_enough_space(), save curseg->segno into a temp variable,\nand verify its validation before use.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"8b10d3653735e117bc1954ade80d75ad7b46b801"},{"fixed":"bf49527089ec1ba894c6e587affabbfb2329f52e"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"8b10d3653735e117bc1954ade80d75ad7b46b801"},{"fixed":"7f90e5d423cd2d4c74b2abb527872f335108637f"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"8b10d3653735e117bc1954ade80d75ad7b46b801"},{"fixed":"986c50f6bca109c6cf362b4e2babcb85aba958f6"}]}],"versions":["v6.10","v6.10-rc1","v6.10-rc2","v6.10-rc3","v6.10-rc4","v6.10-rc5","v6.10-rc6","v6.10-rc7","v6.11","v6.11-rc1","v6.11-rc2","v6.11-rc3","v6.11-rc4","v6.11-rc5","v6.11-rc6","v6.11-rc7","v6.12","v6.12-rc1","v6.12-rc2","v6.12-rc3","v6.12-rc4","v6.12-rc5","v6.12-rc6","v6.12-rc7","v6.12.1","v6.12.10","v6.12.11","v6.12.12","v6.12.13","v6.12.14","v6.12.15","v6.12.16","v6.12.17","v6.12.18","v6.12.19","v6.12.2","v6.12.20","v6.12.21","v6.12.22","v6.12.23","v6.12.24","v6.12.25","v6.12.26","v6.12.27","v6.12.28","v6.12.29","v6.12.3","v6.12.30","v6.12.31","v6.12.32","v6.12.4","v6.12.5","v6.12.6","v6.12.7","v6.12.8","v6.12.9","v6.13","v6.13-rc1","v6.13-rc2","v6.13-rc3","v6.13-rc4","v6.13-rc5","v6.13-rc6","v6.13-rc7","v6.14","v6.14-rc1","v6.14-rc2","v6.14-rc3","v6.14-rc4","v6.14-rc5","v6.14-rc6","v6.14-rc7","v6.14.1","v6.8","v6.8-rc4","v6.8-rc5","v6.8-rc6","v6.8-rc7","v6.9","v6.9-rc1","v6.9-rc2","v6.9-rc3","v6.9-rc4","v6.9-rc5","v6.9-rc6","v6.9-rc7"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-22123.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"204697592875829879787454710253492405870","length":427},"id":"CVE-2025-22123-1b2ebe1c","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@986c50f6bca109c6cf362b4e2babcb85aba958f6","target":{"file":"fs/f2fs/inode.c","function":"f2fs_write_inode"}},{"deprecated":false,"digest":{"line_hashes":["66595862133701124659536898199330633509","309238412311286554210169759982858065909","221837837885988608269513844396456823264"],"threshold":0.9},"id":"CVE-2025-22123-227fcbff","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bf49527089ec1ba894c6e587affabbfb2329f52e","target":{"file":"fs/f2fs/inode.c"}},{"deprecated":false,"digest":{"line_hashes":["237650967250431159537224213433487448853","130875306991981559891854191411500065920","307633625486823373658101529021390960364","286203188378828232575656978557932671842","45886600030647123407964551341676964798","45778306453875324277029254639782075608","179821305238912383895923510908495305720","8846579865180775035762948536132354203","260216955171805661259055229001587042481","125839475307973332562009424990875621429","114069499581655455424084604005756500684"],"threshold":0.9},"id":"CVE-2025-22123-5cdf609e","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bf49527089ec1ba894c6e587affabbfb2329f52e","target":{"file":"fs/f2fs/segment.h"}},{"deprecated":false,"digest":{"function_hash":"270926455195989993717433040081691846442","length":575},"id":"CVE-2025-22123-5d749122","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@986c50f6bca109c6cf362b4e2babcb85aba958f6","target":{"file":"fs/f2fs/segment.h","function":"has_curseg_enough_space"}},{"deprecated":false,"digest":{"function_hash":"270926455195989993717433040081691846442","length":575},"id":"CVE-2025-22123-732ab3ab","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bf49527089ec1ba894c6e587affabbfb2329f52e","target":{"file":"fs/f2fs/segment.h","function":"has_curseg_enough_space"}},{"deprecated":false,"digest":{"line_hashes":["66595862133701124659536898199330633509","309238412311286554210169759982858065909","221837837885988608269513844396456823264"],"threshold":0.9},"id":"CVE-2025-22123-96c115db","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7f90e5d423cd2d4c74b2abb527872f335108637f","target":{"file":"fs/f2fs/inode.c"}},{"deprecated":false,"digest":{"line_hashes":["237650967250431159537224213433487448853","130875306991981559891854191411500065920","307633625486823373658101529021390960364","286203188378828232575656978557932671842","45886600030647123407964551341676964798","45778306453875324277029254639782075608","179821305238912383895923510908495305720","8846579865180775035762948536132354203","260216955171805661259055229001587042481","125839475307973332562009424990875621429","114069499581655455424084604005756500684"],"threshold":0.9},"id":"CVE-2025-22123-a67bdaeb","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@986c50f6bca109c6cf362b4e2babcb85aba958f6","target":{"file":"fs/f2fs/segment.h"}},{"deprecated":false,"digest":{"function_hash":"204697592875829879787454710253492405870","length":427},"id":"CVE-2025-22123-a80b2159","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7f90e5d423cd2d4c74b2abb527872f335108637f","target":{"file":"fs/f2fs/inode.c","function":"f2fs_write_inode"}},{"deprecated":false,"digest":{"line_hashes":["66595862133701124659536898199330633509","309238412311286554210169759982858065909","221837837885988608269513844396456823264"],"threshold":0.9},"id":"CVE-2025-22123-cf735c7f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@986c50f6bca109c6cf362b4e2babcb85aba958f6","target":{"file":"fs/f2fs/inode.c"}},{"deprecated":false,"digest":{"function_hash":"270926455195989993717433040081691846442","length":575},"id":"CVE-2025-22123-d67b673e","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7f90e5d423cd2d4c74b2abb527872f335108637f","target":{"file":"fs/f2fs/segment.h","function":"has_curseg_enough_space"}},{"deprecated":false,"digest":{"function_hash":"204697592875829879787454710253492405870","length":427},"id":"CVE-2025-22123-fbcffe48","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bf49527089ec1ba894c6e587affabbfb2329f52e","target":{"file":"fs/f2fs/inode.c","function":"f2fs_write_inode"}},{"deprecated":false,"digest":{"line_hashes":["237650967250431159537224213433487448853","130875306991981559891854191411500065920","307633625486823373658101529021390960364","286203188378828232575656978557932671842","45886600030647123407964551341676964798","45778306453875324277029254639782075608","179821305238912383895923510908495305720","8846579865180775035762948536132354203","260216955171805661259055229001587042481","125839475307973332562009424990875621429","114069499581655455424084604005756500684"],"threshold":0.9},"id":"CVE-2025-22123-fcb513a4","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7f90e5d423cd2d4c74b2abb527872f335108637f","target":{"file":"fs/f2fs/segment.h"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.9.0"},{"fixed":"6.12.33"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.13.0"},{"fixed":"6.14.2"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-22123.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/7f90e5d423cd2d4c74b2abb527872f335108637f"},{"type":"WEB","url":"https://git.kernel.org/stable/c/986c50f6bca109c6cf362b4e2babcb85aba958f6"},{"type":"WEB","url":"https://git.kernel.org/stable/c/bf49527089ec1ba894c6e587affabbfb2329f52e"}]}