{"schema_version":"1.7.3","id":"CVE-2022-49270","published":"2025-02-26T01:56:17.683Z","modified":"2025-11-19T14:19:50.226473Z","related":["SUSE-SU-2025:1027-1","SUSE-SU-2025:1176-1","SUSE-SU-2025:1183-1","SUSE-SU-2025:1241-1"],"summary":"dm: fix use-after-free in dm_cleanup_zoned_dev()","details":"In the Linux kernel, the following vulnerability has been resolved:\n\ndm: fix use-after-free in dm_cleanup_zoned_dev()\n\ndm_cleanup_zoned_dev() uses queue, so it must be called\nbefore blk_cleanup_disk() starts its killing:\n\nblk_cleanup_disk->blk_cleanup_queue()->kobject_put()->blk_release_queue()->\n->...RCU...->blk_free_queue_rcu()->kmem_cache_free()\n\nOtherwise, RCU callback may be executed first and\ndm_cleanup_zoned_dev() will touch free'd memory:\n\n BUG: KASAN: use-after-free in dm_cleanup_zoned_dev+0x33/0xd0\n Read of size 8 at addr ffff88805ac6e430 by task dmsetup/681\n\n CPU: 4 PID: 681 Comm: dmsetup Not tainted 5.17.0-rc2+ #6\n Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.14.0-2 04/01/2014\n Call Trace:\n  <TASK>\n  dump_stack_lvl+0x57/0x7d\n  print_address_description.constprop.0+0x1f/0x150\n  ? dm_cleanup_zoned_dev+0x33/0xd0\n  kasan_report.cold+0x7f/0x11b\n  ? dm_cleanup_zoned_dev+0x33/0xd0\n  dm_cleanup_zoned_dev+0x33/0xd0\n  __dm_destroy+0x26a/0x400\n  ? dm_blk_ioctl+0x230/0x230\n  ? up_write+0xd8/0x270\n  dev_remove+0x156/0x1d0\n  ctl_ioctl+0x269/0x530\n  ? table_clear+0x140/0x140\n  ? lock_release+0xb2/0x750\n  ? remove_all+0x40/0x40\n  ? rcu_read_lock_sched_held+0x12/0x70\n  ? lock_downgrade+0x3c0/0x3c0\n  ? rcu_read_lock_sched_held+0x12/0x70\n  dm_ctl_ioctl+0xa/0x10\n  __x64_sys_ioctl+0xb9/0xf0\n  do_syscall_64+0x3b/0x90\n  entry_SYSCALL_64_after_hwframe+0x44/0xae\n RIP: 0033:0x7fb6dfa95c27","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"bb37d77239af25cde59693dbe3fac04dd17d7b29"},{"fixed":"0987f00a76a17aa7213da492c00ed9e5a6210c73"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"bb37d77239af25cde59693dbe3fac04dd17d7b29"},{"fixed":"fdfe414ca28ddfd562c233fb27385cf820de03e8"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"bb37d77239af25cde59693dbe3fac04dd17d7b29"},{"fixed":"43a043aed964659bc69ef81f266912b73c80d837"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"bb37d77239af25cde59693dbe3fac04dd17d7b29"},{"fixed":"588b7f5df0cb64f281290c7672470c006abe7160"}]}],"versions":["v5.13","v5.13-rc4","v5.13-rc5","v5.13-rc6","v5.13-rc7","v5.14","v5.14-rc1","v5.14-rc2","v5.14-rc3","v5.14-rc4","v5.14-rc5","v5.14-rc6","v5.14-rc7","v5.15","v5.15-rc1","v5.15-rc2","v5.15-rc3","v5.15-rc4","v5.15-rc5","v5.15-rc6","v5.15-rc7","v5.15.1","v5.15.10","v5.15.11","v5.15.12","v5.15.13","v5.15.14","v5.15.15","v5.15.16","v5.15.17","v5.15.18","v5.15.19","v5.15.2","v5.15.20","v5.15.21","v5.15.22","v5.15.23","v5.15.24","v5.15.25","v5.15.26","v5.15.27","v5.15.28","v5.15.29","v5.15.3","v5.15.30","v5.15.31","v5.15.32","v5.15.4","v5.15.5","v5.15.6","v5.15.7","v5.15.8","v5.15.9","v5.16","v5.16-rc1","v5.16-rc2","v5.16-rc3","v5.16-rc4","v5.16-rc5","v5.16-rc6","v5.16-rc7","v5.16-rc8","v5.16.1","v5.16.10","v5.16.11","v5.16.12","v5.16.13","v5.16.14","v5.16.15","v5.16.16","v5.16.17","v5.16.18","v5.16.2","v5.16.3","v5.16.4","v5.16.5","v5.16.6","v5.16.7","v5.16.8","v5.16.9","v5.17","v5.17-rc1","v5.17-rc2","v5.17-rc3","v5.17-rc4","v5.17-rc5","v5.17-rc6","v5.17-rc7","v5.17-rc8","v5.17.1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49270.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"81366426606027698239026287965572939256","length":785},"id":"CVE-2022-49270-01f4dc14","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@fdfe414ca28ddfd562c233fb27385cf820de03e8","target":{"file":"drivers/md/dm.c","function":"cleanup_mapped_device"}},{"deprecated":false,"digest":{"line_hashes":["256538427029333137851255072979133780673","13817241541847778795473884006236546381","282172158870113756668348867881738317120","79558354655916324936995770778617082608","67253472398455296585966915240653246454","154955768871407162014361812966719815322","250212884710974208667930581639527162819"],"threshold":0.9},"id":"CVE-2022-49270-3bbd4295","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@0987f00a76a17aa7213da492c00ed9e5a6210c73","target":{"file":"drivers/md/dm.c"}},{"deprecated":false,"digest":{"function_hash":"81366426606027698239026287965572939256","length":785},"id":"CVE-2022-49270-74901d2e","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@0987f00a76a17aa7213da492c00ed9e5a6210c73","target":{"file":"drivers/md/dm.c","function":"cleanup_mapped_device"}},{"deprecated":false,"digest":{"function_hash":"65022243914042807747895342230750590298","length":909},"id":"CVE-2022-49270-91e2f02b","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@588b7f5df0cb64f281290c7672470c006abe7160","target":{"file":"drivers/md/dm.c","function":"cleanup_mapped_device"}},{"deprecated":false,"digest":{"line_hashes":["256538427029333137851255072979133780673","13817241541847778795473884006236546381","282172158870113756668348867881738317120","79558354655916324936995770778617082608","67253472398455296585966915240653246454","154955768871407162014361812966719815322","250212884710974208667930581639527162819"],"threshold":0.9},"id":"CVE-2022-49270-bd9949c1","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@43a043aed964659bc69ef81f266912b73c80d837","target":{"file":"drivers/md/dm.c"}},{"deprecated":false,"digest":{"line_hashes":["256538427029333137851255072979133780673","13817241541847778795473884006236546381","282172158870113756668348867881738317120","79558354655916324936995770778617082608","67253472398455296585966915240653246454","154955768871407162014361812966719815322","250212884710974208667930581639527162819"],"threshold":0.9},"id":"CVE-2022-49270-be0645ea","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@588b7f5df0cb64f281290c7672470c006abe7160","target":{"file":"drivers/md/dm.c"}},{"deprecated":false,"digest":{"line_hashes":["256538427029333137851255072979133780673","13817241541847778795473884006236546381","282172158870113756668348867881738317120","79558354655916324936995770778617082608","67253472398455296585966915240653246454","154955768871407162014361812966719815322","250212884710974208667930581639527162819"],"threshold":0.9},"id":"CVE-2022-49270-c1f36989","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@fdfe414ca28ddfd562c233fb27385cf820de03e8","target":{"file":"drivers/md/dm.c"}},{"deprecated":false,"digest":{"function_hash":"334098829510560124021196836905366526636","length":814},"id":"CVE-2022-49270-c641f9b3","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@43a043aed964659bc69ef81f266912b73c80d837","target":{"file":"drivers/md/dm.c","function":"cleanup_mapped_device"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"5.14.0"},{"fixed":"5.15.33"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.16.0"},{"fixed":"5.16.19"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.17.0"},{"fixed":"5.17.2"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49270.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/0987f00a76a17aa7213da492c00ed9e5a6210c73"},{"type":"WEB","url":"https://git.kernel.org/stable/c/43a043aed964659bc69ef81f266912b73c80d837"},{"type":"WEB","url":"https://git.kernel.org/stable/c/588b7f5df0cb64f281290c7672470c006abe7160"},{"type":"WEB","url":"https://git.kernel.org/stable/c/fdfe414ca28ddfd562c233fb27385cf820de03e8"}],"severity":[{"type":"CVSS_V3","score":"CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"}]}