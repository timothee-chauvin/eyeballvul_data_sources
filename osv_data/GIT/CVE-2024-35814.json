{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35814.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "function_hash": "112734023914588076329245913264631229386",
              "length": 1812.0
            },
            "id": "CVE-2024-35814-137b2289",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c88668aa6c1da240ea3eb4d128b7906e740d3cb8",
            "target": {
              "file": "kernel/dma/swiotlb.c",
              "function": "swiotlb_area_find_slots"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "141809747422596749645344250932421305956",
                "15668583442597282186908771637318225002",
                "64664072020176105894416501962476727491",
                "306207721564870634736245503058623126528",
                "207309411181545598013998989762141622779",
                "332971036597091219978537383672900569790",
                "337422004510381186317375631405865394739",
                "123169930027449981126263912719391948893",
                "6545723262418058322455154193714917436",
                "314536636229162028634570022783102102428",
                "43857754476153108130097212155868992093",
                "21310507988635172777168385517297803619",
                "50045070106905708259584511861028186973",
                "3249448087535400412548453358681463836",
                "18992931685686454792688617089405320736",
                "222959591489977148682101016815570757375",
                "104789271629638725263116484805355760879",
                "148774247730175994250834650707873262155",
                "160491680382802564263223179228378225116"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-35814-57f376d1",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@777391743771040e12cc40d3d0d178f70c616491",
            "target": {
              "file": "kernel/dma/swiotlb.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "112734023914588076329245913264631229386",
              "length": 1812.0
            },
            "id": "CVE-2024-35814-91cfaf8d",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@777391743771040e12cc40d3d0d178f70c616491",
            "target": {
              "file": "kernel/dma/swiotlb.c",
              "function": "swiotlb_search_pool_area"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "141809747422596749645344250932421305956",
                "15668583442597282186908771637318225002",
                "64664072020176105894416501962476727491",
                "306207721564870634736245503058623126528",
                "207309411181545598013998989762141622779",
                "332971036597091219978537383672900569790",
                "337422004510381186317375631405865394739",
                "123169930027449981126263912719391948893",
                "6545723262418058322455154193714917436",
                "314536636229162028634570022783102102428",
                "43857754476153108130097212155868992093",
                "21310507988635172777168385517297803619",
                "50045070106905708259584511861028186973",
                "3249448087535400412548453358681463836",
                "18992931685686454792688617089405320736",
                "222959591489977148682101016815570757375",
                "104789271629638725263116484805355760879",
                "148774247730175994250834650707873262155",
                "160491680382802564263223179228378225116"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-35814-9b6152e5",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c88668aa6c1da240ea3eb4d128b7906e740d3cb8",
            "target": {
              "file": "kernel/dma/swiotlb.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "141809747422596749645344250932421305956",
                "15668583442597282186908771637318225002",
                "64664072020176105894416501962476727491",
                "306207721564870634736245503058623126528",
                "207309411181545598013998989762141622779",
                "332971036597091219978537383672900569790",
                "337422004510381186317375631405865394739",
                "123169930027449981126263912719391948893",
                "6545723262418058322455154193714917436",
                "314536636229162028634570022783102102428",
                "43857754476153108130097212155868992093",
                "21310507988635172777168385517297803619",
                "50045070106905708259584511861028186973",
                "3249448087535400412548453358681463836",
                "18992931685686454792688617089405320736",
                "222959591489977148682101016815570757375",
                "104789271629638725263116484805355760879",
                "148774247730175994250834650707873262155",
                "160491680382802564263223179228378225116"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-35814-cebfb374",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@04867a7a33324c9c562ee7949dbcaab7aaad1fb4",
            "target": {
              "file": "kernel/dma/swiotlb.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "112734023914588076329245913264631229386",
              "length": 1812.0
            },
            "id": "CVE-2024-35814-ee9e4af6",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@04867a7a33324c9c562ee7949dbcaab7aaad1fb4",
            "target": {
              "file": "kernel/dma/swiotlb.c",
              "function": "swiotlb_search_pool_area"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0eee5ae1025699ea93d44fdb6ef2365505082103"
            },
            {
              "fixed": "3e7acd6e25ba77dde48c3b721c54c89cd6a10534"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "0eee5ae1025699ea93d44fdb6ef2365505082103"
            },
            {
              "fixed": "c88668aa6c1da240ea3eb4d128b7906e740d3cb8"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "0eee5ae1025699ea93d44fdb6ef2365505082103"
            },
            {
              "fixed": "777391743771040e12cc40d3d0d178f70c616491"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "0eee5ae1025699ea93d44fdb6ef2365505082103"
            },
            {
              "fixed": "04867a7a33324c9c562ee7949dbcaab7aaad1fb4"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v6.3",
        "v6.3-rc3",
        "v6.3-rc4",
        "v6.3-rc5",
        "v6.3-rc6",
        "v6.3-rc7",
        "v6.4",
        "v6.4-rc1",
        "v6.4-rc2",
        "v6.4-rc3",
        "v6.4-rc4",
        "v6.4-rc5",
        "v6.4-rc6",
        "v6.4-rc7",
        "v6.5",
        "v6.5-rc1",
        "v6.5-rc2",
        "v6.5-rc3",
        "v6.5-rc4",
        "v6.5-rc5",
        "v6.5-rc6",
        "v6.5-rc7",
        "v6.6",
        "v6.6-rc1",
        "v6.6-rc2",
        "v6.6-rc3",
        "v6.6-rc4",
        "v6.6-rc5",
        "v6.6-rc6",
        "v6.6-rc7",
        "v6.6.1",
        "v6.6.10",
        "v6.6.11",
        "v6.6.12",
        "v6.6.13",
        "v6.6.14",
        "v6.6.15",
        "v6.6.16",
        "v6.6.17",
        "v6.6.18",
        "v6.6.19",
        "v6.6.2",
        "v6.6.20",
        "v6.6.21",
        "v6.6.22",
        "v6.6.23",
        "v6.6.3",
        "v6.6.4",
        "v6.6.5",
        "v6.6.6",
        "v6.6.7",
        "v6.6.8",
        "v6.6.9",
        "v6.7",
        "v6.7-rc1",
        "v6.7-rc2",
        "v6.7-rc3",
        "v6.7-rc4",
        "v6.7-rc5",
        "v6.7-rc6",
        "v6.7-rc7",
        "v6.7-rc8",
        "v6.7.1",
        "v6.7.10",
        "v6.7.11",
        "v6.7.2",
        "v6.7.3",
        "v6.7.4",
        "v6.7.5",
        "v6.7.6",
        "v6.7.7",
        "v6.7.8",
        "v6.7.9",
        "v6.8",
        "v6.8-rc1",
        "v6.8-rc2",
        "v6.8-rc3",
        "v6.8-rc4",
        "v6.8-rc5",
        "v6.8-rc6",
        "v6.8-rc7",
        "v6.8.1",
        "v6.8.2"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35814.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "6.3.0"
            },
            {
              "fixed": "6.6.24"
            }
          ],
          "type": "ECOSYSTEM"
        },
        {
          "events": [
            {
              "introduced": "6.7.0"
            },
            {
              "fixed": "6.7.12"
            }
          ],
          "type": "ECOSYSTEM"
        },
        {
          "events": [
            {
              "introduced": "6.8.0"
            },
            {
              "fixed": "6.8.3"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35814.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0eee5ae10256"
            },
            {
              "fixed": "3e7acd6e25ba"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35814.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0eee5ae10256"
            },
            {
              "fixed": "c88668aa6c1d"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35814.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0eee5ae10256"
            },
            {
              "fixed": "777391743771"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35814.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0eee5ae10256"
            },
            {
              "fixed": "04867a7a3332"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35814.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0"
            },
            {
              "last_affected": "6.3"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nswiotlb: Fix double-allocation of slots due to broken alignment handling\n\nCommit bbb73a103fbb (\"swiotlb: fix a braino in the alignment check fix\"),\nwhich was a fix for commit 0eee5ae10256 (\"swiotlb: fix slot alignment\nchecks\"), causes a functional regression with vsock in a virtual machine\nusing bouncing via a restricted DMA SWIOTLB pool.\n\nWhen virtio allocates the virtqueues for the vsock device using\ndma_alloc_coherent(), the SWIOTLB search can return page-unaligned\nallocations if 'area->index' was left unaligned by a previous allocation\nfrom the buffer:\n\n # Final address in brackets is the SWIOTLB address returned to the caller\n | virtio-pci 0000:00:07.0: orig_addr 0x0 alloc_size 0x2000, iotlb_align_mask 0x800 stride 0x2: got slot 1645-1649/7168 (0x98326800)\n | virtio-pci 0000:00:07.0: orig_addr 0x0 alloc_size 0x2000, iotlb_align_mask 0x800 stride 0x2: got slot 1649-1653/7168 (0x98328800)\n | virtio-pci 0000:00:07.0: orig_addr 0x0 alloc_size 0x2000, iotlb_align_mask 0x800 stride 0x2: got slot 1653-1657/7168 (0x9832a800)\n\nThis ends badly (typically buffer corruption and/or a hang) because\nswiotlb_alloc() is expecting a page-aligned allocation and so blindly\nreturns a pointer to the 'struct page' corresponding to the allocation,\ntherefore double-allocating the first half (2KiB slot) of the 4KiB page.\n\nFix the problem by treating the allocation alignment separately to any\nadditional alignment requirements from the device, using the maximum\nof the two as the stride to search the buffer slots and taking care\nto ensure a minimum of page-alignment for buffers larger than a page.\n\nThis also resolves swiotlb allocation failures occuring due to the\ninclusion of ~PAGE_MASK in 'iotlb_align_mask' for large allocations and\nresulting in alignment requirements exceeding swiotlb_max_mapping_size().",
  "id": "CVE-2024-35814",
  "modified": "2025-10-15T10:39:48.192872Z",
  "published": "2024-05-17T13:23:19Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/04867a7a33324c9c562ee7949dbcaab7aaad1fb4"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/3e7acd6e25ba77dde48c3b721c54c89cd6a10534"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/777391743771040e12cc40d3d0d178f70c616491"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/c88668aa6c1da240ea3eb4d128b7906e740d3cb8"
    }
  ],
  "related": [
    "RLSA-2024:5101",
    "RLSA-2024:5102",
    "RXSA-2024:5101",
    "SUSE-SU-2024:2135-1",
    "SUSE-SU-2024:2203-1",
    "SUSE-SU-2024:2372-1",
    "SUSE-SU-2024:2394-1",
    "SUSE-SU-2024:2939-1",
    "SUSE-SU-2024:2973-1"
  ],
  "schema_version": "1.7.3",
  "severity": [
    {
      "score": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:H",
      "type": "CVSS_V3"
    }
  ],
  "summary": "swiotlb: Fix double-allocation of slots due to broken alignment handling"
}