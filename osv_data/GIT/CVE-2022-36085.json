{"schema_version":"1.7.3","id":"CVE-2022-36085","published":"2022-09-08T13:30:16Z","modified":"2025-10-22T18:32:46.997031Z","aliases":["GHSA-f524-rf33-2jjr","GO-2022-0978"],"summary":"OPA Compiler: Bypass of WithUnsafeBuiltins using `with` keyword to mock functions","details":"Open Policy Agent (OPA) is an open source, general-purpose policy engine. The Rego compiler provides a (deprecated) `WithUnsafeBuiltins` function, which allows users to provide a set of built-in functions that should be deemed unsafe — and as such rejected — by the compiler if encountered in the policy compilation stage. A bypass of this protection has been found, where the use of the `with` keyword to mock such a built-in function (a feature introduced in OPA v0.40.0), isn’t taken into account by `WithUnsafeBuiltins`. Multiple conditions need to be met in order to create an adverse effect. Version 0.43.1 contains a patch for this issue. As a workaround, avoid using the `WithUnsafeBuiltins` function and use the `capabilities` feature instead.","affected":[{"ranges":[{"type":"GIT","repo":"https://github.com/open-policy-agent/opa","events":[{"introduced":"b3c8d80111fa487d44ae84666f8d821e0a977a5a"},{"fixed":"196c92df8b936e0b211b2d2ac767cbb89949060f"}]}],"versions":["v0.40.0","v0.41.0","v0.42.0","v0.43.0"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-36085.json"}}],"references":[{"type":"ADVISORY","url":"https://github.com/open-policy-agent/opa/security/advisories/GHSA-f524-rf33-2jjr"},{"type":"FIX","url":"https://github.com/open-policy-agent/opa/commit/25a597bc3f4985162e7f65f9c36599f4f8f55823"},{"type":"FIX","url":"https://github.com/open-policy-agent/opa/commit/3e8c754ed007b22393cf65e48751ad9f6457fee8"},{"type":"FIX","url":"https://github.com/open-policy-agent/opa/pull/4540"},{"type":"FIX","url":"https://github.com/open-policy-agent/opa/pull/4616"},{"type":"WEB","url":"https://github.com/open-policy-agent/opa/releases/tag/v0.43.1"}],"database_specific":{"cwe_ids":["CWE-20","CWE-693"]},"severity":[{"type":"CVSS_V3","score":"CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N"}]}