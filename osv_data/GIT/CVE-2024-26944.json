{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-26944.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "function_hash": "167769436227192270313270889154492827608",
              "length": 2461.0
            },
            "id": "CVE-2024-26944-7a0fc14b",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1ec17ef59168a1a6f1105f5dc517f783839a5302",
            "target": {
              "file": "fs/btrfs/zoned.c",
              "function": "do_zone_finish"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "296485909753592348215590702035423973730",
                "168870151593064014731992782391427668111",
                "190967533391762100296047511119884918694",
                "305734183601165156642472393042807156580",
                "323872210325311784680431332968123191995",
                "313972715112378856992143936745060230737",
                "193133904891312589228743778978961858447",
                "184927299036527615121285700409138451935",
                "188505058886581550624062103115505177042",
                "317861302494051890453606535245178224207",
                "190880779094411461120938330537060698748",
                "231919902297431052914146251260368951868",
                "47094099555610417519285860738891533573",
                "9192431344743619849023820040554908090",
                "255095236668510372343636010412503553765",
                "228629650719081065619324853137458336104",
                "286204902269261971518091630826564952999",
                "54258316318111234017000329040542654330",
                "302968128323629531079358534310626904704",
                "241347700797313431415036782978803120782",
                "272312178184303810642642164517396017842",
                "151857170148406037400288183407776186752",
                "206271085107374343257231836085817140430",
                "5232601418819513270062322455642124182",
                "300612717105267491561522875306362084842",
                "172323547174712419865065231350217730156",
                "339382015342740949587980342968302258401",
                "86843803705924374476335200030445445761"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-26944-b814f8f6",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1ec17ef59168a1a6f1105f5dc517f783839a5302",
            "target": {
              "file": "fs/btrfs/zoned.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "296485909753592348215590702035423973730",
                "168870151593064014731992782391427668111",
                "190967533391762100296047511119884918694",
                "305734183601165156642472393042807156580",
                "323872210325311784680431332968123191995",
                "313972715112378856992143936745060230737",
                "193133904891312589228743778978961858447",
                "184927299036527615121285700409138451935",
                "188505058886581550624062103115505177042",
                "317861302494051890453606535245178224207",
                "190880779094411461120938330537060698748",
                "231919902297431052914146251260368951868",
                "47094099555610417519285860738891533573",
                "9192431344743619849023820040554908090",
                "255095236668510372343636010412503553765",
                "228629650719081065619324853137458336104",
                "286204902269261971518091630826564952999",
                "54258316318111234017000329040542654330",
                "302968128323629531079358534310626904704",
                "241347700797313431415036782978803120782",
                "272312178184303810642642164517396017842",
                "151857170148406037400288183407776186752",
                "206271085107374343257231836085817140430",
                "5232601418819513270062322455642124182",
                "300612717105267491561522875306362084842",
                "172323547174712419865065231350217730156",
                "339382015342740949587980342968302258401",
                "86843803705924374476335200030445445761"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-26944-bf216758",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@34ca809e055eca5cfe63d9c7efbf80b7c21b4e57",
            "target": {
              "file": "fs/btrfs/zoned.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "167769436227192270313270889154492827608",
              "length": 2461.0
            },
            "id": "CVE-2024-26944-fbe5b649",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@34ca809e055eca5cfe63d9c7efbf80b7c21b4e57",
            "target": {
              "file": "fs/btrfs/zoned.c",
              "function": "do_zone_finish"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "4dcbb8ab31c1292aea6a3f240e19523f633320c2"
            },
            {
              "fixed": "34ca809e055eca5cfe63d9c7efbf80b7c21b4e57"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "4dcbb8ab31c1292aea6a3f240e19523f633320c2"
            },
            {
              "fixed": "1ec17ef59168a1a6f1105f5dc517f783839a5302"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v5.17",
        "v5.18",
        "v5.18-rc1",
        "v5.18-rc2",
        "v5.18-rc3",
        "v5.18-rc4",
        "v5.18-rc5",
        "v5.18-rc6",
        "v5.18-rc7",
        "v5.19",
        "v5.19-rc1",
        "v5.19-rc2",
        "v5.19-rc3",
        "v5.19-rc4",
        "v5.19-rc5",
        "v5.19-rc6",
        "v5.19-rc7",
        "v5.19-rc8",
        "v6.0",
        "v6.0-rc1",
        "v6.0-rc2",
        "v6.0-rc3",
        "v6.0-rc4",
        "v6.0-rc5",
        "v6.0-rc6",
        "v6.0-rc7",
        "v6.1",
        "v6.1-rc1",
        "v6.1-rc2",
        "v6.1-rc3",
        "v6.1-rc4",
        "v6.1-rc5",
        "v6.1-rc6",
        "v6.1-rc7",
        "v6.1-rc8",
        "v6.2",
        "v6.2-rc1",
        "v6.2-rc2",
        "v6.2-rc3",
        "v6.2-rc4",
        "v6.2-rc5",
        "v6.2-rc6",
        "v6.2-rc7",
        "v6.2-rc8",
        "v6.3",
        "v6.3-rc1",
        "v6.3-rc2",
        "v6.3-rc3",
        "v6.3-rc4",
        "v6.3-rc5",
        "v6.3-rc6",
        "v6.3-rc7",
        "v6.4",
        "v6.4-rc1",
        "v6.4-rc2",
        "v6.4-rc3",
        "v6.4-rc4",
        "v6.4-rc5",
        "v6.4-rc6",
        "v6.4-rc7",
        "v6.5",
        "v6.5-rc1",
        "v6.5-rc2",
        "v6.5-rc3",
        "v6.5-rc4",
        "v6.5-rc5",
        "v6.5-rc6",
        "v6.5-rc7",
        "v6.6",
        "v6.6-rc1",
        "v6.6-rc2",
        "v6.6-rc3",
        "v6.6-rc4",
        "v6.6-rc5",
        "v6.6-rc6",
        "v6.6-rc7",
        "v6.7",
        "v6.7-rc1",
        "v6.7-rc2",
        "v6.7-rc3",
        "v6.7-rc4",
        "v6.7-rc5",
        "v6.7-rc6",
        "v6.7-rc7",
        "v6.7-rc8",
        "v6.8",
        "v6.8-rc1",
        "v6.8-rc2",
        "v6.8-rc3",
        "v6.8-rc4",
        "v6.8-rc5",
        "v6.8-rc6",
        "v6.8-rc7",
        "v6.8.1",
        "v6.8.2"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-26944.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "5.18.0"
            },
            {
              "fixed": "6.8.3"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: zoned: fix use-after-free in do_zone_finish()\n\nShinichiro reported the following use-after-free triggered by the device\nreplace operation in fstests btrfs/070.\n\n BTRFS info (device nullb1): scrub: finished on devid 1 with status: 0\n ==================================================================\n BUG: KASAN: slab-use-after-free in do_zone_finish+0x91a/0xb90 [btrfs]\n Read of size 8 at addr ffff8881543c8060 by task btrfs-cleaner/3494007\n\n CPU: 0 PID: 3494007 Comm: btrfs-cleaner Tainted: G        W          6.8.0-rc5-kts #1\n Hardware name: Supermicro Super Server/X11SPi-TF, BIOS 3.3 02/21/2020\n Call Trace:\n  <TASK>\n  dump_stack_lvl+0x5b/0x90\n  print_report+0xcf/0x670\n  ? __virt_addr_valid+0x200/0x3e0\n  kasan_report+0xd8/0x110\n  ? do_zone_finish+0x91a/0xb90 [btrfs]\n  ? do_zone_finish+0x91a/0xb90 [btrfs]\n  do_zone_finish+0x91a/0xb90 [btrfs]\n  btrfs_delete_unused_bgs+0x5e1/0x1750 [btrfs]\n  ? __pfx_btrfs_delete_unused_bgs+0x10/0x10 [btrfs]\n  ? btrfs_put_root+0x2d/0x220 [btrfs]\n  ? btrfs_clean_one_deleted_snapshot+0x299/0x430 [btrfs]\n  cleaner_kthread+0x21e/0x380 [btrfs]\n  ? __pfx_cleaner_kthread+0x10/0x10 [btrfs]\n  kthread+0x2e3/0x3c0\n  ? __pfx_kthread+0x10/0x10\n  ret_from_fork+0x31/0x70\n  ? __pfx_kthread+0x10/0x10\n  ret_from_fork_asm+0x1b/0x30\n  </TASK>\n\n Allocated by task 3493983:\n  kasan_save_stack+0x33/0x60\n  kasan_save_track+0x14/0x30\n  __kasan_kmalloc+0xaa/0xb0\n  btrfs_alloc_device+0xb3/0x4e0 [btrfs]\n  device_list_add.constprop.0+0x993/0x1630 [btrfs]\n  btrfs_scan_one_device+0x219/0x3d0 [btrfs]\n  btrfs_control_ioctl+0x26e/0x310 [btrfs]\n  __x64_sys_ioctl+0x134/0x1b0\n  do_syscall_64+0x99/0x190\n  entry_SYSCALL_64_after_hwframe+0x6e/0x76\n\n Freed by task 3494056:\n  kasan_save_stack+0x33/0x60\n  kasan_save_track+0x14/0x30\n  kasan_save_free_info+0x3f/0x60\n  poison_slab_object+0x102/0x170\n  __kasan_slab_free+0x32/0x70\n  kfree+0x11b/0x320\n  btrfs_rm_dev_replace_free_srcdev+0xca/0x280 [btrfs]\n  btrfs_dev_replace_finishing+0xd7e/0x14f0 [btrfs]\n  btrfs_dev_replace_by_ioctl+0x1286/0x25a0 [btrfs]\n  btrfs_ioctl+0xb27/0x57d0 [btrfs]\n  __x64_sys_ioctl+0x134/0x1b0\n  do_syscall_64+0x99/0x190\n  entry_SYSCALL_64_after_hwframe+0x6e/0x76\n\n The buggy address belongs to the object at ffff8881543c8000\n  which belongs to the cache kmalloc-1k of size 1024\n The buggy address is located 96 bytes inside of\n  freed 1024-byte region [ffff8881543c8000, ffff8881543c8400)\n\n The buggy address belongs to the physical page:\n page:00000000fe2c1285 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x1543c8\n head:00000000fe2c1285 order:3 entire_mapcount:0 nr_pages_mapped:0 pincount:0\n flags: 0x17ffffc0000840(slab|head|node=0|zone=2|lastcpupid=0x1fffff)\n page_type: 0xffffffff()\n raw: 0017ffffc0000840 ffff888100042dc0 ffffea0019e8f200 dead000000000002\n raw: 0000000000000000 0000000000100010 00000001ffffffff 0000000000000000\n page dumped because: kasan: bad access detected\n\n Memory state around the buggy address:\n  ffff8881543c7f00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  ffff8881543c7f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n >ffff8881543c8000: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n                                                        ^\n  ffff8881543c8080: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n  ffff8881543c8100: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n\nThis UAF happens because we're accessing stale zone information of a\nalready removed btrfs_device in do_zone_finish().\n\nThe sequence of events is as follows:\n\nbtrfs_dev_replace_start\n  btrfs_scrub_dev\n   btrfs_dev_replace_finishing\n    btrfs_dev_replace_update_device_in_mapping_tree <-- devices replaced\n    btrfs_rm_dev_replace_free_srcdev\n     btrfs_free_device                              <-- device freed\n\ncleaner_kthread\n btrfs_delete_unused_bgs\n  btrfs_zone_finish\n   do_zone_finish              <-- refers the freed device\n\nThe reason for this is that we're using a\n---truncated---",
  "id": "CVE-2024-26944",
  "modified": "2025-10-15T08:51:59.746445Z",
  "published": "2024-05-01T05:18:04Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/1ec17ef59168a1a6f1105f5dc517f783839a5302"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/34ca809e055eca5cfe63d9c7efbf80b7c21b4e57"
    }
  ],
  "related": [
    "SUSE-SU-2024:2802-1",
    "SUSE-SU-2024:2896-1",
    "SUSE-SU-2024:2973-1",
    "SUSE-SU-2024:3194-1",
    "SUSE-SU-2024:3383-1"
  ],
  "schema_version": "1.7.3",
  "summary": "btrfs: zoned: fix use-after-free in do_zone_finish()"
}