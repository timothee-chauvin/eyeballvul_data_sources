{"schema_version":"1.7.3","id":"CVE-2025-38268","published":"2025-07-10T07:41:51Z","modified":"2025-10-22T13:21:26.245485Z","related":["SUSE-SU-2025:02853-1"],"summary":"usb: typec: tcpm: move tcpm_queue_vdm_unlocked to asynchronous work","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nusb: typec: tcpm: move tcpm_queue_vdm_unlocked to asynchronous work\n\nA state check was previously added to tcpm_queue_vdm_unlocked to\nprevent a deadlock where the DisplayPort Alt Mode driver would be\nexecuting work and attempting to grab the tcpm_lock while the TCPM\nwas holding the lock and attempting to unregister the altmode, blocking\non the altmode driver's cancel_work_sync call.\n\nBecause the state check isn't protected, there is a small window\nwhere the Alt Mode driver could determine that the TCPM is\nin a ready state and attempt to grab the lock while the\nTCPM grabs the lock and changes the TCPM state to one that\ncauses the deadlock. The callstack is provided below:\n\n[110121.667392][    C7] Call trace:\n[110121.667396][    C7]  __switch_to+0x174/0x338\n[110121.667406][    C7]  __schedule+0x608/0x9f0\n[110121.667414][    C7]  schedule+0x7c/0xe8\n[110121.667423][    C7]  kernfs_drain+0xb0/0x114\n[110121.667431][    C7]  __kernfs_remove+0x16c/0x20c\n[110121.667436][    C7]  kernfs_remove_by_name_ns+0x74/0xe8\n[110121.667442][    C7]  sysfs_remove_group+0x84/0xe8\n[110121.667450][    C7]  sysfs_remove_groups+0x34/0x58\n[110121.667458][    C7]  device_remove_groups+0x10/0x20\n[110121.667464][    C7]  device_release_driver_internal+0x164/0x2e4\n[110121.667475][    C7]  device_release_driver+0x18/0x28\n[110121.667484][    C7]  bus_remove_device+0xec/0x118\n[110121.667491][    C7]  device_del+0x1e8/0x4ac\n[110121.667498][    C7]  device_unregister+0x18/0x38\n[110121.667504][    C7]  typec_unregister_altmode+0x30/0x44\n[110121.667515][    C7]  tcpm_reset_port+0xac/0x370\n[110121.667523][    C7]  tcpm_snk_detach+0x84/0xb8\n[110121.667529][    C7]  run_state_machine+0x4c0/0x1b68\n[110121.667536][    C7]  tcpm_state_machine_work+0x94/0xe4\n[110121.667544][    C7]  kthread_worker_fn+0x10c/0x244\n[110121.667552][    C7]  kthread+0x104/0x1d4\n[110121.667557][    C7]  ret_from_fork+0x10/0x20\n\n[110121.667689][    C7] Workqueue: events dp_altmode_work\n[110121.667697][    C7] Call trace:\n[110121.667701][    C7]  __switch_to+0x174/0x338\n[110121.667710][    C7]  __schedule+0x608/0x9f0\n[110121.667717][    C7]  schedule+0x7c/0xe8\n[110121.667725][    C7]  schedule_preempt_disabled+0x24/0x40\n[110121.667733][    C7]  __mutex_lock+0x408/0xdac\n[110121.667741][    C7]  __mutex_lock_slowpath+0x14/0x24\n[110121.667748][    C7]  mutex_lock+0x40/0xec\n[110121.667757][    C7]  tcpm_altmode_enter+0x78/0xb4\n[110121.667764][    C7]  typec_altmode_enter+0xdc/0x10c\n[110121.667769][    C7]  dp_altmode_work+0x68/0x164\n[110121.667775][    C7]  process_one_work+0x1e4/0x43c\n[110121.667783][    C7]  worker_thread+0x25c/0x430\n[110121.667789][    C7]  kthread+0x104/0x1d4\n[110121.667794][    C7]  ret_from_fork+0x10/0x20\n\nChange tcpm_queue_vdm_unlocked to queue for tcpm_queue_vdm_work,\nwhich can perform the state check while holding the TCPM lock\nwhile the Alt Mode lock is no longer held. This requires a new\nstruct to hold the vdm data, altmode_vdm_event.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"cdc9946ea6377e8e214b135ccc308c5e514ba25f"},{"fixed":"7bdd712abefbec79176ab412d8c623e755c5d0ba"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"cdc9946ea6377e8e214b135ccc308c5e514ba25f"},{"fixed":"1970d34b48cbeceb0c765984c9a6bb204c77f16a"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"cdc9946ea6377e8e214b135ccc308c5e514ba25f"},{"fixed":"324d45e53f1a36c88bc649dc39e0c8300a41be0a"}]}],"versions":["v6.10","v6.10-rc1","v6.10-rc2","v6.10-rc3","v6.10-rc4","v6.10-rc5","v6.10-rc6","v6.10-rc7","v6.11","v6.11-rc1","v6.11-rc2","v6.11-rc3","v6.11-rc4","v6.11-rc5","v6.11-rc6","v6.11-rc7","v6.12","v6.12-rc1","v6.12-rc2","v6.12-rc3","v6.12-rc4","v6.12-rc5","v6.12-rc6","v6.12-rc7","v6.12.1","v6.12.10","v6.12.11","v6.12.12","v6.12.13","v6.12.14","v6.12.15","v6.12.16","v6.12.17","v6.12.18","v6.12.19","v6.12.2","v6.12.20","v6.12.21","v6.12.22","v6.12.23","v6.12.24","v6.12.25","v6.12.26","v6.12.27","v6.12.28","v6.12.29","v6.12.3","v6.12.30","v6.12.31","v6.12.32","v6.12.33","v6.12.4","v6.12.5","v6.12.6","v6.12.7","v6.12.8","v6.12.9","v6.13","v6.13-rc1","v6.13-rc2","v6.13-rc3","v6.13-rc4","v6.13-rc5","v6.13-rc6","v6.13-rc7","v6.14","v6.14-rc1","v6.14-rc2","v6.14-rc3","v6.14-rc4","v6.14-rc5","v6.14-rc6","v6.14-rc7","v6.15","v6.15-rc1","v6.15-rc2","v6.15-rc3","v6.15-rc4","v6.15-rc5","v6.15-rc6","v6.15-rc7","v6.15.1","v6.15.2","v6.9","v6.9-rc6","v6.9-rc7"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-38268.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["188714974399472649811643878239418208300","339100150949879133279189037474905092032","208357371886638143949914132070837251529","59856373665842340914125993990476923124","152506496020623967541644024174437727703","332647661678506769251941288365847835980","198735665838011341426735186396377926829","155918162942787667292195418432176072456","157209072900391278560902895812720934622","84621057074487987538040960165172435840","94081284965112904485733435417326025147","108795789762663448443467999271746228485","12488957672553073425187009815635510838","159797731996757440296900564534105670792","120222832383548645146904551757711820628","327034844309720912874929832847614291183","98807440126849957025798854537276049008","106132921460057212032994653520116806475","194641970952728088500617118686484369055","145150298152895871305525791317513413906","186625083624686272348229459789562228107","91958162602348874955518408288360273610","61462879598972197567367560896283548818","262154208216523489652901932577044293368","210745471063487111252716775529271135072","3645404133930275257194440240863196124","316775995987508006758909091327679079733","262763346080023036891653720000864528579","205643479059138624957301318261594240284","238299788033877547893018100292050384936","89265048342676354127010357499529868394","298311285395621032458390534271038685571","81648211770074669265364064108137850242","142620387568853367014241400702510950181","220887281305769907390953864883302203466","215483706757983784909452937384288736654","229460581345708622974005456495027886757","307909067293468237979768430400028237650","163800297833627596462029872617071404699","168778151669815339076770087719697938160","91164059374008543715693436392486122003","298027641964114220768431963682903550069","274521780201577821351303044648599764743","15628819340171256357469265253329357240","155622838909121060744222435111693620318","40584477670304766020842351246082808164"],"threshold":0.9},"id":"CVE-2025-38268-112390df","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c"}},{"deprecated":false,"digest":{"function_hash":"3458496040845954952027043384577853590","length":369},"id":"CVE-2025-38268-184956dc","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_enter"}},{"deprecated":false,"digest":{"function_hash":"42951959000915067615889295492825777524","length":347},"id":"CVE-2025-38268-192a0ef7","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_exit"}},{"deprecated":false,"digest":{"function_hash":"45049186387711262498202603876754471163","length":389},"id":"CVE-2025-38268-19cb81f5","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_enter"}},{"deprecated":false,"digest":{"function_hash":"248368808974962781852901328475084289247","length":327},"id":"CVE-2025-38268-331aede0","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_exit"}},{"deprecated":false,"digest":{"function_hash":"3458496040845954952027043384577853590","length":369},"id":"CVE-2025-38268-478f0f16","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_enter"}},{"deprecated":false,"digest":{"function_hash":"3458496040845954952027043384577853590","length":369},"id":"CVE-2025-38268-4817aa02","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_enter"}},{"deprecated":false,"digest":{"function_hash":"45049186387711262498202603876754471163","length":389},"id":"CVE-2025-38268-641f1367","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_enter"}},{"deprecated":false,"digest":{"function_hash":"42951959000915067615889295492825777524","length":347},"id":"CVE-2025-38268-66451abb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_exit"}},{"deprecated":false,"digest":{"function_hash":"271347715165109890809665064211332280237","length":349},"id":"CVE-2025-38268-694db688","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_queue_vdm_unlocked"}},{"deprecated":false,"digest":{"function_hash":"233860842650471722478607153255091653952","length":220},"id":"CVE-2025-38268-6f4f9aef","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_vdm"}},{"deprecated":false,"digest":{"function_hash":"233860842650471722478607153255091653952","length":220},"id":"CVE-2025-38268-7ff01d3b","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_vdm"}},{"deprecated":false,"digest":{"line_hashes":["188714974399472649811643878239418208300","339100150949879133279189037474905092032","208357371886638143949914132070837251529","59856373665842340914125993990476923124","152506496020623967541644024174437727703","332647661678506769251941288365847835980","198735665838011341426735186396377926829","155918162942787667292195418432176072456","157209072900391278560902895812720934622","84621057074487987538040960165172435840","94081284965112904485733435417326025147","108795789762663448443467999271746228485","12488957672553073425187009815635510838","159797731996757440296900564534105670792","120222832383548645146904551757711820628","327034844309720912874929832847614291183","98807440126849957025798854537276049008","106132921460057212032994653520116806475","194641970952728088500617118686484369055","145150298152895871305525791317513413906","186625083624686272348229459789562228107","91958162602348874955518408288360273610","61462879598972197567367560896283548818","262154208216523489652901932577044293368","210745471063487111252716775529271135072","3645404133930275257194440240863196124","316775995987508006758909091327679079733","262763346080023036891653720000864528579","205643479059138624957301318261594240284","238299788033877547893018100292050384936","89265048342676354127010357499529868394","298311285395621032458390534271038685571","81648211770074669265364064108137850242","142620387568853367014241400702510950181","220887281305769907390953864883302203466","215483706757983784909452937384288736654","229460581345708622974005456495027886757","307909067293468237979768430400028237650","163800297833627596462029872617071404699","168778151669815339076770087719697938160","91164059374008543715693436392486122003","298027641964114220768431963682903550069","274521780201577821351303044648599764743","15628819340171256357469265253329357240","155622838909121060744222435111693620318","40584477670304766020842351246082808164"],"threshold":0.9},"id":"CVE-2025-38268-8298e22b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c"}},{"deprecated":false,"digest":{"function_hash":"271347715165109890809665064211332280237","length":349},"id":"CVE-2025-38268-a062e4ca","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_queue_vdm_unlocked"}},{"deprecated":false,"digest":{"function_hash":"42951959000915067615889295492825777524","length":347},"id":"CVE-2025-38268-b75609e7","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_exit"}},{"deprecated":false,"digest":{"function_hash":"124997145244104140091618318934526891299","length":200},"id":"CVE-2025-38268-c4189418","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_vdm"}},{"deprecated":false,"digest":{"function_hash":"124997145244104140091618318934526891299","length":200},"id":"CVE-2025-38268-cc01ee5d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_vdm"}},{"deprecated":false,"digest":{"function_hash":"45049186387711262498202603876754471163","length":389},"id":"CVE-2025-38268-d375d625","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_enter"}},{"deprecated":false,"digest":{"function_hash":"271347715165109890809665064211332280237","length":349},"id":"CVE-2025-38268-d7dc8ef7","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@324d45e53f1a36c88bc649dc39e0c8300a41be0a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_queue_vdm_unlocked"}},{"deprecated":false,"digest":{"function_hash":"233860842650471722478607153255091653952","length":220},"id":"CVE-2025-38268-d948f3f4","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_cable_altmode_vdm"}},{"deprecated":false,"digest":{"function_hash":"124997145244104140091618318934526891299","length":200},"id":"CVE-2025-38268-df242bbe","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_vdm"}},{"deprecated":false,"digest":{"function_hash":"248368808974962781852901328475084289247","length":327},"id":"CVE-2025-38268-f161216c","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_exit"}},{"deprecated":false,"digest":{"line_hashes":["188714974399472649811643878239418208300","339100150949879133279189037474905092032","208357371886638143949914132070837251529","59856373665842340914125993990476923124","152506496020623967541644024174437727703","332647661678506769251941288365847835980","198735665838011341426735186396377926829","155918162942787667292195418432176072456","157209072900391278560902895812720934622","84621057074487987538040960165172435840","94081284965112904485733435417326025147","108795789762663448443467999271746228485","12488957672553073425187009815635510838","159797731996757440296900564534105670792","120222832383548645146904551757711820628","327034844309720912874929832847614291183","98807440126849957025798854537276049008","106132921460057212032994653520116806475","194641970952728088500617118686484369055","145150298152895871305525791317513413906","186625083624686272348229459789562228107","91958162602348874955518408288360273610","61462879598972197567367560896283548818","262154208216523489652901932577044293368","210745471063487111252716775529271135072","3645404133930275257194440240863196124","316775995987508006758909091327679079733","262763346080023036891653720000864528579","205643479059138624957301318261594240284","238299788033877547893018100292050384936","89265048342676354127010357499529868394","298311285395621032458390534271038685571","81648211770074669265364064108137850242","142620387568853367014241400702510950181","220887281305769907390953864883302203466","215483706757983784909452937384288736654","229460581345708622974005456495027886757","307909067293468237979768430400028237650","163800297833627596462029872617071404699","168778151669815339076770087719697938160","91164059374008543715693436392486122003","298027641964114220768431963682903550069","274521780201577821351303044648599764743","15628819340171256357469265253329357240","155622838909121060744222435111693620318","40584477670304766020842351246082808164"],"threshold":0.9},"id":"CVE-2025-38268-f48f82dd","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7bdd712abefbec79176ab412d8c623e755c5d0ba","target":{"file":"drivers/usb/typec/tcpm/tcpm.c"}},{"deprecated":false,"digest":{"function_hash":"248368808974962781852901328475084289247","length":327},"id":"CVE-2025-38268-f80864fb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1970d34b48cbeceb0c765984c9a6bb204c77f16a","target":{"file":"drivers/usb/typec/tcpm/tcpm.c","function":"tcpm_altmode_exit"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.9.0"},{"fixed":"6.12.34"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.13.0"},{"fixed":"6.15.3"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-38268.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/1970d34b48cbeceb0c765984c9a6bb204c77f16a"},{"type":"WEB","url":"https://git.kernel.org/stable/c/324d45e53f1a36c88bc649dc39e0c8300a41be0a"},{"type":"WEB","url":"https://git.kernel.org/stable/c/7bdd712abefbec79176ab412d8c623e755c5d0ba"}]}