{"schema_version":"1.7.3","id":"CVE-2022-49167","published":"2025-02-26T01:55:26Z","modified":"2025-10-21T09:08:47.589505Z","summary":"btrfs: do not double complete bio on errors during compressed reads","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: do not double complete bio on errors during compressed reads\n\nI hit some weird panics while fixing up the error handling from\nbtrfs_lookup_bio_sums().  Turns out the compression path will complete\nthe bio we use if we set up any of the compression bios and then return\nan error, and then btrfs_submit_data_bio() will also call bio_endio() on\nthe bio.\n\nFix this by making btrfs_submit_compressed_read() responsible for\ncalling bio_endio() on the bio if there are any errors.  Currently it\nwas only doing it if we created the compression bios, otherwise it was\ndepending on btrfs_submit_data_bio() to do the right thing.  This\ncreates the above problem, so fix up btrfs_submit_compressed_read() to\nalways call bio_endio() in case of an error, and then simply return from\nbtrfs_submit_data_bio() if we had to call\nbtrfs_submit_compressed_read().","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"86ccbb4d2a2af4109430df518c995a4f7d14dfd2"},{"fixed":"4a4ceb2b990771c374d85d496a1a45255dde48e3"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"86ccbb4d2a2af4109430df518c995a4f7d14dfd2"},{"fixed":"987b5df1d10355d377315a26e7fb6c72ded83c9f"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"86ccbb4d2a2af4109430df518c995a4f7d14dfd2"},{"fixed":"f9f15de85d74e7eef021af059ca53a15f041cdd8"}]}],"versions":["v5.15","v5.16","v5.16-rc1","v5.16-rc2","v5.16-rc3","v5.16-rc4","v5.16-rc5","v5.16-rc6","v5.16-rc7","v5.16-rc8","v5.16.1","v5.16.10","v5.16.11","v5.16.12","v5.16.13","v5.16.14","v5.16.15","v5.16.16","v5.16.17","v5.16.18","v5.16.2","v5.16.3","v5.16.4","v5.16.5","v5.16.6","v5.16.7","v5.16.8","v5.16.9","v5.17","v5.17-rc1","v5.17-rc2","v5.17-rc3","v5.17-rc4","v5.17-rc5","v5.17-rc6","v5.17-rc7","v5.17-rc8","v5.17.1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49167.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"191211511160789805401430621563099943744","length":1407},"id":"CVE-2022-49167-0cf36d2a","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f9f15de85d74e7eef021af059ca53a15f041cdd8","target":{"file":"fs/btrfs/inode.c","function":"btrfs_submit_data_bio"}},{"deprecated":false,"digest":{"line_hashes":["273034883841841806820246751990586094665","313267918490382893190628856183495545938","182099905082166147182400406289198063208","153728108002375112171580473811107780828","172129093631326410955083228731327912002","329620220027440493926342923946071569136","49831170501962960391245595998720510381","211874374154804844668005376786747735429","283102424042815107139803791451564294674","281507295268100966136137925907711093628","209689504134279629563163588142156884014","87301416281455074501268120075990288732"],"threshold":0.9},"id":"CVE-2022-49167-0d5861d4","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@987b5df1d10355d377315a26e7fb6c72ded83c9f","target":{"file":"fs/btrfs/inode.c"}},{"deprecated":false,"digest":{"function_hash":"51415581521616964683957646803981546890","length":3340},"id":"CVE-2022-49167-4609d53e","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f9f15de85d74e7eef021af059ca53a15f041cdd8","target":{"file":"fs/btrfs/compression.c","function":"btrfs_submit_compressed_read"}},{"deprecated":false,"digest":{"line_hashes":["274601242158487025843393296169115282951","132379062625991859801611614805507236579","148061640308818874914784549239180408148","232426014833665972587792507293637908750","49825163371629450556759680000101027767","319310829186487486433660512806040917099","23908963199446182405716018692623168863","27468206624197865900348326050251224332","291812569317740169784943393596349374976","315459328948600736745905802668646982619","232819016074789768442342840954010855778","102207557448645792367395491551975293222","187296385684710359092174009381029542438","115590936110967811073310678935210246771","159192409631627151969047837732889546334","28172715045318327626713875373226661075","338951654094900570086568349371868452745","20180596027272646007278978195612435795","188653478391300785108204204785639792761","69763878660200775167637612094978956303","263345382409394899194499349106745826553","1622895623648765133031964599109301386","110714300123808053691803013173968560909","253188818598137915725288582081604895712","325155697774016228049119023933574065433","145719301841549333466932475433436145608","16761334339645258851788439078509690327"],"threshold":0.9},"id":"CVE-2022-49167-63fb3a81","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4a4ceb2b990771c374d85d496a1a45255dde48e3","target":{"file":"fs/btrfs/compression.c"}},{"deprecated":false,"digest":{"line_hashes":["274601242158487025843393296169115282951","132379062625991859801611614805507236579","148061640308818874914784549239180408148","232426014833665972587792507293637908750","49825163371629450556759680000101027767","319310829186487486433660512806040917099","23908963199446182405716018692623168863","27468206624197865900348326050251224332","291812569317740169784943393596349374976","315459328948600736745905802668646982619","232819016074789768442342840954010855778","102207557448645792367395491551975293222","187296385684710359092174009381029542438","115590936110967811073310678935210246771","159192409631627151969047837732889546334","28172715045318327626713875373226661075","338951654094900570086568349371868452745","20180596027272646007278978195612435795","188653478391300785108204204785639792761","69763878660200775167637612094978956303","263345382409394899194499349106745826553","1622895623648765133031964599109301386","110714300123808053691803013173968560909","253188818598137915725288582081604895712","325155697774016228049119023933574065433","145719301841549333466932475433436145608","16761334339645258851788439078509690327"],"threshold":0.9},"id":"CVE-2022-49167-6ad241c7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@987b5df1d10355d377315a26e7fb6c72ded83c9f","target":{"file":"fs/btrfs/compression.c"}},{"deprecated":false,"digest":{"line_hashes":["274601242158487025843393296169115282951","132379062625991859801611614805507236579","148061640308818874914784549239180408148","232426014833665972587792507293637908750","49825163371629450556759680000101027767","319310829186487486433660512806040917099","23908963199446182405716018692623168863","27468206624197865900348326050251224332","291812569317740169784943393596349374976","315459328948600736745905802668646982619","232819016074789768442342840954010855778","102207557448645792367395491551975293222","43006401685665222862027263903314089098","93516118135069428335362629438236166542","159192409631627151969047837732889546334","28172715045318327626713875373226661075","338951654094900570086568349371868452745","20180596027272646007278978195612435795","188653478391300785108204204785639792761","69763878660200775167637612094978956303","263345382409394899194499349106745826553","1622895623648765133031964599109301386","110714300123808053691803013173968560909","253188818598137915725288582081604895712","325155697774016228049119023933574065433","145719301841549333466932475433436145608","16761334339645258851788439078509690327"],"threshold":0.9},"id":"CVE-2022-49167-78860196","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f9f15de85d74e7eef021af059ca53a15f041cdd8","target":{"file":"fs/btrfs/compression.c"}},{"deprecated":false,"digest":{"line_hashes":["273034883841841806820246751990586094665","313267918490382893190628856183495545938","182099905082166147182400406289198063208","153728108002375112171580473811107780828","172129093631326410955083228731327912002","329620220027440493926342923946071569136","49831170501962960391245595998720510381","211874374154804844668005376786747735429","283102424042815107139803791451564294674","281507295268100966136137925907711093628","209689504134279629563163588142156884014","87301416281455074501268120075990288732"],"threshold":0.9},"id":"CVE-2022-49167-8a6dbaef","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4a4ceb2b990771c374d85d496a1a45255dde48e3","target":{"file":"fs/btrfs/inode.c"}},{"deprecated":false,"digest":{"line_hashes":["273034883841841806820246751990586094665","313267918490382893190628856183495545938","182099905082166147182400406289198063208","153728108002375112171580473811107780828","172129093631326410955083228731327912002","329620220027440493926342923946071569136","49831170501962960391245595998720510381","211874374154804844668005376786747735429","283102424042815107139803791451564294674","281507295268100966136137925907711093628","209689504134279629563163588142156884014","87301416281455074501268120075990288732"],"threshold":0.9},"id":"CVE-2022-49167-902bf0f0","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f9f15de85d74e7eef021af059ca53a15f041cdd8","target":{"file":"fs/btrfs/inode.c"}},{"deprecated":false,"digest":{"function_hash":"170973586648979460827774395422404833792","length":1353},"id":"CVE-2022-49167-99d03118","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4a4ceb2b990771c374d85d496a1a45255dde48e3","target":{"file":"fs/btrfs/inode.c","function":"btrfs_submit_data_bio"}},{"deprecated":false,"digest":{"function_hash":"194695245720921494791864823585440027073","length":1391},"id":"CVE-2022-49167-ae9ca1c3","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@987b5df1d10355d377315a26e7fb6c72ded83c9f","target":{"file":"fs/btrfs/inode.c","function":"btrfs_submit_data_bio"}},{"deprecated":false,"digest":{"function_hash":"245367695459425924938201031007346262875","length":3338},"id":"CVE-2022-49167-de9aba18","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4a4ceb2b990771c374d85d496a1a45255dde48e3","target":{"file":"fs/btrfs/compression.c","function":"btrfs_submit_compressed_read"}},{"deprecated":false,"digest":{"function_hash":"245367695459425924938201031007346262875","length":3338},"id":"CVE-2022-49167-e5141739","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@987b5df1d10355d377315a26e7fb6c72ded83c9f","target":{"file":"fs/btrfs/compression.c","function":"btrfs_submit_compressed_read"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"5.16.0"},{"fixed":"5.16.19"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.17.0"},{"fixed":"5.17.2"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49167.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/4a4ceb2b990771c374d85d496a1a45255dde48e3"},{"type":"WEB","url":"https://git.kernel.org/stable/c/987b5df1d10355d377315a26e7fb6c72ded83c9f"},{"type":"WEB","url":"https://git.kernel.org/stable/c/f9f15de85d74e7eef021af059ca53a15f041cdd8"}]}