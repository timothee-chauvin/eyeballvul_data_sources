{"schema_version":"1.7.3","id":"CVE-2024-26899","published":"2024-04-17T10:27:49.089Z","modified":"2025-11-20T03:55:12.548673Z","related":["SUSE-SU-2024:2135-1","SUSE-SU-2024:2203-1","SUSE-SU-2024:2973-1"],"summary":"block: fix deadlock between bd_link_disk_holder and partition scan","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nblock: fix deadlock between bd_link_disk_holder and partition scan\n\n'open_mutex' of gendisk is used to protect open/close block devices. But\nin bd_link_disk_holder(), it is used to protect the creation of symlink\nbetween holding disk and slave bdev, which introduces some issues.\n\nWhen bd_link_disk_holder() is called, the driver is usually in the process\nof initialization/modification and may suspend submitting io. At this\ntime, any io hold 'open_mutex', such as scanning partitions, can cause\ndeadlocks. For example, in raid:\n\nT1                              T2\nbdev_open_by_dev\n lock open_mutex [1]\n ...\n  efi_partition\n  ...\n   md_submit_bio\n\t\t\t\tmd_ioctl mddev_syspend\n\t\t\t\t  -> suspend all io\n\t\t\t\t md_add_new_disk\n\t\t\t\t  bind_rdev_to_array\n\t\t\t\t   bd_link_disk_holder\n\t\t\t\t    try lock open_mutex [2]\n    md_handle_request\n     -> wait mddev_resume\n\nT1 scan partition, T2 add a new device to raid. T1 waits for T2 to resume\nmddev, but T2 waits for open_mutex held by T1. Deadlock occurs.\n\nFix it by introducing a local mutex 'blk_holder_mutex' to replace\n'open_mutex'.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"1b0a2d950ee2a54aa04fb31ead32144be0bbf690"},{"fixed":"1e5c5b0abaee7b62a10b9707a62083b71ad21f62"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"1b0a2d950ee2a54aa04fb31ead32144be0bbf690"},{"fixed":"5a87c1f7993bc8ac358a3766bac5dc7126e01e98"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"1b0a2d950ee2a54aa04fb31ead32144be0bbf690"},{"fixed":"03f12122b20b6e6028e9ed69030a49f9cffcbb75"}]}],"versions":["v6.6","v6.6-rc3","v6.6-rc4","v6.6-rc5","v6.6-rc6","v6.6-rc7","v6.7","v6.7-rc1","v6.7-rc2","v6.7-rc3","v6.7-rc4","v6.7-rc5","v6.7-rc6","v6.7-rc7","v6.7-rc8","v6.7.1","v6.7.10","v6.7.2","v6.7.3","v6.7.4","v6.7.5","v6.7.6","v6.7.7","v6.7.8","v6.7.9","v6.8","v6.8-rc1","v6.8-rc2","v6.8-rc3","v6.8-rc4","v6.8-rc5","v6.8-rc6","v6.8-rc7","v6.8.1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-26899.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["144623170384012242488759726238556545828","295534047913237276863596253176300523503","240503958674240768827191040389591320829","15521143406422847981533786329738769946","231507180559358503172686420553661988998","104736496888728387649230642383029365138","129269318326685757762381687341406290715","133032899872722577065161251196668787388","289985304509443868609028138089495847082","176973930446137978842944552443118600727","115776093519466715734007399727207895186","211175471572417820206384985580396926287","302490667229333499782233352160677108555","191371299274519834867071620986009484874","211687946338251492351060252953984743447","185771762213787757763812153907247753371","255313784954902221942043212075373905379","175217339570051485386407880454249321183","192458195498824734875515962191775507439","241152791065385991170844158723178993261","204348906547774956431767052884387301737","47597651465976268310013758112434925370"],"threshold":0.9},"id":"CVE-2024-26899-1c9d53a9","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@5a87c1f7993bc8ac358a3766bac5dc7126e01e98","target":{"file":"block/holder.c"}},{"deprecated":false,"digest":{"function_hash":"310529392157510557566412927640281399007","length":1358},"id":"CVE-2024-26899-1da4b7c9","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@5a87c1f7993bc8ac358a3766bac5dc7126e01e98","target":{"file":"block/holder.c","function":"bd_link_disk_holder"}},{"deprecated":false,"digest":{"function_hash":"47767414462499993179111135991203067302","length":485},"id":"CVE-2024-26899-31e57af1","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1e5c5b0abaee7b62a10b9707a62083b71ad21f62","target":{"file":"block/holder.c","function":"bd_unlink_disk_holder"}},{"deprecated":false,"digest":{"function_hash":"310529392157510557566412927640281399007","length":1358},"id":"CVE-2024-26899-62bf74a4","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@03f12122b20b6e6028e9ed69030a49f9cffcbb75","target":{"file":"block/holder.c","function":"bd_link_disk_holder"}},{"deprecated":false,"digest":{"function_hash":"47767414462499993179111135991203067302","length":485},"id":"CVE-2024-26899-77cedc5a","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@03f12122b20b6e6028e9ed69030a49f9cffcbb75","target":{"file":"block/holder.c","function":"bd_unlink_disk_holder"}},{"deprecated":false,"digest":{"line_hashes":["144623170384012242488759726238556545828","295534047913237276863596253176300523503","240503958674240768827191040389591320829","15521143406422847981533786329738769946","231507180559358503172686420553661988998","104736496888728387649230642383029365138","129269318326685757762381687341406290715","133032899872722577065161251196668787388","289985304509443868609028138089495847082","176973930446137978842944552443118600727","115776093519466715734007399727207895186","211175471572417820206384985580396926287","302490667229333499782233352160677108555","191371299274519834867071620986009484874","211687946338251492351060252953984743447","185771762213787757763812153907247753371","255313784954902221942043212075373905379","175217339570051485386407880454249321183","192458195498824734875515962191775507439","241152791065385991170844158723178993261","204348906547774956431767052884387301737","47597651465976268310013758112434925370"],"threshold":0.9},"id":"CVE-2024-26899-84029ff7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@03f12122b20b6e6028e9ed69030a49f9cffcbb75","target":{"file":"block/holder.c"}},{"deprecated":false,"digest":{"function_hash":"47767414462499993179111135991203067302","length":485},"id":"CVE-2024-26899-adc9d042","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@5a87c1f7993bc8ac358a3766bac5dc7126e01e98","target":{"file":"block/holder.c","function":"bd_unlink_disk_holder"}},{"deprecated":false,"digest":{"function_hash":"310529392157510557566412927640281399007","length":1358},"id":"CVE-2024-26899-b3be1678","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1e5c5b0abaee7b62a10b9707a62083b71ad21f62","target":{"file":"block/holder.c","function":"bd_link_disk_holder"}},{"deprecated":false,"digest":{"line_hashes":["144623170384012242488759726238556545828","295534047913237276863596253176300523503","240503958674240768827191040389591320829","15521143406422847981533786329738769946","231507180559358503172686420553661988998","104736496888728387649230642383029365138","129269318326685757762381687341406290715","133032899872722577065161251196668787388","289985304509443868609028138089495847082","176973930446137978842944552443118600727","115776093519466715734007399727207895186","211175471572417820206384985580396926287","302490667229333499782233352160677108555","191371299274519834867071620986009484874","211687946338251492351060252953984743447","185771762213787757763812153907247753371","255313784954902221942043212075373905379","175217339570051485386407880454249321183","192458195498824734875515962191775507439","241152791065385991170844158723178993261","204348906547774956431767052884387301737","47597651465976268310013758112434925370"],"threshold":0.9},"id":"CVE-2024-26899-f9cd1640","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1e5c5b0abaee7b62a10b9707a62083b71ad21f62","target":{"file":"block/holder.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.7.0"},{"fixed":"6.7.11"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.8.0"},{"fixed":"6.8.2"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-26899.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/03f12122b20b6e6028e9ed69030a49f9cffcbb75"},{"type":"WEB","url":"https://git.kernel.org/stable/c/1e5c5b0abaee7b62a10b9707a62083b71ad21f62"},{"type":"WEB","url":"https://git.kernel.org/stable/c/5a87c1f7993bc8ac358a3766bac5dc7126e01e98"}]}