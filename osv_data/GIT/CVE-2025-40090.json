{"schema_version":"1.7.3","id":"CVE-2025-40090","published":"2025-10-30T09:47:58Z","modified":"2025-10-30T20:17:52.138238Z","summary":"ksmbd: fix recursive locking in RPC handle list access","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nksmbd: fix recursive locking in RPC handle list access\n\nSince commit 305853cce3794 (\"ksmbd: Fix race condition in RPC handle list\naccess\"), ksmbd_session_rpc_method() attempts to lock sess->rpc_lock.\n\nThis causes hung connections / tasks when a client attempts to open\na named pipe. Using Samba's rpcclient tool:\n\n $ rpcclient //192.168.1.254 -U user%password\n $ rpcclient $> srvinfo\n <connection hung here>\n\nKernel side:\n  \"echo 0 > /proc/sys/kernel/hung_task_timeout_secs\" disables this message.\n  task:kworker/0:0 state:D stack:0 pid:5021 tgid:5021 ppid:2 flags:0x00200000\n  Workqueue: ksmbd-io handle_ksmbd_work\n  Call trace:\n  __schedule from schedule+0x3c/0x58\n  schedule from schedule_preempt_disabled+0xc/0x10\n  schedule_preempt_disabled from rwsem_down_read_slowpath+0x1b0/0x1d8\n  rwsem_down_read_slowpath from down_read+0x28/0x30\n  down_read from ksmbd_session_rpc_method+0x18/0x3c\n  ksmbd_session_rpc_method from ksmbd_rpc_open+0x34/0x68\n  ksmbd_rpc_open from ksmbd_session_rpc_open+0x194/0x228\n  ksmbd_session_rpc_open from create_smb2_pipe+0x8c/0x2c8\n  create_smb2_pipe from smb2_open+0x10c/0x27ac\n  smb2_open from handle_ksmbd_work+0x238/0x3dc\n  handle_ksmbd_work from process_scheduled_works+0x160/0x25c\n  process_scheduled_works from worker_thread+0x16c/0x1e8\n  worker_thread from kthread+0xa8/0xb8\n  kthread from ret_from_fork+0x14/0x38\n  Exception stack(0x8529ffb0 to 0x8529fff8)\n\nThe task deadlocks because the lock is already held:\n  ksmbd_session_rpc_open\n    down_write(&sess->rpc_lock)\n    ksmbd_rpc_open\n      ksmbd_session_rpc_method\n        down_read(&sess->rpc_lock)   <-- deadlock\n\nAdjust ksmbd_session_rpc_method() callers to take the lock when necessary.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"5cc679ba0f4505936124cd4179ba66bb0a4bd9f3"},{"fixed":"4602b8cee1481dbb896182e5cb1e8cf12910e9e7"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"6bd7e0e55dcea2cf0d391bbc21c2eb069b4be3e1"},{"fixed":"3412fbd81b46b9cfae013817b61d4bbd27e09e36"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"305853cce379407090a73b38c5de5ba748893aee"},{"fixed":"88f170814fea74911ceab798a43cbd7c5599bed4"}]}],"versions":["v6.12.53","v6.12.54","v6.17.3","v6.17.4","v6.18-rc1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40090.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["96021204749364966584542177711573619913","214515663918310155488505017428172988328","238863140878012551041849444175745967664","300464257564967120588120411108046183701","73302661699156862296734415072333059478"],"threshold":0.9},"id":"CVE-2025-40090-07659789","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/smb2pdu.c"}},{"deprecated":false,"digest":{"line_hashes":["249864143697886883059662324261924590756","278733888366010807662026664925464364486","119955747174153298479738332272106949220","315992939825814015884110781634547772140","91921240998103474206196157879174927922","319006007827765437032251902667668894533","3486962579741110565173303880640451670","333309062506864117423429858801852942118","278733888366010807662026664925464364486","119955747174153298479738332272106949220","210665332225795822823594698946552593079","198405648008637553909338336481088519126","156631734870233351414408501094687232047","208411733612884073872835761812172120286","249864143697886883059662324261924590756","278733888366010807662026664925464364486","119955747174153298479738332272106949220","212133270511675159597655365613553801967","27872096558123629791468150831861479887","319006007827765437032251902667668894533","3486962579741110565173303880640451670"],"threshold":0.9},"id":"CVE-2025-40090-09509ef5","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/transport_ipc.c"}},{"deprecated":false,"digest":{"line_hashes":["88219017169389381119464766461819832481","180013795881411335744720297564804949997","281794304238132113756763424955227804949","250867690380900348623248297079762812086","157437960169374157717139780517252441604","199593921785895733941408572893654913347","328042009594636002325069335830070628747","195344169332162232493456467590075959051","334737573956258792779441963265899267981"],"threshold":0.9},"id":"CVE-2025-40090-1af2af8e","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/mgmt/user_session.c"}},{"deprecated":false,"digest":{"function_hash":"300853847184096038545159488445490000329","length":609},"id":"CVE-2025-40090-3132388c","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_ioctl"}},{"deprecated":false,"digest":{"line_hashes":["249864143697886883059662324261924590756","278733888366010807662026664925464364486","119955747174153298479738332272106949220","315992939825814015884110781634547772140","91921240998103474206196157879174927922","319006007827765437032251902667668894533","3486962579741110565173303880640451670","333309062506864117423429858801852942118","278733888366010807662026664925464364486","119955747174153298479738332272106949220","210665332225795822823594698946552593079","198405648008637553909338336481088519126","156631734870233351414408501094687232047","208411733612884073872835761812172120286","249864143697886883059662324261924590756","278733888366010807662026664925464364486","119955747174153298479738332272106949220","212133270511675159597655365613553801967","27872096558123629791468150831861479887","319006007827765437032251902667668894533","3486962579741110565173303880640451670"],"threshold":0.9},"id":"CVE-2025-40090-39397c9f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/transport_ipc.c"}},{"deprecated":false,"digest":{"line_hashes":["88219017169389381119464766461819832481","180013795881411335744720297564804949997","281794304238132113756763424955227804949","250867690380900348623248297079762812086","157437960169374157717139780517252441604","199593921785895733941408572893654913347","328042009594636002325069335830070628747","195344169332162232493456467590075959051","334737573956258792779441963265899267981"],"threshold":0.9},"id":"CVE-2025-40090-3cd8b90f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/mgmt/user_session.c"}},{"deprecated":false,"digest":{"line_hashes":["249864143697886883059662324261924590756","278733888366010807662026664925464364486","119955747174153298479738332272106949220","315992939825814015884110781634547772140","91921240998103474206196157879174927922","319006007827765437032251902667668894533","3486962579741110565173303880640451670","333309062506864117423429858801852942118","278733888366010807662026664925464364486","119955747174153298479738332272106949220","210665332225795822823594698946552593079","198405648008637553909338336481088519126","156631734870233351414408501094687232047","208411733612884073872835761812172120286","249864143697886883059662324261924590756","278733888366010807662026664925464364486","119955747174153298479738332272106949220","212133270511675159597655365613553801967","27872096558123629791468150831861479887","319006007827765437032251902667668894533","3486962579741110565173303880640451670"],"threshold":0.9},"id":"CVE-2025-40090-40f1116b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/transport_ipc.c"}},{"deprecated":false,"digest":{"function_hash":"7170116706448462544796245870908358522","length":782},"id":"CVE-2025-40090-50d59526","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/smb2pdu.c","function":"smb2_get_info_file_pipe"}},{"deprecated":false,"digest":{"function_hash":"89059742343441579241120954380530398049","length":244},"id":"CVE-2025-40090-543ddf60","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/mgmt/user_session.c","function":"ksmbd_session_rpc_method"}},{"deprecated":false,"digest":{"function_hash":"89059742343441579241120954380530398049","length":244},"id":"CVE-2025-40090-5444fa3d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/mgmt/user_session.c","function":"ksmbd_session_rpc_method"}},{"deprecated":false,"digest":{"line_hashes":["96021204749364966584542177711573619913","214515663918310155488505017428172988328","238863140878012551041849444175745967664","300464257564967120588120411108046183701","73302661699156862296734415072333059478"],"threshold":0.9},"id":"CVE-2025-40090-5527cbb7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/smb2pdu.c"}},{"deprecated":false,"digest":{"function_hash":"227922690281999263416538665168431273370","length":609},"id":"CVE-2025-40090-5943061a","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_write"}},{"deprecated":false,"digest":{"function_hash":"227922690281999263416538665168431273370","length":609},"id":"CVE-2025-40090-7248b500","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_write"}},{"deprecated":false,"digest":{"function_hash":"300853847184096038545159488445490000329","length":609},"id":"CVE-2025-40090-7b8d21d0","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_ioctl"}},{"deprecated":false,"digest":{"function_hash":"89059742343441579241120954380530398049","length":244},"id":"CVE-2025-40090-8883cb6f","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/mgmt/user_session.c","function":"ksmbd_session_rpc_method"}},{"deprecated":false,"digest":{"function_hash":"7170116706448462544796245870908358522","length":782},"id":"CVE-2025-40090-95d32e4b","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/smb2pdu.c","function":"smb2_get_info_file_pipe"}},{"deprecated":false,"digest":{"line_hashes":["88219017169389381119464766461819832481","180013795881411335744720297564804949997","281794304238132113756763424955227804949","250867690380900348623248297079762812086","157437960169374157717139780517252441604","199593921785895733941408572893654913347","328042009594636002325069335830070628747","195344169332162232493456467590075959051","334737573956258792779441963265899267981"],"threshold":0.9},"id":"CVE-2025-40090-a3c1305e","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/mgmt/user_session.c"}},{"deprecated":false,"digest":{"function_hash":"7170116706448462544796245870908358522","length":782},"id":"CVE-2025-40090-b2b25a77","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/smb2pdu.c","function":"smb2_get_info_file_pipe"}},{"deprecated":false,"digest":{"function_hash":"336908577648504256989312537936101666026","length":474},"id":"CVE-2025-40090-bd3cd0bb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_read"}},{"deprecated":false,"digest":{"function_hash":"336908577648504256989312537936101666026","length":474},"id":"CVE-2025-40090-dc795ec5","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_read"}},{"deprecated":false,"digest":{"function_hash":"227922690281999263416538665168431273370","length":609},"id":"CVE-2025-40090-ddd1393d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_write"}},{"deprecated":false,"digest":{"line_hashes":["96021204749364966584542177711573619913","214515663918310155488505017428172988328","238863140878012551041849444175745967664","300464257564967120588120411108046183701","73302661699156862296734415072333059478"],"threshold":0.9},"id":"CVE-2025-40090-e5d1b864","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3412fbd81b46b9cfae013817b61d4bbd27e09e36","target":{"file":"fs/smb/server/smb2pdu.c"}},{"deprecated":false,"digest":{"function_hash":"300853847184096038545159488445490000329","length":609},"id":"CVE-2025-40090-e7d0b9e5","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4602b8cee1481dbb896182e5cb1e8cf12910e9e7","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_ioctl"}},{"deprecated":false,"digest":{"function_hash":"336908577648504256989312537936101666026","length":474},"id":"CVE-2025-40090-e933af68","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@88f170814fea74911ceab798a43cbd7c5599bed4","target":{"file":"fs/smb/server/transport_ipc.c","function":"ksmbd_rpc_read"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.18-rc1.0"},{"fixed":"6.12.55"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.13.0"},{"fixed":"6.17.5"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40090.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/3412fbd81b46b9cfae013817b61d4bbd27e09e36"},{"type":"WEB","url":"https://git.kernel.org/stable/c/4602b8cee1481dbb896182e5cb1e8cf12910e9e7"},{"type":"WEB","url":"https://git.kernel.org/stable/c/88f170814fea74911ceab798a43cbd7c5599bed4"}]}