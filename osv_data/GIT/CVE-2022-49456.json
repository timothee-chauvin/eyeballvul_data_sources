{"schema_version":"1.7.3","id":"CVE-2022-49456","published":"2025-02-26T02:13:04Z","modified":"2025-10-21T10:01:11.291673Z","summary":"bonding: fix missed rcu protection","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nbonding: fix missed rcu protection\n\nWhen removing the rcu_read_lock in bond_ethtool_get_ts_info() as\ndiscussed [1], I didn't notice it could be called via setsockopt,\nwhich doesn't hold rcu lock, as syzbot pointed:\n\n  stack backtrace:\n  CPU: 0 PID: 3599 Comm: syz-executor317 Not tainted 5.18.0-rc5-syzkaller-01392-g01f4685797a5 #0\n  Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011\n  Call Trace:\n   <TASK>\n   __dump_stack lib/dump_stack.c:88 [inline]\n   dump_stack_lvl+0xcd/0x134 lib/dump_stack.c:106\n   bond_option_active_slave_get_rcu include/net/bonding.h:353 [inline]\n   bond_ethtool_get_ts_info+0x32c/0x3a0 drivers/net/bonding/bond_main.c:5595\n   __ethtool_get_ts_info+0x173/0x240 net/ethtool/common.c:554\n   ethtool_get_phc_vclocks+0x99/0x110 net/ethtool/common.c:568\n   sock_timestamping_bind_phc net/core/sock.c:869 [inline]\n   sock_set_timestamping+0x3a3/0x7e0 net/core/sock.c:916\n   sock_setsockopt+0x543/0x2ec0 net/core/sock.c:1221\n   __sys_setsockopt+0x55e/0x6a0 net/socket.c:2223\n   __do_sys_setsockopt net/socket.c:2238 [inline]\n   __se_sys_setsockopt net/socket.c:2235 [inline]\n   __x64_sys_setsockopt+0xba/0x150 net/socket.c:2235\n   do_syscall_x64 arch/x86/entry/common.c:50 [inline]\n   do_syscall_64+0x35/0xb0 arch/x86/entry/common.c:80\n   entry_SYSCALL_64_after_hwframe+0x44/0xae\n  RIP: 0033:0x7f8902c8eb39\n\nFix it by adding rcu_read_lock and take a ref on the real_dev.\nSince dev_hold() and dev_put() can take NULL these days, we can\nskip checking if real_dev exist.\n\n[1] https://lore.kernel.org/netdev/27565.1642742439@famine/","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"aa6034678e873db8bd5c5a4b73f8b88c469374d6"},{"fixed":"1b66a533c47d29b38af8e05fbb53b609a5ba3a4e"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"aa6034678e873db8bd5c5a4b73f8b88c469374d6"},{"fixed":"85eed460681da71b359ed906bce4d800081db854"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"aa6034678e873db8bd5c5a4b73f8b88c469374d6"},{"fixed":"9b80ccda233fa6c59de411bf889cc4d0e028f2c7"}]}],"versions":["v5.17","v5.17-rc1","v5.17-rc2","v5.17-rc3","v5.17-rc4","v5.17-rc5","v5.17-rc6","v5.17-rc7","v5.17-rc8","v5.17.1","v5.17.10","v5.17.11","v5.17.12","v5.17.13","v5.17.2","v5.17.3","v5.17.4","v5.17.5","v5.17.6","v5.17.7","v5.17.8","v5.17.9","v5.18","v5.18-rc1","v5.18-rc2","v5.18-rc3","v5.18-rc4","v5.18-rc5","v5.18-rc6","v5.18-rc7","v5.18.1","v5.18.2"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49456.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["63965202380944526163464191170257823078","181164593222702503428189201057752568633","299045688979645112293123869595439437283","164308435764649873870943161864753272041","49957418099920214711282473582921048657","141545734351444798453916001075240019514","83849749561980397563074493476386264589","39491345016424575628361834275520757796","284865230974320464270026598789653535345","33730612378545929024354936195499817363","102680299177872756561299571070080427214","292710419454595902052645437660783454803","282431019911210945654735340990126608526","308331348348247348472120554805653151222","287405295643290153052966071686868554671","174365747571880086861375357278618739646"],"threshold":0.9},"id":"CVE-2022-49456-24044e39","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@9b80ccda233fa6c59de411bf889cc4d0e028f2c7","target":{"file":"drivers/net/bonding/bond_main.c"}},{"deprecated":false,"digest":{"line_hashes":["63965202380944526163464191170257823078","181164593222702503428189201057752568633","299045688979645112293123869595439437283","164308435764649873870943161864753272041","49957418099920214711282473582921048657","141545734351444798453916001075240019514","83849749561980397563074493476386264589","39491345016424575628361834275520757796","284865230974320464270026598789653535345","33730612378545929024354936195499817363","102680299177872756561299571070080427214","292710419454595902052645437660783454803","282431019911210945654735340990126608526","308331348348247348472120554805653151222","287405295643290153052966071686868554671","174365747571880086861375357278618739646"],"threshold":0.9},"id":"CVE-2022-49456-25955708","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@85eed460681da71b359ed906bce4d800081db854","target":{"file":"drivers/net/bonding/bond_main.c"}},{"deprecated":false,"digest":{"function_hash":"127726246800266807674219505738830780765","length":493},"id":"CVE-2022-49456-3ba404bf","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@85eed460681da71b359ed906bce4d800081db854","target":{"file":"drivers/net/bonding/bond_main.c","function":"bond_ethtool_get_ts_info"}},{"deprecated":false,"digest":{"function_hash":"127726246800266807674219505738830780765","length":493},"id":"CVE-2022-49456-9abbf04c","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1b66a533c47d29b38af8e05fbb53b609a5ba3a4e","target":{"file":"drivers/net/bonding/bond_main.c","function":"bond_ethtool_get_ts_info"}},{"deprecated":false,"digest":{"line_hashes":["63965202380944526163464191170257823078","181164593222702503428189201057752568633","299045688979645112293123869595439437283","164308435764649873870943161864753272041","49957418099920214711282473582921048657","141545734351444798453916001075240019514","83849749561980397563074493476386264589","39491345016424575628361834275520757796","284865230974320464270026598789653535345","33730612378545929024354936195499817363","102680299177872756561299571070080427214","292710419454595902052645437660783454803","282431019911210945654735340990126608526","308331348348247348472120554805653151222","287405295643290153052966071686868554671","174365747571880086861375357278618739646"],"threshold":0.9},"id":"CVE-2022-49456-9fb4e09d","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1b66a533c47d29b38af8e05fbb53b609a5ba3a4e","target":{"file":"drivers/net/bonding/bond_main.c"}},{"deprecated":false,"digest":{"function_hash":"127726246800266807674219505738830780765","length":493},"id":"CVE-2022-49456-d64ec78a","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@9b80ccda233fa6c59de411bf889cc4d0e028f2c7","target":{"file":"drivers/net/bonding/bond_main.c","function":"bond_ethtool_get_ts_info"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"5.17.0"},{"fixed":"5.17.14"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.18.0"},{"fixed":"5.18.3"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49456.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/1b66a533c47d29b38af8e05fbb53b609a5ba3a4e"},{"type":"WEB","url":"https://git.kernel.org/stable/c/85eed460681da71b359ed906bce4d800081db854"},{"type":"WEB","url":"https://git.kernel.org/stable/c/9b80ccda233fa6c59de411bf889cc4d0e028f2c7"}]}