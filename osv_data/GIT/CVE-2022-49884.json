{"schema_version":"1.7.3","id":"CVE-2022-49884","published":"2025-05-01T14:10:30Z","modified":"2025-10-21T11:18:55.065510Z","summary":"KVM: Initialize gfn_to_pfn_cache locks in dedicated helper","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nKVM: Initialize gfn_to_pfn_cache locks in dedicated helper\n\nMove the gfn_to_pfn_cache lock initialization to another helper and\ncall the new helper during VM/vCPU creation.  There are race\nconditions possible due to kvm_gfn_to_pfn_cache_init()'s\nability to re-initialize the cache's locks.\n\nFor example: a race between ioctl(KVM_XEN_HVM_EVTCHN_SEND) and\nkvm_gfn_to_pfn_cache_init() leads to a corrupted shinfo gpc lock.\n\n                (thread 1)                |           (thread 2)\n                                          |\n kvm_xen_set_evtchn_fast                  |\n  read_lock_irqsave(&gpc->lock, ...)      |\n                                          | kvm_gfn_to_pfn_cache_init\n                                          |  rwlock_init(&gpc->lock)\n  read_unlock_irqrestore(&gpc->lock, ...) |\n\nRename \"cache_init\" and \"cache_destroy\" to activate+deactivate to\navoid implying that the cache really is destroyed/freed.\n\nNote, there more races in the newly named kvm_gpc_activate() that will\nbe addressed separately.\n\n[sean: call out that this is a bug fix]","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"982ed0de4753ed6e71dbd40f82a5a066baf133ed"},{"fixed":"61242001d6c9c253df7645dab090842d8da08764"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"982ed0de4753ed6e71dbd40f82a5a066baf133ed"},{"fixed":"52491a38b2c2411f3f0229dc6ad610349c704a41"}]}],"versions":["v5.16","v5.16-rc5","v5.16-rc6","v5.16-rc7","v5.16-rc8","v5.17","v5.17-rc1","v5.17-rc2","v5.17-rc3","v5.17-rc4","v5.17-rc5","v5.17-rc6","v5.17-rc7","v5.17-rc8","v5.18","v5.18-rc1","v5.18-rc2","v5.18-rc3","v5.18-rc4","v5.18-rc5","v5.18-rc6","v5.18-rc7","v5.19","v5.19-rc1","v5.19-rc2","v5.19-rc3","v5.19-rc4","v5.19-rc5","v5.19-rc6","v5.19-rc7","v5.19-rc8","v6.0","v6.0-rc1","v6.0-rc2","v6.0-rc3","v6.0-rc4","v6.0-rc5","v6.0-rc6","v6.0-rc7","v6.0.1","v6.0.2","v6.0.3","v6.0.4","v6.0.5","v6.0.6","v6.0.7","v6.1-rc1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49884.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"207001005690324871886435271242569536000","length":659},"id":"CVE-2022-49884-0135b91d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"virt/kvm/pfncache.c","function":"kvm_gfn_to_pfn_cache_init"}},{"deprecated":false,"digest":{"line_hashes":["92843798787987079630515876038161890583","173447519762870352114194689229827821927","322374695443839988466712667181019189780","294924849905820000336216195374095990678","320563900375352781068926607662812807254","270559654542771057023734267246388278273","318430399537401574132737816640596909660","298918297259145210241043347766489742704","126072565220027303566272938379950416565","265439750108440669413233305292715387583","134158804574112559431322846801483033402","256596352815579493887016866177543719869","17868785865123160313014410912900681702","238985074986678749396923158398650391393","256509611143288708747213531479788904424"],"threshold":0.9},"id":"CVE-2022-49884-2592b850","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"arch/x86/kvm/x86.c"}},{"deprecated":false,"digest":{"function_hash":"181571700387700471375029077435833824779","length":203},"id":"CVE-2022-49884-41beb63d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"arch/x86/kvm/xen.c","function":"kvm_xen_init_vcpu"}},{"deprecated":false,"digest":{"line_hashes":["140786695271395521030738395190442362917","322070814364474913033735170572304876890","336508190982948804908167369187537671338","76287009076148823388873836442290784910","97759483682535225948364482936994237460","325104547830049959146213669867652122880","198147231693912879488678413028141805162","236109881035003473876004928129049661898","90431421757062929856863249910172938334","174811094747749889222959573903200579192","105405870777102626992956759625709647314","26279437496518554607727621113741562831","291374368303840256410097302240817282026","287689772607780322809717255251282021919","325506392214703887375961757198451220747","118553956041597708379620025551968877649","48424298861729835180882876626367013670"],"threshold":0.9},"id":"CVE-2022-49884-4bbab468","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"virt/kvm/pfncache.c"}},{"deprecated":false,"digest":{"function_hash":"321303393589043053918082076562642217039","length":88},"id":"CVE-2022-49884-57de5455","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"arch/x86/kvm/xen.c","function":"kvm_xen_init_vm"}},{"deprecated":false,"digest":{"function_hash":"321303393589043053918082076562642217039","length":88},"id":"CVE-2022-49884-669ff8b3","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"arch/x86/kvm/xen.c","function":"kvm_xen_init_vm"}},{"deprecated":false,"digest":{"line_hashes":["140786695271395521030738395190442362917","322070814364474913033735170572304876890","336508190982948804908167369187537671338","76287009076148823388873836442290784910","97759483682535225948364482936994237460","325104547830049959146213669867652122880","198147231693912879488678413028141805162","236109881035003473876004928129049661898","90431421757062929856863249910172938334","174811094747749889222959573903200579192","105405870777102626992956759625709647314","26279437496518554607727621113741562831","291374368303840256410097302240817282026","287689772607780322809717255251282021919","325506392214703887375961757198451220747","118553956041597708379620025551968877649","48424298861729835180882876626367013670"],"threshold":0.9},"id":"CVE-2022-49884-736d753d","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"virt/kvm/pfncache.c"}},{"deprecated":false,"digest":{"line_hashes":["278326329426130382547416141890155301045","66834666140918215513607181748328383516","259917242621865973391609889038042874709","100759719789869369603875459303234384943","30849147917227260027936880930450324935","177016156498998843203656590455083323154","10665983053127835350780736557312348934","6097018891444120118754566151031380317","79466968965569172155257286301205456744","160230578880877584070935169872244051867","162184640941109370686875924416587048512","251480961931948923299987376917916827340","211370798714612101795812677377962139445","160897196038602829501754251738923220864","287266950439379148993931790554579725519","331410597314996564444861030676381476892","191949684100402744497192853116914303504","110025608092146571404110243174832661013","258385158959211567991607171694630166160","252434246949192060619742808368837811991","12113214973355870739947061424792688781","140277103490616323170935883699299676466","161344770948243538751121618902307065192","200322460932178305721034079036972578148","218680801858229856770405558697382535612","160897196038602829501754251738923220864","149281154777760676615225288390739085212","57494014902897709445587294664538663758","283514948545556374748937944641313657222","298116525578255542334946560582116280559","28817698135007729497374085125173447173","224658652202326010224251455305762862745","145500123702014925180355312967398340946","24065963287264092957188425619893074815","79509294556133206641288600116068089315","105248715317604110099363099500481779623","209846199177264851066347316856395395990","160897196038602829501754251738923220864","200174249520408145748233470634690417014","78854255182133901770967936134218638136","153825410247826175754233594613356486648","120223936024073818013374312655579758794","210010549776303441536870130118704491329","4245978376309411366177488366240885804","263588982604734582516584769972512675991","296208135481749631274364224392868702855","213526962883679248955311117003842615460","262520103424814243113935833389398555939","70045585592114905371261396448183006860","267422915811778858607632094854852703264","136399997004006112377061545306537415953","161894303297560707664865653531569695135","62709028154277808393579669211556408070","100085736591680248558151640559353960387","323094078195824090196083039538226026698","259375793864322479686278213113140169904","26867137591605895737396038239637275710","206516226196595993377156746152837967835","224518037816095529656251225759061002108","75142144046921226446524828502322295722","44633751897124943487167090831690852330","27129756251251380107946157405255271991","309936106083523184942106017389120878391","314862182366859650963902527415111901593","152746714784489154133732186678580521714","20088303958416731756336218753440621553","216976277838985773151502665817349362080"],"threshold":0.9},"id":"CVE-2022-49884-8276d70b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"arch/x86/kvm/xen.c"}},{"deprecated":false,"digest":{"line_hashes":["96386173556429560814396446124770316695","92157531547250172742507366656476725293","297320968110975513280154119271792039543","262949603915732560209411200298733668312","238906767704490757908069366805167733893","319935459620701239850403365581089328677","112180866403199398370818960704065670529","62076038944497426414843460167340312086","285247605614893453116985514289396893892","142129781609751875911295136944231043795"],"threshold":0.9},"id":"CVE-2022-49884-8f5fbfb6","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"include/linux/kvm_host.h"}},{"deprecated":false,"digest":{"line_hashes":["92843798787987079630515876038161890583","173447519762870352114194689229827821927","322374695443839988466712667181019189780","294924849905820000336216195374095990678","320563900375352781068926607662812807254","270559654542771057023734267246388278273","318430399537401574132737816640596909660","298918297259145210241043347766489742704","126072565220027303566272938379950416565","265439750108440669413233305292715387583","134158804574112559431322846801483033402","256596352815579493887016866177543719869","17868785865123160313014410912900681702","238985074986678749396923158398650391393","256509611143288708747213531479788904424"],"threshold":0.9},"id":"CVE-2022-49884-94f30101","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"arch/x86/kvm/x86.c"}},{"deprecated":false,"digest":{"function_hash":"15581465320199206290131529384412320546","length":2743},"id":"CVE-2022-49884-984369d4","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"arch/x86/kvm/x86.c","function":"kvm_arch_vcpu_create"}},{"deprecated":false,"digest":{"function_hash":"181571700387700471375029077435833824779","length":203},"id":"CVE-2022-49884-a6422244","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"arch/x86/kvm/xen.c","function":"kvm_xen_init_vcpu"}},{"deprecated":false,"digest":{"function_hash":"207001005690324871886435271242569536000","length":659},"id":"CVE-2022-49884-c2c80a35","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"virt/kvm/pfncache.c","function":"kvm_gfn_to_pfn_cache_init"}},{"deprecated":false,"digest":{"line_hashes":["278326329426130382547416141890155301045","66834666140918215513607181748328383516","259917242621865973391609889038042874709","100759719789869369603875459303234384943","30849147917227260027936880930450324935","177016156498998843203656590455083323154","10665983053127835350780736557312348934","6097018891444120118754566151031380317","79466968965569172155257286301205456744","160230578880877584070935169872244051867","162184640941109370686875924416587048512","251480961931948923299987376917916827340","211370798714612101795812677377962139445","160897196038602829501754251738923220864","287266950439379148993931790554579725519","331410597314996564444861030676381476892","191949684100402744497192853116914303504","110025608092146571404110243174832661013","258385158959211567991607171694630166160","252434246949192060619742808368837811991","12113214973355870739947061424792688781","140277103490616323170935883699299676466","161344770948243538751121618902307065192","200322460932178305721034079036972578148","218680801858229856770405558697382535612","160897196038602829501754251738923220864","149281154777760676615225288390739085212","57494014902897709445587294664538663758","283514948545556374748937944641313657222","298116525578255542334946560582116280559","28817698135007729497374085125173447173","224658652202326010224251455305762862745","145500123702014925180355312967398340946","24065963287264092957188425619893074815","79509294556133206641288600116068089315","105248715317604110099363099500481779623","209846199177264851066347316856395395990","160897196038602829501754251738923220864","200174249520408145748233470634690417014","78854255182133901770967936134218638136","153825410247826175754233594613356486648","120223936024073818013374312655579758794","210010549776303441536870130118704491329","4245978376309411366177488366240885804","263588982604734582516584769972512675991","296208135481749631274364224392868702855","213526962883679248955311117003842615460","262520103424814243113935833389398555939","70045585592114905371261396448183006860","267422915811778858607632094854852703264","136399997004006112377061545306537415953","161894303297560707664865653531569695135","62709028154277808393579669211556408070","100085736591680248558151640559353960387","323094078195824090196083039538226026698","259375793864322479686278213113140169904","26867137591605895737396038239637275710","206516226196595993377156746152837967835","224518037816095529656251225759061002108","75142144046921226446524828502322295722","44633751897124943487167090831690852330","27129756251251380107946157405255271991","309936106083523184942106017389120878391","314862182366859650963902527415111901593","152746714784489154133732186678580521714","20088303958416731756336218753440621553","216976277838985773151502665817349362080"],"threshold":0.9},"id":"CVE-2022-49884-d17d9418","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"arch/x86/kvm/xen.c"}},{"deprecated":false,"digest":{"function_hash":"15581465320199206290131529384412320546","length":2743},"id":"CVE-2022-49884-d18ac80c","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@52491a38b2c2411f3f0229dc6ad610349c704a41","target":{"file":"arch/x86/kvm/x86.c","function":"kvm_arch_vcpu_create"}},{"deprecated":false,"digest":{"line_hashes":["96386173556429560814396446124770316695","92157531547250172742507366656476725293","297320968110975513280154119271792039543","262949603915732560209411200298733668312","238906767704490757908069366805167733893","319935459620701239850403365581089328677","112180866403199398370818960704065670529","62076038944497426414843460167340312086","285247605614893453116985514289396893892","142129781609751875911295136944231043795"],"threshold":0.9},"id":"CVE-2022-49884-fab8d895","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@61242001d6c9c253df7645dab090842d8da08764","target":{"file":"include/linux/kvm_host.h"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"5.17.0"},{"fixed":"6.0.8"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49884.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/52491a38b2c2411f3f0229dc6ad610349c704a41"},{"type":"WEB","url":"https://git.kernel.org/stable/c/61242001d6c9c253df7645dab090842d8da08764"}]}