{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-36003.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "260979978875819929840357666146077362693",
                "307448918785465380783704426582826014573",
                "176529348233401019252218121924820143442",
                "103661022322080008958331381529448195095",
                "34079280701814842258042657312857158425",
                "96621079036082677015028348400393349231",
                "27669310216924770886419841916647327973",
                "312783046120629000919021889797662880453",
                "161284685274918710588188632949399703835",
                "22599628997792052966416102169146944612",
                "165332734162591325117502911534444000438",
                "258228625005933383459512510468362126032",
                "258942766467544456770934847604891853841",
                "2611134666252057412638134712312811256",
                "11317342458174631009542691271700190469",
                "131563898095057057877654728415814310593",
                "308685080061349643288651709200377497907",
                "233367531805492547004561401936609485609",
                "187228059986135527915957586882619529634"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-36003-3ab8b093",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@de8631d8c9df08440268630200e64b623a5f69e6",
            "target": {
              "file": "drivers/net/ethernet/intel/ice/ice_vf_lib.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "260979978875819929840357666146077362693",
                "307448918785465380783704426582826014573",
                "176529348233401019252218121924820143442",
                "103661022322080008958331381529448195095",
                "34079280701814842258042657312857158425",
                "96621079036082677015028348400393349231",
                "27669310216924770886419841916647327973",
                "312783046120629000919021889797662880453",
                "161284685274918710588188632949399703835",
                "22599628997792052966416102169146944612",
                "165332734162591325117502911534444000438",
                "258228625005933383459512510468362126032",
                "258942766467544456770934847604891853841",
                "2611134666252057412638134712312811256",
                "11317342458174631009542691271700190469",
                "131563898095057057877654728415814310593",
                "308685080061349643288651709200377497907",
                "233367531805492547004561401936609485609",
                "187228059986135527915957586882619529634"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-36003-81a6de31",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@96fdd1f6b4ed72a741fb0eb705c0e13049b8721f",
            "target": {
              "file": "drivers/net/ethernet/intel/ice/ice_vf_lib.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "135052612585630803054248710833492676073",
              "length": 2522.0
            },
            "id": "CVE-2024-36003-a1428521",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@96fdd1f6b4ed72a741fb0eb705c0e13049b8721f",
            "target": {
              "file": "drivers/net/ethernet/intel/ice/ice_vf_lib.c",
              "function": "ice_reset_vf"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "135052612585630803054248710833492676073",
              "length": 2522.0
            },
            "id": "CVE-2024-36003-bd1e48c4",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@de8631d8c9df08440268630200e64b623a5f69e6",
            "target": {
              "file": "drivers/net/ethernet/intel/ice/ice_vf_lib.c",
              "function": "ice_reset_vf"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "260979978875819929840357666146077362693",
                "307448918785465380783704426582826014573",
                "176529348233401019252218121924820143442",
                "103661022322080008958331381529448195095",
                "34079280701814842258042657312857158425",
                "96621079036082677015028348400393349231",
                "27669310216924770886419841916647327973",
                "312783046120629000919021889797662880453",
                "161284685274918710588188632949399703835",
                "22599628997792052966416102169146944612",
                "6743928319260202787485036484240343755",
                "258228625005933383459512510468362126032",
                "258942766467544456770934847604891853841",
                "2611134666252057412638134712312811256",
                "11317342458174631009542691271700190469",
                "131563898095057057877654728415814310593",
                "308685080061349643288651709200377497907",
                "233367531805492547004561401936609485609",
                "187228059986135527915957586882619529634"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-36003-c10f40c2",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@740717774dc37338404d10726967d582414f638c",
            "target": {
              "file": "drivers/net/ethernet/intel/ice/ice_vf_lib.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "301070241781449074295952228971925667278",
              "length": 2503.0
            },
            "id": "CVE-2024-36003-ef4c85cb",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@740717774dc37338404d10726967d582414f638c",
            "target": {
              "file": "drivers/net/ethernet/intel/ice/ice_vf_lib.c",
              "function": "ice_reset_vf"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "fd7f7a8ad3363fd94fc3868616cc70a1d8dfc01b"
            },
            {
              "fixed": "740717774dc37338404d10726967d582414f638c"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "9f74a3dfcf83e11aedcb98250b8040dbc6d9659a"
            },
            {
              "fixed": "de8631d8c9df08440268630200e64b623a5f69e6"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "9f74a3dfcf83e11aedcb98250b8040dbc6d9659a"
            },
            {
              "fixed": "96fdd1f6b4ed72a741fb0eb705c0e13049b8721f"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v6.6.10",
        "v6.6.11",
        "v6.6.12",
        "v6.6.13",
        "v6.6.14",
        "v6.6.15",
        "v6.6.16",
        "v6.6.17",
        "v6.6.18",
        "v6.6.19",
        "v6.6.20",
        "v6.6.21",
        "v6.6.22",
        "v6.6.23",
        "v6.6.24",
        "v6.6.25",
        "v6.6.26",
        "v6.6.27",
        "v6.6.28",
        "v6.6.29",
        "v6.6.5",
        "v6.6.6",
        "v6.6.7",
        "v6.6.8",
        "v6.6.9",
        "v6.7",
        "v6.7-rc3",
        "v6.7-rc4",
        "v6.7-rc5",
        "v6.7-rc6",
        "v6.7-rc7",
        "v6.7-rc8",
        "v6.8",
        "v6.8-rc1",
        "v6.8-rc2",
        "v6.8-rc3",
        "v6.8-rc4",
        "v6.8-rc5",
        "v6.8-rc6",
        "v6.8-rc7",
        "v6.8.1",
        "v6.8.2",
        "v6.8.3",
        "v6.8.4",
        "v6.8.5",
        "v6.8.6",
        "v6.8.7",
        "v6.8.8",
        "v6.9-rc1",
        "v6.9-rc2",
        "v6.9-rc3",
        "v6.9-rc4"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-36003.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "6.6.30"
            }
          ],
          "type": "ECOSYSTEM"
        },
        {
          "events": [
            {
              "introduced": "6.7.0"
            },
            {
              "fixed": "6.8.9"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nice: fix LAG and VF lock dependency in ice_reset_vf()\n\n9f74a3dfcf83 (\"ice: Fix VF Reset paths when interface in a failed over\naggregate\"), the ice driver has acquired the LAG mutex in ice_reset_vf().\nThe commit placed this lock acquisition just prior to the acquisition of\nthe VF configuration lock.\n\nIf ice_reset_vf() acquires the configuration lock via the ICE_VF_RESET_LOCK\nflag, this could deadlock with ice_vc_cfg_qs_msg() because it always\nacquires the locks in the order of the VF configuration lock and then the\nLAG mutex.\n\nLockdep reports this violation almost immediately on creating and then\nremoving 2 VF:\n\n======================================================\nWARNING: possible circular locking dependency detected\n6.8.0-rc6 #54 Tainted: G        W  O\n------------------------------------------------------\nkworker/60:3/6771 is trying to acquire lock:\nff40d43e099380a0 (&vf->cfg_lock){+.+.}-{3:3}, at: ice_reset_vf+0x22f/0x4d0 [ice]\n\nbut task is already holding lock:\nff40d43ea1961210 (&pf->lag_mutex){+.+.}-{3:3}, at: ice_reset_vf+0xb7/0x4d0 [ice]\n\nwhich lock already depends on the new lock.\n\nthe existing dependency chain (in reverse order) is:\n\n-> #1 (&pf->lag_mutex){+.+.}-{3:3}:\n       __lock_acquire+0x4f8/0xb40\n       lock_acquire+0xd4/0x2d0\n       __mutex_lock+0x9b/0xbf0\n       ice_vc_cfg_qs_msg+0x45/0x690 [ice]\n       ice_vc_process_vf_msg+0x4f5/0x870 [ice]\n       __ice_clean_ctrlq+0x2b5/0x600 [ice]\n       ice_service_task+0x2c9/0x480 [ice]\n       process_one_work+0x1e9/0x4d0\n       worker_thread+0x1e1/0x3d0\n       kthread+0x104/0x140\n       ret_from_fork+0x31/0x50\n       ret_from_fork_asm+0x1b/0x30\n\n-> #0 (&vf->cfg_lock){+.+.}-{3:3}:\n       check_prev_add+0xe2/0xc50\n       validate_chain+0x558/0x800\n       __lock_acquire+0x4f8/0xb40\n       lock_acquire+0xd4/0x2d0\n       __mutex_lock+0x9b/0xbf0\n       ice_reset_vf+0x22f/0x4d0 [ice]\n       ice_process_vflr_event+0x98/0xd0 [ice]\n       ice_service_task+0x1cc/0x480 [ice]\n       process_one_work+0x1e9/0x4d0\n       worker_thread+0x1e1/0x3d0\n       kthread+0x104/0x140\n       ret_from_fork+0x31/0x50\n       ret_from_fork_asm+0x1b/0x30\n\nother info that might help us debug this:\n Possible unsafe locking scenario:\n       CPU0                    CPU1\n       ----                    ----\n  lock(&pf->lag_mutex);\n                               lock(&vf->cfg_lock);\n                               lock(&pf->lag_mutex);\n  lock(&vf->cfg_lock);\n\n *** DEADLOCK ***\n4 locks held by kworker/60:3/6771:\n #0: ff40d43e05428b38 ((wq_completion)ice){+.+.}-{0:0}, at: process_one_work+0x176/0x4d0\n #1: ff50d06e05197e58 ((work_completion)(&pf->serv_task)){+.+.}-{0:0}, at: process_one_work+0x176/0x4d0\n #2: ff40d43ea1960e50 (&pf->vfs.table_lock){+.+.}-{3:3}, at: ice_process_vflr_event+0x48/0xd0 [ice]\n #3: ff40d43ea1961210 (&pf->lag_mutex){+.+.}-{3:3}, at: ice_reset_vf+0xb7/0x4d0 [ice]\n\nstack backtrace:\nCPU: 60 PID: 6771 Comm: kworker/60:3 Tainted: G        W  O       6.8.0-rc6 #54\nHardware name:\nWorkqueue: ice ice_service_task [ice]\nCall Trace:\n <TASK>\n dump_stack_lvl+0x4a/0x80\n check_noncircular+0x12d/0x150\n check_prev_add+0xe2/0xc50\n ? save_trace+0x59/0x230\n ? add_chain_cache+0x109/0x450\n validate_chain+0x558/0x800\n __lock_acquire+0x4f8/0xb40\n ? lockdep_hardirqs_on+0x7d/0x100\n lock_acquire+0xd4/0x2d0\n ? ice_reset_vf+0x22f/0x4d0 [ice]\n ? lock_is_held_type+0xc7/0x120\n __mutex_lock+0x9b/0xbf0\n ? ice_reset_vf+0x22f/0x4d0 [ice]\n ? ice_reset_vf+0x22f/0x4d0 [ice]\n ? rcu_is_watching+0x11/0x50\n ? ice_reset_vf+0x22f/0x4d0 [ice]\n ice_reset_vf+0x22f/0x4d0 [ice]\n ? process_one_work+0x176/0x4d0\n ice_process_vflr_event+0x98/0xd0 [ice]\n ice_service_task+0x1cc/0x480 [ice]\n process_one_work+0x1e9/0x4d0\n worker_thread+0x1e1/0x3d0\n ? __pfx_worker_thread+0x10/0x10\n kthread+0x104/0x140\n ? __pfx_kthread+0x10/0x10\n ret_from_fork+0x31/0x50\n ? __pfx_kthread+0x10/0x10\n ret_from_fork_asm+0x1b/0x30\n </TASK>\n\nTo avoid deadlock, we must acquire the LAG \n---truncated---",
  "id": "CVE-2024-36003",
  "modified": "2025-10-15T10:44:10.026935Z",
  "published": "2024-05-20T09:48:04Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/740717774dc37338404d10726967d582414f638c"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/96fdd1f6b4ed72a741fb0eb705c0e13049b8721f"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/de8631d8c9df08440268630200e64b623a5f69e6"
    }
  ],
  "related": [
    "ALSA-2024:5928",
    "MGASA-2024-0263",
    "MGASA-2024-0266",
    "SUSE-SU-2024:2802-1",
    "SUSE-SU-2024:2896-1",
    "SUSE-SU-2024:2973-1"
  ],
  "schema_version": "1.7.3",
  "summary": "ice: fix LAG and VF lock dependency in ice_reset_vf()"
}