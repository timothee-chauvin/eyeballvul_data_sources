{"schema_version":"1.7.3","id":"CVE-2023-53236","published":"2025-09-15T14:22:09Z","modified":"2025-10-21T15:57:09.813544Z","summary":"iommufd: Do not corrupt the pfn list when doing batch carry","details":"In the Linux kernel, the following vulnerability has been resolved:\n\niommufd: Do not corrupt the pfn list when doing batch carry\n\nIf batch->end is 0 then setting npfns[0] before computing the new value of\npfns will fail to adjust the pfn and result in various page accounting\ncorruptions. It should be ordered after.\n\nThis seems to result in various kinds of page meta-data corruption related\nfailures:\n\n  WARNING: CPU: 1 PID: 527 at mm/gup.c:75 try_grab_folio+0x503/0x740\n  Modules linked in:\n  CPU: 1 PID: 527 Comm: repro Not tainted 6.3.0-rc2-eeac8ede1755+ #1\n  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014\n  RIP: 0010:try_grab_folio+0x503/0x740\n  Code: e3 01 48 89 de e8 6d c1 dd ff 48 85 db 0f 84 7c fe ff ff e8 4f bf dd ff 49 8d 47 ff 48 89 45 d0 e9 73 fe ff ff e8 3d bf dd ff <0f> 0b 31 db e9 d0 fc ff ff e8 2f bf dd ff 48 8b 5d c8 31 ff 48 89\n  RSP: 0018:ffffc90000f37908 EFLAGS: 00010046\n  RAX: 0000000000000000 RBX: 00000000fffffc02 RCX: ffffffff81504c26\n  RDX: 0000000000000000 RSI: ffff88800d030000 RDI: 0000000000000002\n  RBP: ffffc90000f37948 R08: 000000000003ca24 R09: 0000000000000008\n  R10: 000000000003ca00 R11: 0000000000000023 R12: ffffea000035d540\n  R13: 0000000000000001 R14: 0000000000000000 R15: ffffea000035d540\n  FS:  00007fecbf659740(0000) GS:ffff88807dd00000(0000) knlGS:0000000000000000\n  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  CR2: 00000000200011c3 CR3: 000000000ef66006 CR4: 0000000000770ee0\n  PKRU: 55555554\n  Call Trace:\n   <TASK>\n   internal_get_user_pages_fast+0xd32/0x2200\n   pin_user_pages_fast+0x65/0x90\n   pfn_reader_user_pin+0x376/0x390\n   pfn_reader_next+0x14a/0x7b0\n   pfn_reader_first+0x140/0x1b0\n   iopt_area_fill_domain+0x74/0x210\n   iopt_table_add_domain+0x30e/0x6e0\n   iommufd_device_selftest_attach+0x7f/0x140\n   iommufd_test+0x10ff/0x16f0\n   iommufd_fops_ioctl+0x206/0x330\n   __x64_sys_ioctl+0x10e/0x160\n   do_syscall_64+0x3b/0x90\n   entry_SYSCALL_64_after_hwframe+0x72/0xdc","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f394576eb11dbcd3a740fa41e577b97f0720d26e"},{"fixed":"6ed5784526ddc0fb58b1798af36ec0c3139a8dca"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f394576eb11dbcd3a740fa41e577b97f0720d26e"},{"fixed":"13a0d1ae7ee6b438f5537711a8c60cba00554943"}]}],"versions":["v6.1","v6.1-rc4","v6.1-rc5","v6.1-rc6","v6.1-rc7","v6.1-rc8","v6.2","v6.2-rc1","v6.2-rc2","v6.2-rc3","v6.2-rc4","v6.2-rc5","v6.2-rc6","v6.2-rc7","v6.2-rc8","v6.2.1","v6.2.10","v6.2.2","v6.2.3","v6.2.4","v6.2.5","v6.2.6","v6.2.7","v6.2.8","v6.2.9","v6.3-rc1","v6.3-rc2","v6.3-rc3","v6.3-rc4","v6.3-rc5"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2023-53236.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["233696699736438597144478832000216768465","340047032461997274638500391122237161028","275058168126943092459065950277184550138","276430856566118644754620357695719322335","111932243481879673897577759952384349325","324328127868822831318479978778555573299"],"threshold":0.9},"id":"CVE-2023-53236-8d170578","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6ed5784526ddc0fb58b1798af36ec0c3139a8dca","target":{"file":"drivers/iommu/iommufd/pages.c"}},{"deprecated":false,"digest":{"line_hashes":["233696699736438597144478832000216768465","340047032461997274638500391122237161028","275058168126943092459065950277184550138","276430856566118644754620357695719322335","111932243481879673897577759952384349325","324328127868822831318479978778555573299"],"threshold":0.9},"id":"CVE-2023-53236-c0eb0c4f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@13a0d1ae7ee6b438f5537711a8c60cba00554943","target":{"file":"drivers/iommu/iommufd/pages.c"}},{"deprecated":false,"digest":{"function_hash":"40436705252874783519581942879819045037","length":415},"id":"CVE-2023-53236-f3d6ae8f","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6ed5784526ddc0fb58b1798af36ec0c3139a8dca","target":{"file":"drivers/iommu/iommufd/pages.c","function":"batch_clear_carry"}},{"deprecated":false,"digest":{"function_hash":"40436705252874783519581942879819045037","length":415},"id":"CVE-2023-53236-f709d3e8","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@13a0d1ae7ee6b438f5537711a8c60cba00554943","target":{"file":"drivers/iommu/iommufd/pages.c","function":"batch_clear_carry"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.2.0"},{"fixed":"6.2.11"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2023-53236.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/13a0d1ae7ee6b438f5537711a8c60cba00554943"},{"type":"WEB","url":"https://git.kernel.org/stable/c/6ed5784526ddc0fb58b1798af36ec0c3139a8dca"}]}