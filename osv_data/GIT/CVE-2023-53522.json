{"schema_version":"1.7.3","id":"CVE-2023-53522","published":"2025-10-01T11:46:08Z","modified":"2025-10-21T17:11:54.950640Z","summary":"cgroup,freezer: hold cpu_hotplug_lock before freezer_mutex","details":"In the Linux kernel, the following vulnerability has been resolved:\n\ncgroup,freezer: hold cpu_hotplug_lock before freezer_mutex\n\nsyzbot is reporting circular locking dependency between cpu_hotplug_lock\nand freezer_mutex, for commit f5d39b020809 (\"freezer,sched: Rewrite core\nfreezer logic\") replaced atomic_inc() in freezer_apply_state() with\nstatic_branch_inc() which holds cpu_hotplug_lock.\n\ncpu_hotplug_lock => cgroup_threadgroup_rwsem => freezer_mutex\n\n  cgroup_file_write() {\n    cgroup_procs_write() {\n      __cgroup_procs_write() {\n        cgroup_procs_write_start() {\n          cgroup_attach_lock() {\n            cpus_read_lock() {\n              percpu_down_read(&cpu_hotplug_lock);\n            }\n            percpu_down_write(&cgroup_threadgroup_rwsem);\n          }\n        }\n        cgroup_attach_task() {\n          cgroup_migrate() {\n            cgroup_migrate_execute() {\n              freezer_attach() {\n                mutex_lock(&freezer_mutex);\n                (...snipped...)\n              }\n            }\n          }\n        }\n        (...snipped...)\n      }\n    }\n  }\n\nfreezer_mutex => cpu_hotplug_lock\n\n  cgroup_file_write() {\n    freezer_write() {\n      freezer_change_state() {\n        mutex_lock(&freezer_mutex);\n        freezer_apply_state() {\n          static_branch_inc(&freezer_active) {\n            static_key_slow_inc() {\n              cpus_read_lock();\n              static_key_slow_inc_cpuslocked();\n              cpus_read_unlock();\n            }\n          }\n        }\n        mutex_unlock(&freezer_mutex);\n      }\n    }\n  }\n\nSwap locking order by moving cpus_read_lock() in freezer_apply_state()\nto before mutex_lock(&freezer_mutex) in freezer_change_state().","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f5d39b020809146cc28e6e73369bf8065e0310aa"},{"fixed":"3756171b97c307d9df8b8ded1d883eec30172085"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f5d39b020809146cc28e6e73369bf8065e0310aa"},{"fixed":"34fbb7b45bae20b551dda24337c7761ca13ce69d"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f5d39b020809146cc28e6e73369bf8065e0310aa"},{"fixed":"57dcd64c7e036299ef526b400a8d12b8a2352f26"}]}],"versions":["v6.0","v6.0-rc1","v6.0-rc2","v6.0-rc3","v6.0-rc4","v6.0-rc5","v6.0-rc6","v6.0-rc7","v6.1","v6.1-rc1","v6.1-rc2","v6.1-rc3","v6.1-rc4","v6.1-rc5","v6.1-rc6","v6.1-rc7","v6.1-rc8","v6.1.1","v6.1.10","v6.1.11","v6.1.12","v6.1.13","v6.1.14","v6.1.15","v6.1.16","v6.1.17","v6.1.18","v6.1.19","v6.1.2","v6.1.20","v6.1.21","v6.1.22","v6.1.23","v6.1.24","v6.1.3","v6.1.4","v6.1.5","v6.1.6","v6.1.7","v6.1.8","v6.1.9","v6.2","v6.2-rc1","v6.2-rc2","v6.2-rc3","v6.2-rc4","v6.2-rc5","v6.2-rc6","v6.2-rc7","v6.2-rc8","v6.2.1","v6.2.10","v6.2.11","v6.2.2","v6.2.3","v6.2.4","v6.2.5","v6.2.6","v6.2.7","v6.2.8","v6.2.9","v6.3-rc1","v6.3-rc2"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2023-53522.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["241445978640685781987447783395532207842","133127142757676610038920533382006955795","164697580597447498412311477918818008655","92943256199724136006664817444074477219","35151015174202458026127374736652706485","306661769402342123217647162327975679917","68639707973845971433485121959390363888","266610805211352865526035141588412682404","228028837465649958373889593833664616574","162992251641926747166955740772940806431","313865265327860167308693113032547797835","292165508847298937550348822049537912974","39376146763818377142787604157839148545","119200567288906494697717777471223331732","675538389298870792209634558985086791","313724464891238294626069417481658755850","21387746192836123156525154647300024650","33332663833320998087976029197660217395","27642729059667171778661562813319427320"],"threshold":0.9},"id":"CVE-2023-53522-1168586d","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@34fbb7b45bae20b551dda24337c7761ca13ce69d","target":{"file":"kernel/cgroup/legacy_freezer.c"}},{"deprecated":false,"digest":{"function_hash":"323541569648794365536492287699664758674","length":524},"id":"CVE-2023-53522-2e18ecc1","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@57dcd64c7e036299ef526b400a8d12b8a2352f26","target":{"file":"kernel/cgroup/legacy_freezer.c","function":"freezer_change_state"}},{"deprecated":false,"digest":{"line_hashes":["241445978640685781987447783395532207842","133127142757676610038920533382006955795","164697580597447498412311477918818008655","92943256199724136006664817444074477219","35151015174202458026127374736652706485","306661769402342123217647162327975679917","68639707973845971433485121959390363888","266610805211352865526035141588412682404","228028837465649958373889593833664616574","162992251641926747166955740772940806431","313865265327860167308693113032547797835","292165508847298937550348822049537912974","39376146763818377142787604157839148545","119200567288906494697717777471223331732","675538389298870792209634558985086791","313724464891238294626069417481658755850","21387746192836123156525154647300024650","33332663833320998087976029197660217395","27642729059667171778661562813319427320"],"threshold":0.9},"id":"CVE-2023-53522-61fadd74","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@57dcd64c7e036299ef526b400a8d12b8a2352f26","target":{"file":"kernel/cgroup/legacy_freezer.c"}},{"deprecated":false,"digest":{"function_hash":"323541569648794365536492287699664758674","length":524},"id":"CVE-2023-53522-bf8bb07c","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@34fbb7b45bae20b551dda24337c7761ca13ce69d","target":{"file":"kernel/cgroup/legacy_freezer.c","function":"freezer_change_state"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.1.0"},{"fixed":"6.1.25"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.2.0"},{"fixed":"6.2.12"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2023-53522.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/34fbb7b45bae20b551dda24337c7761ca13ce69d"},{"type":"WEB","url":"https://git.kernel.org/stable/c/3756171b97c307d9df8b8ded1d883eec30172085"},{"type":"WEB","url":"https://git.kernel.org/stable/c/57dcd64c7e036299ef526b400a8d12b8a2352f26"}]}