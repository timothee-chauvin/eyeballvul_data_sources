{"schema_version":"1.7.3","id":"CVE-2025-39674","published":"2025-09-05T17:20:39Z","modified":"2025-10-22T15:01:42.428005Z","summary":"scsi: ufs: ufs-qcom: Fix ESI null pointer dereference","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nscsi: ufs: ufs-qcom: Fix ESI null pointer dereference\n\nESI/MSI is a performance optimization feature that provides dedicated\ninterrupts per MCQ hardware queue. This is optional feature and UFS MCQ\nshould work with and without ESI feature.\n\nCommit e46a28cea29a (\"scsi: ufs: qcom: Remove the MSI descriptor abuse\")\nbrings a regression in ESI (Enhanced System Interrupt) configuration that\ncauses a null pointer dereference when Platform MSI allocation fails.\n\nThe issue occurs in when platform_device_msi_init_and_alloc_irqs() in\nufs_qcom_config_esi() fails (returns -EINVAL) but the current code uses\n__free() macro for automatic cleanup free MSI resources that were never\nsuccessfully allocated.\n\nUnable to handle kernel NULL pointer dereference at virtual\naddress 0000000000000008\n\n  Call trace:\n  mutex_lock+0xc/0x54 (P)\n  platform_device_msi_free_irqs_all+0x1c/0x40\n  ufs_qcom_config_esi+0x1d0/0x220 [ufs_qcom]\n  ufshcd_config_mcq+0x28/0x104\n  ufshcd_init+0xa3c/0xf40\n  ufshcd_pltfrm_init+0x504/0x7d4\n  ufs_qcom_probe+0x20/0x58 [ufs_qcom]\n\nFix by restructuring the ESI configuration to try MSI allocation first,\nbefore any other resource allocation and instead use explicit cleanup\ninstead of __free() macro to avoid cleanup of unallocated resources.\n\nTested on SM8750 platform with MCQ enabled, both with and without\nPlatform ESI support.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"e46a28cea29a0ca7d51c811acccf5d119b40c745"},{"fixed":"aaf17a35a59572c8b29372883619c3dbb0ebb50a"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"e46a28cea29a0ca7d51c811acccf5d119b40c745"},{"fixed":"6300d5c5438724c0876828da2f6e2c1a661871fc"}]}],"versions":["v6.15","v6.15-rc2","v6.15-rc3","v6.15-rc4","v6.15-rc5","v6.15-rc6","v6.15-rc7","v6.16","v6.16-rc1","v6.16-rc2","v6.16-rc3","v6.16-rc4","v6.16-rc5","v6.16-rc6","v6.16-rc7","v6.16.1","v6.16.2","v6.16.3","v6.17-rc1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-39674.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["291916358175066306785457982831911210258","263551786868273138794382287092135744664","298654923152779293620687241932361413734","135851967939222661069621070198663473492","27777876406427999508887102875059942181","153227399480218566727797439006126102124","104648390307261612261046716030124597786","287613295959712984194729324780631979897","185579933631428238026998136265750193582","111652291078409549572048899476862082266","131209871712992152949752770771161834436","149706691724593138472758905794891736867","126162732565025925835466115737063143686","153845462329850854167574457840452098390","101774512851827649120844593991663010725","67049312239322024438353875614724724014","204636559786503109014563381916022300440","36367841323185669631670678150500275816","155734167035418612088453843933454801702","50899854690984271791551518861361198118","274409084293291332091628062215924552233","317237243457363760601304336278073289618","69703688775447155767948574922943978592","37328120716771552065573322336382700195","217666325552435276710654821662574844526","169834539245010520123188553959634677663","96872322504739897476706090110123695839","185076452911949864421236763227128716344","319506835415446881350517415511885337989","89434165102584393028302828983120446700","190243849380776735405103455315742944151","39062169243750370888795175363495249447","208774700481446103120357989494362081947","32623391957270924758359076387202134817"],"threshold":0.9},"id":"CVE-2025-39674-1b3fc2c7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6300d5c5438724c0876828da2f6e2c1a661871fc","target":{"file":"drivers/ufs/host/ufs-qcom.c"}},{"deprecated":false,"digest":{"function_hash":"155190728661573201032837369501958345243","length":1213},"id":"CVE-2025-39674-753e6d65","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6300d5c5438724c0876828da2f6e2c1a661871fc","target":{"file":"drivers/ufs/host/ufs-qcom.c","function":"ufs_qcom_config_esi"}},{"deprecated":false,"digest":{"function_hash":"155190728661573201032837369501958345243","length":1213},"id":"CVE-2025-39674-93a1f96b","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@aaf17a35a59572c8b29372883619c3dbb0ebb50a","target":{"file":"drivers/ufs/host/ufs-qcom.c","function":"ufs_qcom_config_esi"}},{"deprecated":false,"digest":{"function_hash":"324161675438456265679611561230594882668","length":230},"id":"CVE-2025-39674-c654415b","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@aaf17a35a59572c8b29372883619c3dbb0ebb50a","target":{"file":"drivers/ufs/host/ufs-qcom.c","function":"ufs_qcom_irq_free"}},{"deprecated":false,"digest":{"function_hash":"324161675438456265679611561230594882668","length":230},"id":"CVE-2025-39674-cc165b7f","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6300d5c5438724c0876828da2f6e2c1a661871fc","target":{"file":"drivers/ufs/host/ufs-qcom.c","function":"ufs_qcom_irq_free"}},{"deprecated":false,"digest":{"line_hashes":["291916358175066306785457982831911210258","263551786868273138794382287092135744664","298654923152779293620687241932361413734","135851967939222661069621070198663473492","27777876406427999508887102875059942181","153227399480218566727797439006126102124","104648390307261612261046716030124597786","287613295959712984194729324780631979897","185579933631428238026998136265750193582","111652291078409549572048899476862082266","131209871712992152949752770771161834436","149706691724593138472758905794891736867","126162732565025925835466115737063143686","153845462329850854167574457840452098390","101774512851827649120844593991663010725","67049312239322024438353875614724724014","204636559786503109014563381916022300440","36367841323185669631670678150500275816","155734167035418612088453843933454801702","50899854690984271791551518861361198118","274409084293291332091628062215924552233","317237243457363760601304336278073289618","69703688775447155767948574922943978592","37328120716771552065573322336382700195","217666325552435276710654821662574844526","169834539245010520123188553959634677663","96872322504739897476706090110123695839","185076452911949864421236763227128716344","319506835415446881350517415511885337989","89434165102584393028302828983120446700","190243849380776735405103455315742944151","39062169243750370888795175363495249447","208774700481446103120357989494362081947","32623391957270924758359076387202134817"],"threshold":0.9},"id":"CVE-2025-39674-e6bbcd2f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@aaf17a35a59572c8b29372883619c3dbb0ebb50a","target":{"file":"drivers/ufs/host/ufs-qcom.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.16.0"},{"fixed":"6.16.4"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-39674.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/6300d5c5438724c0876828da2f6e2c1a661871fc"},{"type":"WEB","url":"https://git.kernel.org/stable/c/aaf17a35a59572c8b29372883619c3dbb0ebb50a"}]}