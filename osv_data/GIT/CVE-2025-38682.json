{"schema_version":"1.7.3","id":"CVE-2025-38682","published":"2025-09-04T15:32:37Z","modified":"2025-10-22T14:41:47.116475Z","summary":"i2c: core: Fix double-free of fwnode in i2c_unregister_device()","details":"In the Linux kernel, the following vulnerability has been resolved:\n\ni2c: core: Fix double-free of fwnode in i2c_unregister_device()\n\nBefore commit df6d7277e552 (\"i2c: core: Do not dereference fwnode in struct\ndevice\"), i2c_unregister_device() only called fwnode_handle_put() on\nof_node-s in the form of calling of_node_put(client->dev.of_node).\n\nBut after this commit the i2c_client's fwnode now unconditionally gets\nfwnode_handle_put() on it.\n\nWhen the i2c_client has no primary (ACPI / OF) fwnode but it does have\na software fwnode, the software-node will be the primary node and\nfwnode_handle_put() will put() it.\n\nBut for the software fwnode device_remove_software_node() will also put()\nit leading to a double free:\n\n[   82.665598] ------------[ cut here ]------------\n[   82.665609] refcount_t: underflow; use-after-free.\n[   82.665808] WARNING: CPU: 3 PID: 1502 at lib/refcount.c:28 refcount_warn_saturate+0xba/0x11\n...\n[   82.666830] RIP: 0010:refcount_warn_saturate+0xba/0x110\n...\n[   82.666962]  <TASK>\n[   82.666971]  i2c_unregister_device+0x60/0x90\n\nFix this by not calling fwnode_handle_put() when the primary fwnode is\na software-node.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"df6d7277e5525d6cce63127dd93ebec4c6354fa0"},{"fixed":"ffe02f7c4e36090154646612e67d331832f92037"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"df6d7277e5525d6cce63127dd93ebec4c6354fa0"},{"fixed":"1c24e5fc0c7096e00c202a6a3e0c342c1afb47c2"}]}],"versions":["v6.15","v6.15-rc3","v6.15-rc4","v6.15-rc5","v6.15-rc6","v6.15-rc7","v6.16","v6.16-rc1","v6.16-rc2","v6.16-rc3","v6.16-rc4","v6.16-rc5","v6.16-rc6","v6.16-rc7","v6.16.1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-38682.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["144363677370596151296795970935490586254","199595307720608722940613614971659855602","163726857584425181261959841909371378296","48113229263770666465588891955520886196"],"threshold":0.9},"id":"CVE-2025-38682-3c8f5ca4","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ffe02f7c4e36090154646612e67d331832f92037","target":{"file":"drivers/i2c/i2c-core-base.c"}},{"deprecated":false,"digest":{"function_hash":"94585940987558737321912311254126244739","length":332},"id":"CVE-2025-38682-4fc5128b","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ffe02f7c4e36090154646612e67d331832f92037","target":{"file":"drivers/i2c/i2c-core-base.c","function":"i2c_unregister_device"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.16.0"},{"fixed":"6.16.2"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-38682.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/1c24e5fc0c7096e00c202a6a3e0c342c1afb47c2"},{"type":"WEB","url":"https://git.kernel.org/stable/c/ffe02f7c4e36090154646612e67d331832f92037"}]}