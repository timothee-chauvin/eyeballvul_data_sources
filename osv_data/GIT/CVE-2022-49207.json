{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49207.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "function_hash": "44097140197283893479078045568081170561",
              "length": 282.0
            },
            "id": "CVE-2022-49207-0a13a741",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4dd2e947d3be13a4de3b3028859b9a6497266bcf",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "sk_psock_queue_msg"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "44097140197283893479078045568081170561",
              "length": 282.0
            },
            "id": "CVE-2022-49207-26032c53",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@03948ed6553960db62f1c33bec29e64d7c191a3f",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "sk_psock_queue_msg"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "192899186734178142369551629861073469730",
                "158001589014005701027985273730605042499",
                "217806889127226734831982947129734713521",
                "289276624005125166220330768741541212860",
                "320560485223018440510053400016223394634",
                "138618742501168261075703453823615400572",
                "200291382335321086897173462962518419333",
                "299225783202667300419350691525403627009",
                "182888595509341412476128831371841840058",
                "205364036142345018632200653016084573832",
                "60545495263353923343269470652297331310",
                "52076247972707424691091268770819528161",
                "332210977122461283855479998050765541303",
                "308070519189065551016872439760215143966",
                "10154597648955086645758210120559995882",
                "233413987872263595515421479785733714149",
                "300885899772070784484600361380204682305"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2022-49207-5abc721f",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@938d3480b92fa5e454b7734294f12a7b75126f09",
            "target": {
              "file": "include/linux/skmsg.h"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "321638140342476760902909089643327693137",
              "length": 149.0
            },
            "id": "CVE-2022-49207-814ec122",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ef9785f429794567792561a584901faa9291d3ee",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "drop_sk_msg"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "192899186734178142369551629861073469730",
                "158001589014005701027985273730605042499",
                "217806889127226734831982947129734713521",
                "289276624005125166220330768741541212860",
                "320560485223018440510053400016223394634",
                "138618742501168261075703453823615400572",
                "200291382335321086897173462962518419333",
                "299225783202667300419350691525403627009",
                "182888595509341412476128831371841840058",
                "205364036142345018632200653016084573832",
                "60545495263353923343269470652297331310",
                "52076247972707424691091268770819528161",
                "332210977122461283855479998050765541303",
                "308070519189065551016872439760215143966",
                "10154597648955086645758210120559995882",
                "233413987872263595515421479785733714149",
                "300885899772070784484600361380204682305"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2022-49207-99e3cf41",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@03948ed6553960db62f1c33bec29e64d7c191a3f",
            "target": {
              "file": "include/linux/skmsg.h"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "44097140197283893479078045568081170561",
              "length": 282.0
            },
            "id": "CVE-2022-49207-a326a57c",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ef9785f429794567792561a584901faa9291d3ee",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "sk_psock_queue_msg"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "192899186734178142369551629861073469730",
                "158001589014005701027985273730605042499",
                "217806889127226734831982947129734713521",
                "289276624005125166220330768741541212860",
                "320560485223018440510053400016223394634",
                "138618742501168261075703453823615400572",
                "200291382335321086897173462962518419333",
                "299225783202667300419350691525403627009",
                "182888595509341412476128831371841840058",
                "205364036142345018632200653016084573832",
                "60545495263353923343269470652297331310",
                "52076247972707424691091268770819528161",
                "332210977122461283855479998050765541303",
                "308070519189065551016872439760215143966",
                "10154597648955086645758210120559995882",
                "233413987872263595515421479785733714149",
                "300885899772070784484600361380204682305"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2022-49207-a44b5b8f",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4dd2e947d3be13a4de3b3028859b9a6497266bcf",
            "target": {
              "file": "include/linux/skmsg.h"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "192899186734178142369551629861073469730",
                "158001589014005701027985273730605042499",
                "217806889127226734831982947129734713521",
                "289276624005125166220330768741541212860",
                "320560485223018440510053400016223394634",
                "138618742501168261075703453823615400572",
                "200291382335321086897173462962518419333",
                "299225783202667300419350691525403627009",
                "182888595509341412476128831371841840058",
                "205364036142345018632200653016084573832",
                "60545495263353923343269470652297331310",
                "52076247972707424691091268770819528161",
                "332210977122461283855479998050765541303",
                "308070519189065551016872439760215143966",
                "10154597648955086645758210120559995882",
                "233413987872263595515421479785733714149",
                "300885899772070784484600361380204682305"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2022-49207-a520b883",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ef9785f429794567792561a584901faa9291d3ee",
            "target": {
              "file": "include/linux/skmsg.h"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "321638140342476760902909089643327693137",
              "length": 149.0
            },
            "id": "CVE-2022-49207-cfe94253",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@938d3480b92fa5e454b7734294f12a7b75126f09",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "drop_sk_msg"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "44097140197283893479078045568081170561",
              "length": 282.0
            },
            "id": "CVE-2022-49207-d0e60ba9",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@938d3480b92fa5e454b7734294f12a7b75126f09",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "sk_psock_queue_msg"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "321638140342476760902909089643327693137",
              "length": 149.0
            },
            "id": "CVE-2022-49207-ea08dccf",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4dd2e947d3be13a4de3b3028859b9a6497266bcf",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "drop_sk_msg"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "321638140342476760902909089643327693137",
              "length": 149.0
            },
            "id": "CVE-2022-49207-f6e179bf",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@03948ed6553960db62f1c33bec29e64d7c191a3f",
            "target": {
              "file": "include/linux/skmsg.h",
              "function": "drop_sk_msg"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "9635720b7c88592214562cb72605bdab6708006c"
            },
            {
              "fixed": "ef9785f429794567792561a584901faa9291d3ee"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "9635720b7c88592214562cb72605bdab6708006c"
            },
            {
              "fixed": "4dd2e947d3be13a4de3b3028859b9a6497266bcf"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "9635720b7c88592214562cb72605bdab6708006c"
            },
            {
              "fixed": "03948ed6553960db62f1c33bec29e64d7c191a3f"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "9635720b7c88592214562cb72605bdab6708006c"
            },
            {
              "fixed": "938d3480b92fa5e454b7734294f12a7b75126f09"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v5.14",
        "v5.14-rc2",
        "v5.14-rc3",
        "v5.14-rc4",
        "v5.14-rc5",
        "v5.14-rc6",
        "v5.14-rc7",
        "v5.15",
        "v5.15-rc1",
        "v5.15-rc2",
        "v5.15-rc3",
        "v5.15-rc4",
        "v5.15-rc5",
        "v5.15-rc6",
        "v5.15-rc7",
        "v5.15.1",
        "v5.15.10",
        "v5.15.11",
        "v5.15.12",
        "v5.15.13",
        "v5.15.14",
        "v5.15.15",
        "v5.15.16",
        "v5.15.17",
        "v5.15.18",
        "v5.15.19",
        "v5.15.2",
        "v5.15.20",
        "v5.15.21",
        "v5.15.22",
        "v5.15.23",
        "v5.15.24",
        "v5.15.25",
        "v5.15.26",
        "v5.15.27",
        "v5.15.28",
        "v5.15.29",
        "v5.15.3",
        "v5.15.30",
        "v5.15.31",
        "v5.15.32",
        "v5.15.4",
        "v5.15.5",
        "v5.15.6",
        "v5.15.7",
        "v5.15.8",
        "v5.15.9",
        "v5.16",
        "v5.16-rc1",
        "v5.16-rc2",
        "v5.16-rc3",
        "v5.16-rc4",
        "v5.16-rc5",
        "v5.16-rc6",
        "v5.16-rc7",
        "v5.16-rc8",
        "v5.16.1",
        "v5.16.10",
        "v5.16.11",
        "v5.16.12",
        "v5.16.13",
        "v5.16.14",
        "v5.16.15",
        "v5.16.16",
        "v5.16.17",
        "v5.16.18",
        "v5.16.2",
        "v5.16.3",
        "v5.16.4",
        "v5.16.5",
        "v5.16.6",
        "v5.16.7",
        "v5.16.8",
        "v5.16.9",
        "v5.17",
        "v5.17-rc1",
        "v5.17-rc2",
        "v5.17-rc3",
        "v5.17-rc4",
        "v5.17-rc5",
        "v5.17-rc6",
        "v5.17-rc7",
        "v5.17-rc8",
        "v5.17.1"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49207.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "5.14.0"
            },
            {
              "fixed": "5.15.33"
            }
          ],
          "type": "ECOSYSTEM"
        },
        {
          "events": [
            {
              "introduced": "5.16.0"
            },
            {
              "fixed": "5.16.19"
            }
          ],
          "type": "ECOSYSTEM"
        },
        {
          "events": [
            {
              "introduced": "5.17.0"
            },
            {
              "fixed": "5.17.2"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nbpf, sockmap: Fix memleak in sk_psock_queue_msg\n\nIf tcp_bpf_sendmsg is running during a tear down operation we may enqueue\ndata on the ingress msg queue while tear down is trying to free it.\n\n sk1 (redirect sk2)                         sk2\n -------------------                      ---------------\ntcp_bpf_sendmsg()\n tcp_bpf_send_verdict()\n  tcp_bpf_sendmsg_redir()\n   bpf_tcp_ingress()\n                                          sock_map_close()\n                                           lock_sock()\n    lock_sock() ... blocking\n                                           sk_psock_stop\n                                            sk_psock_clear_state(psock, SK_PSOCK_TX_ENABLED);\n                                           release_sock(sk);\n    lock_sock()\n    sk_mem_charge()\n    get_page()\n    sk_psock_queue_msg()\n     sk_psock_test_state(psock, SK_PSOCK_TX_ENABLED);\n      drop_sk_msg()\n    release_sock()\n\nWhile drop_sk_msg(), the msg has charged memory form sk by sk_mem_charge\nand has sg pages need to put. To fix we use sk_msg_free() and then kfee()\nmsg.\n\nThis issue can cause the following info:\nWARNING: CPU: 0 PID: 9202 at net/core/stream.c:205 sk_stream_kill_queues+0xc8/0xe0\nCall Trace:\n <IRQ>\n inet_csk_destroy_sock+0x55/0x110\n tcp_rcv_state_process+0xe5f/0xe90\n ? sk_filter_trim_cap+0x10d/0x230\n ? tcp_v4_do_rcv+0x161/0x250\n tcp_v4_do_rcv+0x161/0x250\n tcp_v4_rcv+0xc3a/0xce0\n ip_protocol_deliver_rcu+0x3d/0x230\n ip_local_deliver_finish+0x54/0x60\n ip_local_deliver+0xfd/0x110\n ? ip_protocol_deliver_rcu+0x230/0x230\n ip_rcv+0xd6/0x100\n ? ip_local_deliver+0x110/0x110\n __netif_receive_skb_one_core+0x85/0xa0\n process_backlog+0xa4/0x160\n __napi_poll+0x29/0x1b0\n net_rx_action+0x287/0x300\n __do_softirq+0xff/0x2fc\n do_softirq+0x79/0x90\n </IRQ>\n\nWARNING: CPU: 0 PID: 531 at net/ipv4/af_inet.c:154 inet_sock_destruct+0x175/0x1b0\nCall Trace:\n <TASK>\n __sk_destruct+0x24/0x1f0\n sk_psock_destroy+0x19b/0x1c0\n process_one_work+0x1b3/0x3c0\n ? process_one_work+0x3c0/0x3c0\n worker_thread+0x30/0x350\n ? process_one_work+0x3c0/0x3c0\n kthread+0xe6/0x110\n ? kthread_complete_and_exit+0x20/0x20\n ret_from_fork+0x22/0x30\n </TASK>",
  "id": "CVE-2022-49207",
  "modified": "2025-10-14T22:07:28.854734Z",
  "published": "2025-02-26T01:55:46Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/03948ed6553960db62f1c33bec29e64d7c191a3f"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/4dd2e947d3be13a4de3b3028859b9a6497266bcf"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/938d3480b92fa5e454b7734294f12a7b75126f09"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/ef9785f429794567792561a584901faa9291d3ee"
    }
  ],
  "related": [
    "SUSE-SU-2025:1176-1",
    "SUSE-SU-2025:1241-1"
  ],
  "schema_version": "1.7.3",
  "severity": [
    {
      "score": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
      "type": "CVSS_V3"
    }
  ],
  "summary": "bpf, sockmap: Fix memleak in sk_psock_queue_msg"
}