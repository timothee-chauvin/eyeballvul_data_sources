{"schema_version":"1.7.3","id":"CVE-2024-35991","published":"2024-05-20T09:47:56Z","modified":"2025-10-21T21:34:33.073275Z","related":["MGASA-2024-0263","MGASA-2024-0266","SUSE-SU-2024:2135-1","SUSE-SU-2024:2203-1","SUSE-SU-2024:2973-1"],"summary":"dmaengine: idxd: Convert spinlock to mutex to lock evl workqueue","details":"In the Linux kernel, the following vulnerability has been resolved:\n\ndmaengine: idxd: Convert spinlock to mutex to lock evl workqueue\n\ndrain_workqueue() cannot be called safely in a spinlocked context due to\npossible task rescheduling. In the multi-task scenario, calling\nqueue_work() while drain_workqueue() will lead to a Call Trace as\npushing a work on a draining workqueue is not permitted in spinlocked\ncontext.\n    Call Trace:\n    <TASK>\n    ? __warn+0x7d/0x140\n    ? __queue_work+0x2b2/0x440\n    ? report_bug+0x1f8/0x200\n    ? handle_bug+0x3c/0x70\n    ? exc_invalid_op+0x18/0x70\n    ? asm_exc_invalid_op+0x1a/0x20\n    ? __queue_work+0x2b2/0x440\n    queue_work_on+0x28/0x30\n    idxd_misc_thread+0x303/0x5a0 [idxd]\n    ? __schedule+0x369/0xb40\n    ? __pfx_irq_thread_fn+0x10/0x10\n    ? irq_thread+0xbc/0x1b0\n    irq_thread_fn+0x21/0x70\n    irq_thread+0x102/0x1b0\n    ? preempt_count_add+0x74/0xa0\n    ? __pfx_irq_thread_dtor+0x10/0x10\n    ? __pfx_irq_thread+0x10/0x10\n    kthread+0x103/0x140\n    ? __pfx_kthread+0x10/0x10\n    ret_from_fork+0x31/0x50\n    ? __pfx_kthread+0x10/0x10\n    ret_from_fork_asm+0x1b/0x30\n    </TASK>\n\nThe current implementation uses a spinlock to protect event log workqueue\nand will lead to the Call Trace due to potential task rescheduling.\n\nTo address the locking issue, convert the spinlock to mutex, allowing\nthe drain_workqueue() to be called in a safe mutex-locked context.\n\nThis change ensures proper synchronization when accessing the event log\nworkqueue, preventing potential Call Trace and improving the overall\nrobustness of the code.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"c40bd7d9737bdcfb02d42765bc6c59b338151123"},{"fixed":"758071a35d9f3ffd84ff12169d081412a2f5f098"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"c40bd7d9737bdcfb02d42765bc6c59b338151123"},{"fixed":"c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"c40bd7d9737bdcfb02d42765bc6c59b338151123"},{"fixed":"d5638de827cff0fce77007e426ec0ffdedf68a44"}]}],"versions":["v6.3","v6.3-rc2","v6.3-rc3","v6.3-rc4","v6.3-rc5","v6.3-rc6","v6.3-rc7","v6.4","v6.4-rc1","v6.4-rc2","v6.4-rc3","v6.4-rc4","v6.4-rc5","v6.4-rc6","v6.4-rc7","v6.5","v6.5-rc1","v6.5-rc2","v6.5-rc3","v6.5-rc4","v6.5-rc5","v6.5-rc6","v6.5-rc7","v6.6","v6.6-rc1","v6.6-rc2","v6.6-rc3","v6.6-rc4","v6.6-rc5","v6.6-rc6","v6.6-rc7","v6.6.1","v6.6.10","v6.6.11","v6.6.12","v6.6.13","v6.6.14","v6.6.15","v6.6.16","v6.6.17","v6.6.18","v6.6.19","v6.6.2","v6.6.20","v6.6.21","v6.6.22","v6.6.23","v6.6.24","v6.6.25","v6.6.26","v6.6.27","v6.6.28","v6.6.29","v6.6.3","v6.6.4","v6.6.5","v6.6.6","v6.6.7","v6.6.8","v6.6.9","v6.7","v6.7-rc1","v6.7-rc2","v6.7-rc3","v6.7-rc4","v6.7-rc5","v6.7-rc6","v6.7-rc7","v6.7-rc8","v6.8","v6.8-rc1","v6.8-rc2","v6.8-rc3","v6.8-rc4","v6.8-rc5","v6.8-rc6","v6.8-rc7","v6.8.1","v6.8.2","v6.8.3","v6.8.4","v6.8.5","v6.8.6","v6.8.7","v6.8.8","v6.9-rc1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35991.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["248012986116806607426189924803160632587","224431495987691781720489580958411680707","72212960261504105485957724094826027865","48311885262034579882030999337318661648","229288035970481770453976153624937640231","62948620953114214046099682455023193898","227821425409496526019198540290239825146","119200796931303316667224879601294420858"],"threshold":0.9},"id":"CVE-2024-35991-02487f4b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f","target":{"file":"drivers/dma/idxd/debugfs.c"}},{"deprecated":false,"digest":{"line_hashes":["84689522911605958486077322495536749700","217939377304218689394009519162703826143","85790091820635511614708693232873993746","150599519763088179297552970784063824858"],"threshold":0.9},"id":"CVE-2024-35991-157bc941","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f","target":{"file":"drivers/dma/idxd/init.c"}},{"deprecated":false,"digest":{"line_hashes":["84689522911605958486077322495536749700","217939377304218689394009519162703826143","85790091820635511614708693232873993746","150599519763088179297552970784063824858"],"threshold":0.9},"id":"CVE-2024-35991-18d9504b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d5638de827cff0fce77007e426ec0ffdedf68a44","target":{"file":"drivers/dma/idxd/init.c"}},{"deprecated":false,"digest":{"line_hashes":["299715413063949675532241809525702817794","79626300747909853696345677171121311742","4453883968053662508028478440369677541","58202843593993615730162972989441183988"],"threshold":0.9},"id":"CVE-2024-35991-195dc6d7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f","target":{"file":"drivers/dma/idxd/idxd.h"}},{"deprecated":false,"digest":{"line_hashes":["130089170185297699950978577150442876659","298460578640267230999034178807305645272","149539217850441728447715246068631771679","27831208992425869828013436072734153721","67546383545037001976540601052680048960","188556668952577475371503020007134162999","283765064823121989657206633340919295478","51120175036068978420402611690185739793"],"threshold":0.9},"id":"CVE-2024-35991-33bd1aea","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f","target":{"file":"drivers/dma/idxd/irq.c"}},{"deprecated":false,"digest":{"line_hashes":["299715413063949675532241809525702817794","79626300747909853696345677171121311742","4453883968053662508028478440369677541","58202843593993615730162972989441183988"],"threshold":0.9},"id":"CVE-2024-35991-34131b73","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d5638de827cff0fce77007e426ec0ffdedf68a44","target":{"file":"drivers/dma/idxd/idxd.h"}},{"deprecated":false,"digest":{"line_hashes":["98942464246333648571842312562875799568","53250602639368370216724101701743845789","189447246681663270238825709507599785110","244313843440295778938753861305654334875","276832355783870927144779257528857386817","158367157887973935516771710887586680763","117861504887439629950590105883467095350","158030626296597352568060059719551781245","287571414511722330938808461787376297881","4966656889029563566301332267562599081","53674890335227850030090514186797188415","116655153544195587825237518380172118225","74777716599902165096934771611991303916","225204584171371719658629033925875194054","82397316069787511496218826012956778622","49061630687436775381091278024773670166"],"threshold":0.9},"id":"CVE-2024-35991-3424da6b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d5638de827cff0fce77007e426ec0ffdedf68a44","target":{"file":"drivers/dma/idxd/device.c"}},{"deprecated":false,"digest":{"line_hashes":["248012986116806607426189924803160632587","224431495987691781720489580958411680707","72212960261504105485957724094826027865","48311885262034579882030999337318661648","229288035970481770453976153624937640231","62948620953114214046099682455023193898","227821425409496526019198540290239825146","119200796931303316667224879601294420858"],"threshold":0.9},"id":"CVE-2024-35991-5c8d4cfb","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@758071a35d9f3ffd84ff12169d081412a2f5f098","target":{"file":"drivers/dma/idxd/debugfs.c"}},{"deprecated":false,"digest":{"line_hashes":["301924314745763647137399937190815925634","79626300747909853696345677171121311742","4453883968053662508028478440369677541","58202843593993615730162972989441183988"],"threshold":0.9},"id":"CVE-2024-35991-60436ead","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@758071a35d9f3ffd84ff12169d081412a2f5f098","target":{"file":"drivers/dma/idxd/idxd.h"}},{"deprecated":false,"digest":{"line_hashes":["252972440756719214035535876793302931706","333776698982347506575806520137946455478","25548183642805744867418372367350408443","110729782572996841441697829078946613947","227621286550438989150032965139808911754","290296397879650204915512618146400713076","128593376659952253915022592796470587023","84756356353446870095101172585733574001","23696390359316512043974768038108828543"],"threshold":0.9},"id":"CVE-2024-35991-6d6f5e2a","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f","target":{"file":"drivers/dma/idxd/cdev.c"}},{"deprecated":false,"digest":{"line_hashes":["84689522911605958486077322495536749700","217939377304218689394009519162703826143","85790091820635511614708693232873993746","150599519763088179297552970784063824858"],"threshold":0.9},"id":"CVE-2024-35991-7bf4a81f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@758071a35d9f3ffd84ff12169d081412a2f5f098","target":{"file":"drivers/dma/idxd/init.c"}},{"deprecated":false,"digest":{"line_hashes":["98942464246333648571842312562875799568","53250602639368370216724101701743845789","189447246681663270238825709507599785110","244313843440295778938753861305654334875","276832355783870927144779257528857386817","158367157887973935516771710887586680763","117861504887439629950590105883467095350","158030626296597352568060059719551781245","287571414511722330938808461787376297881","4966656889029563566301332267562599081","53674890335227850030090514186797188415","116655153544195587825237518380172118225","74777716599902165096934771611991303916","225204584171371719658629033925875194054","82397316069787511496218826012956778622","49061630687436775381091278024773670166"],"threshold":0.9},"id":"CVE-2024-35991-874d4fe7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f","target":{"file":"drivers/dma/idxd/device.c"}},{"deprecated":false,"digest":{"line_hashes":["130089170185297699950978577150442876659","298460578640267230999034178807305645272","149539217850441728447715246068631771679","27831208992425869828013436072734153721","67546383545037001976540601052680048960","188556668952577475371503020007134162999","283765064823121989657206633340919295478","51120175036068978420402611690185739793"],"threshold":0.9},"id":"CVE-2024-35991-9d3db709","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@758071a35d9f3ffd84ff12169d081412a2f5f098","target":{"file":"drivers/dma/idxd/irq.c"}},{"deprecated":false,"digest":{"line_hashes":["252972440756719214035535876793302931706","333776698982347506575806520137946455478","25548183642805744867418372367350408443","110729782572996841441697829078946613947","227621286550438989150032965139808911754","290296397879650204915512618146400713076","128593376659952253915022592796470587023","84756356353446870095101172585733574001","23696390359316512043974768038108828543"],"threshold":0.9},"id":"CVE-2024-35991-9f19c4d9","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d5638de827cff0fce77007e426ec0ffdedf68a44","target":{"file":"drivers/dma/idxd/cdev.c"}},{"deprecated":false,"digest":{"line_hashes":["98942464246333648571842312562875799568","53250602639368370216724101701743845789","189447246681663270238825709507599785110","244313843440295778938753861305654334875","276832355783870927144779257528857386817","158367157887973935516771710887586680763","117861504887439629950590105883467095350","158030626296597352568060059719551781245","287571414511722330938808461787376297881","4966656889029563566301332267562599081","53674890335227850030090514186797188415","116655153544195587825237518380172118225","74777716599902165096934771611991303916","225204584171371719658629033925875194054","82397316069787511496218826012956778622","49061630687436775381091278024773670166"],"threshold":0.9},"id":"CVE-2024-35991-a434d112","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@758071a35d9f3ffd84ff12169d081412a2f5f098","target":{"file":"drivers/dma/idxd/device.c"}},{"deprecated":false,"digest":{"line_hashes":["248012986116806607426189924803160632587","224431495987691781720489580958411680707","72212960261504105485957724094826027865","48311885262034579882030999337318661648","229288035970481770453976153624937640231","62948620953114214046099682455023193898","227821425409496526019198540290239825146","119200796931303316667224879601294420858"],"threshold":0.9},"id":"CVE-2024-35991-a762885c","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d5638de827cff0fce77007e426ec0ffdedf68a44","target":{"file":"drivers/dma/idxd/debugfs.c"}},{"deprecated":false,"digest":{"line_hashes":["130089170185297699950978577150442876659","298460578640267230999034178807305645272","149539217850441728447715246068631771679","27831208992425869828013436072734153721","67546383545037001976540601052680048960","188556668952577475371503020007134162999","283765064823121989657206633340919295478","51120175036068978420402611690185739793"],"threshold":0.9},"id":"CVE-2024-35991-ac11b9e5","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d5638de827cff0fce77007e426ec0ffdedf68a44","target":{"file":"drivers/dma/idxd/irq.c"}},{"deprecated":false,"digest":{"function_hash":"219137109391498658098302089469141871782","length":625},"id":"CVE-2024-35991-dd391082","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@758071a35d9f3ffd84ff12169d081412a2f5f098","target":{"file":"drivers/dma/idxd/cdev.c","function":"idxd_cdev_evl_drain_pasid"}},{"deprecated":false,"digest":{"line_hashes":["252972440756719214035535876793302931706","333776698982347506575806520137946455478","25548183642805744867418372367350408443","110729782572996841441697829078946613947","227621286550438989150032965139808911754","290296397879650204915512618146400713076","128593376659952253915022592796470587023","84756356353446870095101172585733574001","23696390359316512043974768038108828543"],"threshold":0.9},"id":"CVE-2024-35991-ddaa8f3e","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@758071a35d9f3ffd84ff12169d081412a2f5f098","target":{"file":"drivers/dma/idxd/cdev.c"}},{"deprecated":false,"digest":{"function_hash":"219137109391498658098302089469141871782","length":625},"id":"CVE-2024-35991-e0d38bb5","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d5638de827cff0fce77007e426ec0ffdedf68a44","target":{"file":"drivers/dma/idxd/cdev.c","function":"idxd_cdev_evl_drain_pasid"}},{"deprecated":false,"digest":{"function_hash":"219137109391498658098302089469141871782","length":625},"id":"CVE-2024-35991-fb132f72","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f","target":{"file":"drivers/dma/idxd/cdev.c","function":"idxd_cdev_evl_drain_pasid"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.4.0"},{"fixed":"6.6.30"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.7.0"},{"fixed":"6.8.9"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-35991.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/758071a35d9f3ffd84ff12169d081412a2f5f098"},{"type":"WEB","url":"https://git.kernel.org/stable/c/c9b732a9f73eadc638abdcf0a6d39bc7a0c1af5f"},{"type":"WEB","url":"https://git.kernel.org/stable/c/d5638de827cff0fce77007e426ec0ffdedf68a44"}]}