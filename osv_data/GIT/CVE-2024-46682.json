{"schema_version":"1.7.3","id":"CVE-2024-46682","published":"2024-09-13T05:29:15.294Z","modified":"2025-11-20T05:45:45.758357Z","summary":"nfsd: prevent panic for nfsv4.0 closed files in nfs4_show_open","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nnfsd: prevent panic for nfsv4.0 closed files in nfs4_show_open\n\nPrior to commit 3f29cc82a84c (\"nfsd: split sc_status out of\nsc_type\") states_show() relied on sc_type field to be of valid\ntype before calling into a subfunction to show content of a\nparticular stateid. From that commit, we split the validity of\nthe stateid into sc_status and no longer changed sc_type to 0\nwhile unhashing the stateid. This resulted in kernel oopsing\nfor nfsv4.0 opens that stay around and in nfs4_show_open()\nwould derefence sc_file which was NULL.\n\nInstead, for closed open stateids forgo displaying information\nthat relies of having a valid sc_file.\n\nTo reproduce: mount the server with 4.0, read and close\na file and then on the server cat /proc/fs/nfsd/clients/2/states\n\n[  513.590804] Call trace:\n[  513.590925]  _raw_spin_lock+0xcc/0x160\n[  513.591119]  nfs4_show_open+0x78/0x2c0 [nfsd]\n[  513.591412]  states_show+0x44c/0x488 [nfsd]\n[  513.591681]  seq_read_iter+0x5d8/0x760\n[  513.591896]  seq_read+0x188/0x208\n[  513.592075]  vfs_read+0x148/0x470\n[  513.592241]  ksys_read+0xcc/0x178","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"3f29cc82a84c23cfd12b903029dd26002ca825f5"},{"fixed":"ba0b697de298285301c71c258598226e06494236"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"3f29cc82a84c23cfd12b903029dd26002ca825f5"},{"fixed":"a204501e1743d695ca2930ed25a2be9f8ced96d3"}]}],"versions":["v6.10","v6.10-rc1","v6.10-rc2","v6.10-rc3","v6.10-rc4","v6.10-rc5","v6.10-rc6","v6.10-rc7","v6.10.1","v6.10.2","v6.10.3","v6.10.4","v6.10.5","v6.10.6","v6.10.7","v6.8","v6.8-rc7","v6.9","v6.9-rc1","v6.9-rc2","v6.9-rc3","v6.9-rc4","v6.9-rc5","v6.9-rc6","v6.9-rc7"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-46682.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"98214123756087920494303021508562941364","length":1049},"id":"CVE-2024-46682-15bd60bb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ba0b697de298285301c71c258598226e06494236","target":{"file":"fs/nfsd/nfs4state.c","function":"nfs4_show_open"}},{"deprecated":false,"digest":{"function_hash":"98214123756087920494303021508562941364","length":1049},"id":"CVE-2024-46682-5d4f8765","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a204501e1743d695ca2930ed25a2be9f8ced96d3","target":{"file":"fs/nfsd/nfs4state.c","function":"nfs4_show_open"}},{"deprecated":false,"digest":{"line_hashes":["28960750494253016270364298968189389206","94911075558698856298592125359090027712","131452135854860570004712879194681164555","171966675258927717056678350595483192111","34434693454573427042525573200005772428","139850013673532714114545341380693045952","230248917975456552120877456903649021323","22949530615946740376097708232331737403","259981438709234202883244527069927044260","133993634174965799004113992994010190457","182045780439096178121559423485186894349","195517655993078914340291909734065713770"],"threshold":0.9},"id":"CVE-2024-46682-5dc59f62","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ba0b697de298285301c71c258598226e06494236","target":{"file":"fs/nfsd/nfs4state.c"}},{"deprecated":false,"digest":{"line_hashes":["28960750494253016270364298968189389206","94911075558698856298592125359090027712","131452135854860570004712879194681164555","171966675258927717056678350595483192111","34434693454573427042525573200005772428","139850013673532714114545341380693045952","230248917975456552120877456903649021323","22949530615946740376097708232331737403","259981438709234202883244527069927044260","133993634174965799004113992994010190457","182045780439096178121559423485186894349","195517655993078914340291909734065713770"],"threshold":0.9},"id":"CVE-2024-46682-76a83e59","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a204501e1743d695ca2930ed25a2be9f8ced96d3","target":{"file":"fs/nfsd/nfs4state.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.9.0"},{"fixed":"6.10.8"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-46682.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/a204501e1743d695ca2930ed25a2be9f8ced96d3"},{"type":"WEB","url":"https://git.kernel.org/stable/c/ba0b697de298285301c71c258598226e06494236"}]}