{"schema_version":"1.7.3","id":"CVE-2024-56743","published":"2024-12-29T11:30:11.174Z","modified":"2025-11-20T07:25:34.889692Z","summary":"nfs_common: must not hold RCU while calling nfsd_file_put_local","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nnfs_common: must not hold RCU while calling nfsd_file_put_local\n\nMove holding the RCU from nfs_to_nfsd_file_put_local to\nnfs_to_nfsd_net_put.  It is the call to nfs_to->nfsd_serv_put that\nrequires the RCU anyway (the puts for nfsd_file and netns were\ncombined to avoid an extra indirect reference but that\nmicro-optimization isn't possible now).\n\nThis fixes xfstests generic/013 and it triggering:\n\n\"Voluntary context switch within RCU read-side critical section!\"\n\n[  143.545738] Call Trace:\n[  143.546206]  <TASK>\n[  143.546625]  ? show_regs+0x6d/0x80\n[  143.547267]  ? __warn+0x91/0x140\n[  143.547951]  ? rcu_note_context_switch+0x496/0x5d0\n[  143.548856]  ? report_bug+0x193/0x1a0\n[  143.549557]  ? handle_bug+0x63/0xa0\n[  143.550214]  ? exc_invalid_op+0x1d/0x80\n[  143.550938]  ? asm_exc_invalid_op+0x1f/0x30\n[  143.551736]  ? rcu_note_context_switch+0x496/0x5d0\n[  143.552634]  ? wakeup_preempt+0x62/0x70\n[  143.553358]  __schedule+0xaa/0x1380\n[  143.554025]  ? _raw_spin_unlock_irqrestore+0x12/0x40\n[  143.554958]  ? try_to_wake_up+0x1fe/0x6b0\n[  143.555715]  ? wake_up_process+0x19/0x20\n[  143.556452]  schedule+0x2e/0x120\n[  143.557066]  schedule_preempt_disabled+0x19/0x30\n[  143.557933]  rwsem_down_read_slowpath+0x24d/0x4a0\n[  143.558818]  ? xfs_efi_item_format+0x50/0xc0 [xfs]\n[  143.559894]  down_read+0x4e/0xb0\n[  143.560519]  xlog_cil_commit+0x1b2/0xbc0 [xfs]\n[  143.561460]  ? _raw_spin_unlock+0x12/0x30\n[  143.562212]  ? xfs_inode_item_precommit+0xc7/0x220 [xfs]\n[  143.563309]  ? xfs_trans_run_precommits+0x69/0xd0 [xfs]\n[  143.564394]  __xfs_trans_commit+0xb5/0x330 [xfs]\n[  143.565367]  xfs_trans_roll+0x48/0xc0 [xfs]\n[  143.566262]  xfs_defer_trans_roll+0x57/0x100 [xfs]\n[  143.567278]  xfs_defer_finish_noroll+0x27a/0x490 [xfs]\n[  143.568342]  xfs_defer_finish+0x1a/0x80 [xfs]\n[  143.569267]  xfs_bunmapi_range+0x4d/0xb0 [xfs]\n[  143.570208]  xfs_itruncate_extents_flags+0x13d/0x230 [xfs]\n[  143.571353]  xfs_free_eofblocks+0x12e/0x190 [xfs]\n[  143.572359]  xfs_file_release+0x12d/0x140 [xfs]\n[  143.573324]  __fput+0xe8/0x2d0\n[  143.573922]  __fput_sync+0x1d/0x30\n[  143.574574]  nfsd_filp_close+0x33/0x60 [nfsd]\n[  143.575430]  nfsd_file_free+0x96/0x150 [nfsd]\n[  143.576274]  nfsd_file_put+0xf7/0x1a0 [nfsd]\n[  143.577104]  nfsd_file_put_local+0x18/0x30 [nfsd]\n[  143.578070]  nfs_close_local_fh+0x101/0x110 [nfs_localio]\n[  143.579079]  __put_nfs_open_context+0xc9/0x180 [nfs]\n[  143.580031]  nfs_file_clear_open_context+0x4a/0x60 [nfs]\n[  143.581038]  nfs_file_release+0x3e/0x60 [nfs]\n[  143.581879]  __fput+0xe8/0x2d0\n[  143.582464]  __fput_sync+0x1d/0x30\n[  143.583108]  __x64_sys_close+0x41/0x80\n[  143.583823]  x64_sys_call+0x189a/0x20d0\n[  143.584552]  do_syscall_64+0x64/0x170\n[  143.585240]  entry_SYSCALL_64_after_hwframe+0x76/0x7e\n[  143.586185] RIP: 0033:0x7f3c5153efd7","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"65f2a5c366353da6fa724c68347e1de954928143"},{"fixed":"3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"65f2a5c366353da6fa724c68347e1de954928143"},{"fixed":"c840b8e1f039e90f97ca55525667eb961422f86c"}]}],"versions":["v6.12","v6.12-rc2","v6.12-rc3","v6.12-rc4","v6.12-rc5","v6.12-rc6","v6.12-rc7","v6.12.1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-56743.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["306113461732480910674681253194310220530","66880715032267815541086575393189961995","199196158744821896742439547216632802502","3210935556737471973273247364606164967"],"threshold":0.9},"id":"CVE-2024-56743-03a2a068","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2","target":{"file":"fs/nfsd/filecache.h"}},{"deprecated":false,"digest":{"line_hashes":["128845140829197873899731148476483832992","243818284679346594855098510066842609100","199955173261895087010435297390780380799","57529319901777502242384134929398072685","233436333424150336068092692503506243863","38545965815146591601128003380556358482","287148825411473846518209306675239626186","110064496914306090425184610612947747195","171848832006150277025831449603605303809","25054754671101433691447341233993508142","202904325797143421857705668281994448245","298635544756007165579166149373533006274","108128528199620347565406611358081864138"],"threshold":0.9},"id":"CVE-2024-56743-071c1cd8","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c840b8e1f039e90f97ca55525667eb961422f86c","target":{"file":"include/linux/nfslocalio.h"}},{"deprecated":false,"digest":{"function_hash":"36135969231708352761397406144551964166","length":88},"id":"CVE-2024-56743-18615f7d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2","target":{"file":"fs/nfsd/filecache.c","function":"__must_hold"}},{"deprecated":false,"digest":{"line_hashes":["208113172606563012027516415520593265987","140785663188929515086936391943848019457","283040279000186917542847284246067169332","214659318316187135522111141019078835468","33732905609353059004990745802917618880","249542004969339892444512914425630291078","318798259002470359127057518875871328055","167377811054646527289270268147788135971","162110647538644252733988629641145010702"],"threshold":0.9},"id":"CVE-2024-56743-3c7152ba","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c840b8e1f039e90f97ca55525667eb961422f86c","target":{"file":"fs/nfsd/filecache.c"}},{"deprecated":false,"digest":{"line_hashes":["208113172606563012027516415520593265987","140785663188929515086936391943848019457","283040279000186917542847284246067169332","214659318316187135522111141019078835468","33732905609353059004990745802917618880","249542004969339892444512914425630291078","318798259002470359127057518875871328055","167377811054646527289270268147788135971","162110647538644252733988629641145010702"],"threshold":0.9},"id":"CVE-2024-56743-45028aff","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2","target":{"file":"fs/nfsd/filecache.c"}},{"deprecated":false,"digest":{"line_hashes":["9207507189459848886991570322837267298","258994372341363200126303800039420454803","32215603729172810654427697873029009874","332279926860803418814527421026204105780","221919451573041183245483624951108207519","230610613170610130547169317618837574907","265325227275906996629045511923205671352","253232792911348976793830212576734957540"],"threshold":0.9},"id":"CVE-2024-56743-5d9b510f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2","target":{"file":"fs/nfs_common/nfslocalio.c"}},{"deprecated":false,"digest":{"function_hash":"305047387258249786184449960883875259808","length":122},"id":"CVE-2024-56743-848bc9d3","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2","target":{"file":"include/linux/nfslocalio.h","function":"nfs_to_nfsd_file_put_local"}},{"deprecated":false,"digest":{"function_hash":"94914262692204188035961302466731221537","length":510},"id":"CVE-2024-56743-aca2a01f","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2","target":{"file":"fs/nfs_common/nfslocalio.c","function":"nfs_open_local_fh"}},{"deprecated":false,"digest":{"line_hashes":["128845140829197873899731148476483832992","243818284679346594855098510066842609100","199955173261895087010435297390780380799","57529319901777502242384134929398072685","233436333424150336068092692503506243863","38545965815146591601128003380556358482","287148825411473846518209306675239626186","110064496914306090425184610612947747195","171848832006150277025831449603605303809","25054754671101433691447341233993508142","202904325797143421857705668281994448245","298635544756007165579166149373533006274","108128528199620347565406611358081864138"],"threshold":0.9},"id":"CVE-2024-56743-b4caa22f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2","target":{"file":"include/linux/nfslocalio.h"}},{"deprecated":false,"digest":{"function_hash":"36135969231708352761397406144551964166","length":88},"id":"CVE-2024-56743-b68994de","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c840b8e1f039e90f97ca55525667eb961422f86c","target":{"file":"fs/nfsd/filecache.c","function":"__must_hold"}},{"deprecated":false,"digest":{"function_hash":"94914262692204188035961302466731221537","length":510},"id":"CVE-2024-56743-c5f393bb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c840b8e1f039e90f97ca55525667eb961422f86c","target":{"file":"fs/nfs_common/nfslocalio.c","function":"nfs_open_local_fh"}},{"deprecated":false,"digest":{"line_hashes":["306113461732480910674681253194310220530","66880715032267815541086575393189961995","199196158744821896742439547216632802502","3210935556737471973273247364606164967"],"threshold":0.9},"id":"CVE-2024-56743-dc10f057","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c840b8e1f039e90f97ca55525667eb961422f86c","target":{"file":"fs/nfsd/filecache.h"}},{"deprecated":false,"digest":{"line_hashes":["9207507189459848886991570322837267298","258994372341363200126303800039420454803","32215603729172810654427697873029009874","332279926860803418814527421026204105780","221919451573041183245483624951108207519","230610613170610130547169317618837574907","265325227275906996629045511923205671352","253232792911348976793830212576734957540"],"threshold":0.9},"id":"CVE-2024-56743-e663a4d1","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c840b8e1f039e90f97ca55525667eb961422f86c","target":{"file":"fs/nfs_common/nfslocalio.c"}},{"deprecated":false,"digest":{"function_hash":"305047387258249786184449960883875259808","length":122},"id":"CVE-2024-56743-f2acad67","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c840b8e1f039e90f97ca55525667eb961422f86c","target":{"file":"include/linux/nfslocalio.h","function":"nfs_to_nfsd_file_put_local"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.12.0"},{"fixed":"6.12.2"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-56743.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/3e6e3e97d64f50d9b6b1d62274f08925b1adbfc2"},{"type":"WEB","url":"https://git.kernel.org/stable/c/c840b8e1f039e90f97ca55525667eb961422f86c"}],"severity":[{"type":"CVSS_V3","score":"CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"}]}