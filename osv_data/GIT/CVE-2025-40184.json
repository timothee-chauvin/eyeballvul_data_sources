{"schema_version":"1.7.3","id":"CVE-2025-40184","published":"2025-11-12T21:56:28.044Z","modified":"2025-11-20T10:17:54.323770Z","summary":"KVM: arm64: Fix debug checking for np-guests using huge mappings","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nKVM: arm64: Fix debug checking for np-guests using huge mappings\n\nWhen running with transparent huge pages and CONFIG_NVHE_EL2_DEBUG then\nthe debug checking in assert_host_shared_guest() fails on the launch of an\nnp-guest. This WARN_ON() causes a panic and generates the stack below.\n\nIn __pkvm_host_relax_perms_guest() the debug checking assumes the mapping\nis a single page but it may be a block map. Update the checking so that\nthe size is not checked and just assumes the correct size.\n\nWhile we're here make the same fix in __pkvm_host_mkyoung_guest().\n\n  Info: # lkvm run -k /share/arch/arm64/boot/Image -m 704 -c 8 --name guest-128\n  Info: Removed ghost socket file \"/.lkvm//guest-128.sock\".\n[ 1406.521757] kvm [141]: nVHE hyp BUG at: arch/arm64/kvm/hyp/nvhe/mem_protect.c:1088!\n[ 1406.521804] kvm [141]: nVHE call trace:\n[ 1406.521828] kvm [141]:  [<ffff8000811676b4>] __kvm_nvhe_hyp_panic+0xb4/0xe8\n[ 1406.521946] kvm [141]:  [<ffff80008116d12c>] __kvm_nvhe_assert_host_shared_guest+0xb0/0x10c\n[ 1406.522049] kvm [141]:  [<ffff80008116f068>] __kvm_nvhe___pkvm_host_relax_perms_guest+0x48/0x104\n[ 1406.522157] kvm [141]:  [<ffff800081169df8>] __kvm_nvhe_handle___pkvm_host_relax_perms_guest+0x64/0x7c\n[ 1406.522250] kvm [141]:  [<ffff800081169f0c>] __kvm_nvhe_handle_trap+0x8c/0x1a8\n[ 1406.522333] kvm [141]:  [<ffff8000811680fc>] __kvm_nvhe___skip_pauth_save+0x4/0x4\n[ 1406.522454] kvm [141]: ---[ end nVHE call trace ]---\n[ 1406.522477] kvm [141]: Hyp Offset: 0xfffece8013600000\n[ 1406.522554] Kernel panic - not syncing: HYP panic:\n[ 1406.522554] PS:834003c9 PC:0000b1806db6d170 ESR:00000000f2000800\n[ 1406.522554] FAR:ffff8000804be420 HPFAR:0000000000804be0 PAR:0000000000000000\n[ 1406.522554] VCPU:0000000000000000\n[ 1406.523337] CPU: 3 UID: 0 PID: 141 Comm: kvm-vcpu-0 Not tainted 6.16.0-rc7 #97 PREEMPT\n[ 1406.523485] Hardware name: FVP Base RevC (DT)\n[ 1406.523566] Call trace:\n[ 1406.523629]  show_stack+0x18/0x24 (C)\n[ 1406.523753]  dump_stack_lvl+0xd4/0x108\n[ 1406.523899]  dump_stack+0x18/0x24\n[ 1406.524040]  panic+0x3d8/0x448\n[ 1406.524184]  nvhe_hyp_panic_handler+0x10c/0x23c\n[ 1406.524325]  kvm_handle_guest_abort+0x68c/0x109c\n[ 1406.524500]  handle_exit+0x60/0x17c\n[ 1406.524630]  kvm_arch_vcpu_ioctl_run+0x2e0/0x8c0\n[ 1406.524794]  kvm_vcpu_ioctl+0x1a8/0x9cc\n[ 1406.524919]  __arm64_sys_ioctl+0xac/0x104\n[ 1406.525067]  invoke_syscall+0x48/0x10c\n[ 1406.525189]  el0_svc_common.constprop.0+0x40/0xe0\n[ 1406.525322]  do_el0_svc+0x1c/0x28\n[ 1406.525441]  el0_svc+0x38/0x120\n[ 1406.525588]  el0t_64_sync_handler+0x10c/0x138\n[ 1406.525750]  el0t_64_sync+0x1ac/0x1b0\n[ 1406.525876] SMP: stopping secondary CPUs\n[ 1406.525965] Kernel Offset: disabled\n[ 1406.526032] CPU features: 0x0000,00000080,8e134ca1,9446773f\n[ 1406.526130] Memory Limit: none\n[ 1406.959099] ---[ end Kernel panic - not syncing: HYP panic:\n[ 1406.959099] PS:834003c9 PC:0000b1806db6d170 ESR:00000000f2000800\n[ 1406.959099] FAR:ffff8000804be420 HPFAR:0000000000804be0 PAR:0000000000000000\n[ 1406.959099] VCPU:0000000000000000 ]","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f28f1d02f4eaac05c2ad6bf7264a8696dc21d011"},{"fixed":"4f7af3d8a1177c807d1f2563c7c171700b020656"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f28f1d02f4eaac05c2ad6bf7264a8696dc21d011"},{"fixed":"2ba972bf71cb71d2127ec6c3db1ceb6dd0c73173"}]}],"versions":["v6.15","v6.15-rc5","v6.15-rc6","v6.15-rc7","v6.16","v6.16-rc1","v6.16-rc2","v6.16-rc3","v6.16-rc4","v6.16-rc5","v6.16-rc6","v6.16-rc7","v6.17","v6.17-rc1","v6.17-rc2","v6.17-rc3","v6.17-rc4","v6.17-rc5","v6.17-rc6","v6.17-rc7","v6.17.1","v6.17.2","v6.17.3"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40184.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"302832309373366259370830794558848410594","length":727},"id":"CVE-2025-40184-26ca2e22","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4f7af3d8a1177c807d1f2563c7c171700b020656","target":{"file":"arch/arm64/kvm/hyp/nvhe/mem_protect.c","function":"__check_host_shared_guest"}},{"deprecated":false,"digest":{"function_hash":"244783693716152549646900684380830911835","length":380},"id":"CVE-2025-40184-2828207e","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4f7af3d8a1177c807d1f2563c7c171700b020656","target":{"file":"arch/arm64/kvm/hyp/nvhe/mem_protect.c","function":"__pkvm_host_relax_perms_guest"}},{"deprecated":false,"digest":{"line_hashes":["212878096622848000468280265893545481258","327245658385953799847291947580392670073","245031798194273141600698575083991152811","180156334432543068904080018918028026709","230092955055375230930036421988940132677","9932721358360419301962990556558516465","278969681146700273542045841618286306953","53721832926688967265971662620269446627","78231378641386551356356958935879176657","32307569676259396871167066422197608693","337846922689823699602335947956628857048","300436240511081882733990000412943665682","111013524520911884324303525808695058838"],"threshold":0.9},"id":"CVE-2025-40184-726e20dc","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4f7af3d8a1177c807d1f2563c7c171700b020656","target":{"file":"arch/arm64/kvm/hyp/nvhe/mem_protect.c"}},{"deprecated":false,"digest":{"function_hash":"213470871688033624345537310193938877207","length":283},"id":"CVE-2025-40184-efdcfbbb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@4f7af3d8a1177c807d1f2563c7c171700b020656","target":{"file":"arch/arm64/kvm/hyp/nvhe/mem_protect.c","function":"__pkvm_host_mkyoung_guest"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.16.0"},{"fixed":"6.17.4"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40184.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/2ba972bf71cb71d2127ec6c3db1ceb6dd0c73173"},{"type":"WEB","url":"https://git.kernel.org/stable/c/4f7af3d8a1177c807d1f2563c7c171700b020656"}]}