{"schema_version":"1.7.3","id":"CVE-2025-39723","published":"2025-09-05T17:21:31Z","modified":"2025-10-22T15:25:11.748521Z","summary":"netfs: Fix unbuffered write error handling","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nnetfs: Fix unbuffered write error handling\n\nIf all the subrequests in an unbuffered write stream fail, the subrequest\ncollector doesn't update the stream->transferred value and it retains its\ninitial LONG_MAX value.  Unfortunately, if all active streams fail, then we\ntake the smallest value of { LONG_MAX, LONG_MAX, ... } as the value to set\nin wreq->transferred - which is then returned from ->write_iter().\n\nLONG_MAX was chosen as the initial value so that all the streams can be\nquickly assessed by taking the smallest value of all stream->transferred -\nbut this only works if we've set any of them.\n\nFix this by adding a flag to indicate whether the value in\nstream->transferred is valid and checking that when we integrate the\nvalues.  stream->transferred can then be initialised to zero.\n\nThis was found by running the generic/750 xfstest against cifs with\ncache=none.  It splices data to the target file.  Once (if) it has used up\nall the available scratch space, the writes start failing with ENOSPC.\nThis causes ->write_iter() to fail.  However, it was returning\nwreq->transferred, i.e. LONG_MAX, rather than an error (because it thought\nthe amount transferred was non-zero) and iter_file_splice_write() would\nthen try to clean up that amount of pipe bufferage - leading to an oops\nwhen it overran.  The kernel log showed:\n\n    CIFS: VFS: Send error in write = -28\n\nfollowed by:\n\n    BUG: kernel NULL pointer dereference, address: 0000000000000008\n\nwith:\n\n    RIP: 0010:iter_file_splice_write+0x3a4/0x520\n    do_splice+0x197/0x4e0\n\nor:\n\n    RIP: 0010:pipe_buf_release (include/linux/pipe_fs_i.h:282)\n    iter_file_splice_write (fs/splice.c:755)\n\nAlso put a warning check into splice to announce if ->write_iter() returned\nthat it had written more than it was asked to.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"288ace2f57c9d06dd2e42bd80d03747d879a4068"},{"fixed":"f08c80af3c9a9849cd178b4843b7c01d103506a1"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"288ace2f57c9d06dd2e42bd80d03747d879a4068"},{"fixed":"387164a2b97e1f5404c6d0049a7409bac7d2bc5b"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"288ace2f57c9d06dd2e42bd80d03747d879a4068"},{"fixed":"a3de58b12ce074ec05b8741fa28d62ccb1070468"}]}],"versions":["v6.10","v6.10-rc1","v6.10-rc2","v6.10-rc3","v6.10-rc4","v6.10-rc5","v6.10-rc6","v6.10-rc7","v6.11","v6.11-rc1","v6.11-rc2","v6.11-rc3","v6.11-rc4","v6.11-rc5","v6.11-rc6","v6.11-rc7","v6.12","v6.12-rc1","v6.12-rc2","v6.12-rc3","v6.12-rc4","v6.12-rc5","v6.12-rc6","v6.12-rc7","v6.12.1","v6.12.10","v6.12.11","v6.12.12","v6.12.13","v6.12.14","v6.12.15","v6.12.16","v6.12.17","v6.12.18","v6.12.19","v6.12.2","v6.12.20","v6.12.21","v6.12.22","v6.12.23","v6.12.24","v6.12.25","v6.12.26","v6.12.27","v6.12.28","v6.12.29","v6.12.3","v6.12.30","v6.12.31","v6.12.32","v6.12.33","v6.12.34","v6.12.35","v6.12.36","v6.12.37","v6.12.38","v6.12.39","v6.12.4","v6.12.40","v6.12.41","v6.12.42","v6.12.43","v6.12.5","v6.12.6","v6.12.7","v6.12.8","v6.12.9","v6.13","v6.13-rc1","v6.13-rc2","v6.13-rc3","v6.13-rc4","v6.13-rc5","v6.13-rc6","v6.13-rc7","v6.14","v6.14-rc1","v6.14-rc2","v6.14-rc3","v6.14-rc4","v6.14-rc5","v6.14-rc6","v6.14-rc7","v6.15","v6.15-rc1","v6.15-rc2","v6.15-rc3","v6.15-rc4","v6.15-rc5","v6.15-rc6","v6.15-rc7","v6.16","v6.16-rc1","v6.16-rc2","v6.16-rc3","v6.16-rc4","v6.16-rc5","v6.16-rc6","v6.16-rc7","v6.16.1","v6.16.2","v6.16.3","v6.17-rc1","v6.9","v6.9-rc7"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-39723.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["226766369314391255647736390907907038378","201814266883012147815471968141440801917","94009567527733196894840389361265671126","234226933144242248523061056146198854610"],"threshold":0.9},"id":"CVE-2025-39723-01f66428","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"include/linux/netfs.h"}},{"deprecated":false,"digest":{"function_hash":"321122544111048299139721582892764928108","length":1385},"id":"CVE-2025-39723-115407bb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"fs/netfs/write_issue.c","function":"netfs_create_write_req"}},{"deprecated":false,"digest":{"function_hash":"297264575870148413603643897009767229680","length":2994},"id":"CVE-2025-39723-3501fae6","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"fs/netfs/write_collect.c","function":"netfs_collect_write_results"}},{"deprecated":false,"digest":{"function_hash":"223100139984072584010004198327154015425","length":2091},"id":"CVE-2025-39723-3602f1ff","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"fs/splice.c","function":"iter_file_splice_write"}},{"deprecated":false,"digest":{"line_hashes":["253216401745127943113320284838077317799","289221957837378067273791102161020390062","155414123535814216841846178154747523094","271479483035430603748544088771755955668"],"threshold":0.9},"id":"CVE-2025-39723-3c20adf4","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"fs/splice.c"}},{"deprecated":false,"digest":{"function_hash":"84603139407353849779122054199393929903","length":3379},"id":"CVE-2025-39723-4bbb4346","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/netfs/read_collect.c","function":"netfs_collect_read_results"}},{"deprecated":false,"digest":{"line_hashes":["253216401745127943113320284838077317799","289221957837378067273791102161020390062","155414123535814216841846178154747523094","271479483035430603748544088771755955668"],"threshold":0.9},"id":"CVE-2025-39723-575a4104","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/splice.c"}},{"deprecated":false,"digest":{"function_hash":"164251429052469539918377973241494092738","length":2837},"id":"CVE-2025-39723-64618418","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/netfs/write_collect.c","function":"netfs_collect_write_results"}},{"deprecated":false,"digest":{"function_hash":"16969479975651770148986865128969180996","length":1684},"id":"CVE-2025-39723-710b510d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/netfs/write_collect.c","function":"netfs_write_collection"}},{"deprecated":false,"digest":{"function_hash":"336849472327566640831190408860157995734","length":1619},"id":"CVE-2025-39723-7a2e627f","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/netfs/write_issue.c","function":"netfs_create_write_req"}},{"deprecated":false,"digest":{"line_hashes":["232944459237744227565763782786389859608","206695699649759454466276856720958629340","115767594050205224383744204051782154259","328212328478059209418055497635774157273","99320184609491771914954937020035390770","57723862412509708099035402382924713417","299077306412950398593920143402524485941","310495439950693404011730595093201572180","74727358458785713184675028050734047025","283349921681519592728123362851266948028","137389553900870354806676089335541629454","143357229982603103225111445079814296477","307684423117645086964158975391809565467","266366266018554439638159640776674876722","85185406593913803361942286168675131081"],"threshold":0.9},"id":"CVE-2025-39723-b70cdb37","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"fs/netfs/write_collect.c"}},{"deprecated":false,"digest":{"function_hash":"251389434831643256915410815859955268069","length":1939},"id":"CVE-2025-39723-ba13a62a","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"fs/netfs/write_collect.c","function":"netfs_write_collection_worker"}},{"deprecated":false,"digest":{"line_hashes":["232944459237744227565763782786389859608","206695699649759454466276856720958629340","115767594050205224383744204051782154259","328212328478059209418055497635774157273","196053241724412282194114302766526949015","299760232211774354713902846902300562284","299077306412950398593920143402524485941","311782582007064364820371586609224657531","213356013228069039935853563609709146434","39977415509769179904296530791076863662","88070970837275425888085383652319771966","143357229982603103225111445079814296477","307684423117645086964158975391809565467","266366266018554439638159640776674876722","85185406593913803361942286168675131081"],"threshold":0.9},"id":"CVE-2025-39723-c15d7638","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/netfs/write_collect.c"}},{"deprecated":false,"digest":{"line_hashes":["222381586288127489139336114093205456267","161061623260853940612121554708582191146","168872238854313214445452442695675187622","329826576940532640895268692406599593515","319669698191984274278944752322520400769","305433251950345947466387256862937165033","309112615140760446751952990384736774892","228114948473520009606498851130286454653"],"threshold":0.9},"id":"CVE-2025-39723-c2e7f130","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@f08c80af3c9a9849cd178b4843b7c01d103506a1","target":{"file":"fs/netfs/write_issue.c"}},{"deprecated":false,"digest":{"line_hashes":["226766369314391255647736390907907038378","201814266883012147815471968141440801917","94009567527733196894840389361265671126","234226933144242248523061056146198854610"],"threshold":0.9},"id":"CVE-2025-39723-cb55fe75","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"include/linux/netfs.h"}},{"deprecated":false,"digest":{"line_hashes":["222381586288127489139336114093205456267","161061623260853940612121554708582191146","168872238854313214445452442695675187622","329826576940532640895268692406599593515","319669698191984274278944752322520400769","305433251950345947466387256862937165033","309112615140760446751952990384736774892","228114948473520009606498851130286454653"],"threshold":0.9},"id":"CVE-2025-39723-d3e83836","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/netfs/write_issue.c"}},{"deprecated":false,"digest":{"line_hashes":["56735984242752830940861348096506500572","328545942273880946473312646489636781510","25899437093528194972975697182175384811","295471887042968585329309490538203464570","110555637689613063404420337586693109984"],"threshold":0.9},"id":"CVE-2025-39723-d63a7d8d","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/netfs/read_collect.c"}},{"deprecated":false,"digest":{"function_hash":"11061677718693898979836610008464904179","length":2044},"id":"CVE-2025-39723-ebb47a46","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a3de58b12ce074ec05b8741fa28d62ccb1070468","target":{"file":"fs/splice.c","function":"iter_file_splice_write"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.10.0"},{"fixed":"6.12.44"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.13.0"},{"fixed":"6.16.4"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-39723.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/387164a2b97e1f5404c6d0049a7409bac7d2bc5b"},{"type":"WEB","url":"https://git.kernel.org/stable/c/a3de58b12ce074ec05b8741fa28d62ccb1070468"},{"type":"WEB","url":"https://git.kernel.org/stable/c/f08c80af3c9a9849cd178b4843b7c01d103506a1"}]}