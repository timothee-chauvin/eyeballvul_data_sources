{"schema_version":"1.7.3","id":"CVE-2022-48895","published":"2024-08-21T06:10:27Z","modified":"2025-10-21T08:16:32.931795Z","summary":"iommu/arm-smmu: Don't unregister on shutdown","details":"In the Linux kernel, the following vulnerability has been resolved:\n\niommu/arm-smmu: Don't unregister on shutdown\n\nMichael Walle says he noticed the following stack trace while performing\na shutdown with \"reboot -f\". He suggests he got \"lucky\" and just hit the\ncorrect spot for the reboot while there was a packet transmission in\nflight.\n\nUnable to handle kernel NULL pointer dereference at virtual address 0000000000000098\nCPU: 0 PID: 23 Comm: kworker/0:1 Not tainted 6.1.0-rc5-00088-gf3600ff8e322 #1930\nHardware name: Kontron KBox A-230-LS (DT)\npc : iommu_get_dma_domain+0x14/0x20\nlr : iommu_dma_map_page+0x9c/0x254\nCall trace:\n iommu_get_dma_domain+0x14/0x20\n dma_map_page_attrs+0x1ec/0x250\n enetc_start_xmit+0x14c/0x10b0\n enetc_xmit+0x60/0xdc\n dev_hard_start_xmit+0xb8/0x210\n sch_direct_xmit+0x11c/0x420\n __dev_queue_xmit+0x354/0xb20\n ip6_finish_output2+0x280/0x5b0\n __ip6_finish_output+0x15c/0x270\n ip6_output+0x78/0x15c\n NF_HOOK.constprop.0+0x50/0xd0\n mld_sendpack+0x1bc/0x320\n mld_ifc_work+0x1d8/0x4dc\n process_one_work+0x1e8/0x460\n worker_thread+0x178/0x534\n kthread+0xe0/0xe4\n ret_from_fork+0x10/0x20\nCode: d503201f f9416800 d503233f d50323bf (f9404c00)\n---[ end trace 0000000000000000 ]---\nKernel panic - not syncing: Oops: Fatal exception in interrupt\n\nThis appears to be reproducible when the board has a fixed IP address,\nis ping flooded from another host, and \"reboot -f\" is used.\n\nThe following is one more manifestation of the issue:\n\n$ reboot -f\nkvm: exiting hardware virtualization\ncfg80211: failed to load regulatory.db\narm-smmu 5000000.iommu: disabling translation\nsdhci-esdhc 2140000.mmc: Removing from iommu group 11\nsdhci-esdhc 2150000.mmc: Removing from iommu group 12\nfsl-edma 22c0000.dma-controller: Removing from iommu group 17\ndwc3 3100000.usb: Removing from iommu group 9\ndwc3 3110000.usb: Removing from iommu group 10\nahci-qoriq 3200000.sata: Removing from iommu group 2\nfsl-qdma 8380000.dma-controller: Removing from iommu group 20\nplatform f080000.display: Removing from iommu group 0\netnaviv-gpu f0c0000.gpu: Removing from iommu group 1\netnaviv etnaviv: Removing from iommu group 1\ncaam_jr 8010000.jr: Removing from iommu group 13\ncaam_jr 8020000.jr: Removing from iommu group 14\ncaam_jr 8030000.jr: Removing from iommu group 15\ncaam_jr 8040000.jr: Removing from iommu group 16\nfsl_enetc 0000:00:00.0: Removing from iommu group 4\narm-smmu 5000000.iommu: Blocked unknown Stream ID 0x429; boot with \"arm-smmu.disable_bypass=0\" to allow, but this may have security implications\narm-smmu 5000000.iommu:         GFSR 0x80000002, GFSYNR0 0x00000002, GFSYNR1 0x00000429, GFSYNR2 0x00000000\nfsl_enetc 0000:00:00.1: Removing from iommu group 5\narm-smmu 5000000.iommu: Blocked unknown Stream ID 0x429; boot with \"arm-smmu.disable_bypass=0\" to allow, but this may have security implications\narm-smmu 5000000.iommu:         GFSR 0x80000002, GFSYNR0 0x00000002, GFSYNR1 0x00000429, GFSYNR2 0x00000000\narm-smmu 5000000.iommu: Blocked unknown Stream ID 0x429; boot with \"arm-smmu.disable_bypass=0\" to allow, but this may have security implications\narm-smmu 5000000.iommu:         GFSR 0x80000002, GFSYNR0 0x00000000, GFSYNR1 0x00000429, GFSYNR2 0x00000000\nfsl_enetc 0000:00:00.2: Removing from iommu group 6\nfsl_enetc_mdio 0000:00:00.3: Removing from iommu group 8\nmscc_felix 0000:00:00.5: Removing from iommu group 3\nfsl_enetc 0000:00:00.6: Removing from iommu group 7\npcieport 0001:00:00.0: Removing from iommu group 18\narm-smmu 5000000.iommu: Blocked unknown Stream ID 0x429; boot with \"arm-smmu.disable_bypass=0\" to allow, but this may have security implications\narm-smmu 5000000.iommu:         GFSR 0x00000002, GFSYNR0 0x00000000, GFSYNR1 0x00000429, GFSYNR2 0x00000000\npcieport 0002:00:00.0: Removing from iommu group 19\nUnable to handle kernel NULL pointer dereference at virtual address 00000000000000a8\npc : iommu_get_dma_domain+0x14/0x20\nlr : iommu_dma_unmap_page+0x38/0xe0\nCall trace:\n iommu_get_dma_domain+0x14/0x20\n dma_unmap_page_attrs+0x38/0x1d0\n en\n---truncated---","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"57365a04c92126525a58bf7a1599ddfa832415e9"},{"fixed":"a1b9c7b1978aacf4b2f33e34bde1e2bb80b8497a"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"57365a04c92126525a58bf7a1599ddfa832415e9"},{"fixed":"ce31e6ca68bd7639bd3e5ef97be215031842bbab"}]}],"versions":["v6.0","v6.0-rc5","v6.0-rc6","v6.0-rc7","v6.1","v6.1-rc1","v6.1-rc2","v6.1-rc3","v6.1-rc4","v6.1-rc5","v6.1-rc6","v6.1-rc7","v6.1-rc8","v6.1.1","v6.1.2","v6.1.3","v6.1.4","v6.1.5","v6.1.6","v6.2-rc1","v6.2-rc2","v6.2-rc3"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-48895.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["302483768620128722084462337149152845614","278253194791259570683263665024060139901","242809054723357479525495075153418441818","275139405998028503391157391794445701966","240241900978466746854517705432402991179","308793451746850537458112228120856772690","184269551004001868604146777570566998150","255227654179203045918285264373237063645","245759333278287120897646835464689730744","149014544856696440027187904914322307473","144070922938023386308873320984828802966","40570272110632427100881123178361742019","328735646246776174739559035685649547077","241852656123679609161308189013152782603","187636426728589531459907973510828268214","246167718070590973678960055537767532533","53629680306217297817744207186290168462","101749153860663781014476549067217511420","149171149018389518663658920577705264153","231448317514915194213370646896544602969"],"threshold":0.9},"id":"CVE-2022-48895-189998bd","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ce31e6ca68bd7639bd3e5ef97be215031842bbab","target":{"file":"drivers/iommu/arm/arm-smmu/arm-smmu.c"}},{"deprecated":false,"digest":{"function_hash":"105314170104537119795892195005646536883","length":64},"id":"CVE-2022-48895-52b4edeb","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a1b9c7b1978aacf4b2f33e34bde1e2bb80b8497a","target":{"file":"drivers/iommu/arm/arm-smmu/arm-smmu.c","function":"arm_smmu_device_shutdown"}},{"deprecated":false,"digest":{"function_hash":"105314170104537119795892195005646536883","length":64},"id":"CVE-2022-48895-5d4fc14a","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ce31e6ca68bd7639bd3e5ef97be215031842bbab","target":{"file":"drivers/iommu/arm/arm-smmu/arm-smmu.c","function":"arm_smmu_device_shutdown"}},{"deprecated":false,"digest":{"function_hash":"188632310740869378483147959707218064630","length":552},"id":"CVE-2022-48895-84f39aef","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ce31e6ca68bd7639bd3e5ef97be215031842bbab","target":{"file":"drivers/iommu/arm/arm-smmu/arm-smmu.c","function":"arm_smmu_device_remove"}},{"deprecated":false,"digest":{"function_hash":"188632310740869378483147959707218064630","length":552},"id":"CVE-2022-48895-af68c011","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a1b9c7b1978aacf4b2f33e34bde1e2bb80b8497a","target":{"file":"drivers/iommu/arm/arm-smmu/arm-smmu.c","function":"arm_smmu_device_remove"}},{"deprecated":false,"digest":{"line_hashes":["302483768620128722084462337149152845614","278253194791259570683263665024060139901","242809054723357479525495075153418441818","275139405998028503391157391794445701966","240241900978466746854517705432402991179","308793451746850537458112228120856772690","184269551004001868604146777570566998150","255227654179203045918285264373237063645","245759333278287120897646835464689730744","149014544856696440027187904914322307473","144070922938023386308873320984828802966","40570272110632427100881123178361742019","328735646246776174739559035685649547077","241852656123679609161308189013152782603","187636426728589531459907973510828268214","246167718070590973678960055537767532533","53629680306217297817744207186290168462","101749153860663781014476549067217511420","149171149018389518663658920577705264153","231448317514915194213370646896544602969"],"threshold":0.9},"id":"CVE-2022-48895-c743df21","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a1b9c7b1978aacf4b2f33e34bde1e2bb80b8497a","target":{"file":"drivers/iommu/arm/arm-smmu/arm-smmu.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.1.0"},{"fixed":"6.1.7"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-48895.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/a1b9c7b1978aacf4b2f33e34bde1e2bb80b8497a"},{"type":"WEB","url":"https://git.kernel.org/stable/c/ce31e6ca68bd7639bd3e5ef97be215031842bbab"}]}