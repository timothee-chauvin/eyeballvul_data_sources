{"schema_version":"1.7.3","id":"CVE-2022-48744","published":"2024-06-20T11:13:27.979Z","modified":"2025-11-19T12:09:39.361403Z","related":["SUSE-SU-2024:2372-1","SUSE-SU-2024:2394-1","SUSE-SU-2024:2902-1","SUSE-SU-2024:2929-1","SUSE-SU-2024:2939-1"],"summary":"net/mlx5e: Avoid field-overflowing memcpy()","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nnet/mlx5e: Avoid field-overflowing memcpy()\n\nIn preparation for FORTIFY_SOURCE performing compile-time and run-time\nfield bounds checking for memcpy(), memmove(), and memset(), avoid\nintentionally writing across neighboring fields.\n\nUse flexible arrays instead of zero-element arrays (which look like they\nare always overflowing) and split the cross-field memcpy() into two halves\nthat can be appropriately bounds-checked by the compiler.\n\nWe were doing:\n\n\t#define ETH_HLEN  14\n\t#define VLAN_HLEN  4\n\t...\n\t#define MLX5E_XDP_MIN_INLINE (ETH_HLEN + VLAN_HLEN)\n\t...\n        struct mlx5e_tx_wqe      *wqe  = mlx5_wq_cyc_get_wqe(wq, pi);\n\t...\n        struct mlx5_wqe_eth_seg  *eseg = &wqe->eth;\n        struct mlx5_wqe_data_seg *dseg = wqe->data;\n\t...\n\tmemcpy(eseg->inline_hdr.start, xdptxd->data, MLX5E_XDP_MIN_INLINE);\n\ntarget is wqe->eth.inline_hdr.start (which the compiler sees as being\n2 bytes in size), but copying 18, intending to write across start\n(really vlan_tci, 2 bytes). The remaining 16 bytes get written into\nwqe->data[0], covering byte_count (4 bytes), lkey (4 bytes), and addr\n(8 bytes).\n\nstruct mlx5e_tx_wqe {\n        struct mlx5_wqe_ctrl_seg   ctrl;                 /*     0    16 */\n        struct mlx5_wqe_eth_seg    eth;                  /*    16    16 */\n        struct mlx5_wqe_data_seg   data[];               /*    32     0 */\n\n        /* size: 32, cachelines: 1, members: 3 */\n        /* last cacheline: 32 bytes */\n};\n\nstruct mlx5_wqe_eth_seg {\n        u8                         swp_outer_l4_offset;  /*     0     1 */\n        u8                         swp_outer_l3_offset;  /*     1     1 */\n        u8                         swp_inner_l4_offset;  /*     2     1 */\n        u8                         swp_inner_l3_offset;  /*     3     1 */\n        u8                         cs_flags;             /*     4     1 */\n        u8                         swp_flags;            /*     5     1 */\n        __be16                     mss;                  /*     6     2 */\n        __be32                     flow_table_metadata;  /*     8     4 */\n        union {\n                struct {\n                        __be16     sz;                   /*    12     2 */\n                        u8         start[2];             /*    14     2 */\n                } inline_hdr;                            /*    12     4 */\n                struct {\n                        __be16     type;                 /*    12     2 */\n                        __be16     vlan_tci;             /*    14     2 */\n                } insert;                                /*    12     4 */\n                __be32             trailer;              /*    12     4 */\n        };                                               /*    12     4 */\n\n        /* size: 16, cachelines: 1, members: 9 */\n        /* last cacheline: 16 bytes */\n};\n\nstruct mlx5_wqe_data_seg {\n        __be32                     byte_count;           /*     0     4 */\n        __be32                     lkey;                 /*     4     4 */\n        __be64                     addr;                 /*     8     8 */\n\n        /* size: 16, cachelines: 1, members: 3 */\n        /* last cacheline: 16 bytes */\n};\n\nSo, split the memcpy() so the compiler can reason about the buffer\nsizes.\n\n\"pahole\" shows no size nor member offset changes to struct mlx5e_tx_wqe\nnor struct mlx5e_umr_wqe. \"objdump -d\" shows no meaningful object\ncode changes (i.e. only source line number induced differences and\noptimizations).","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"b5503b994ed5ed8dbfe821317e7b5b38acb065c5"},{"fixed":"8fbdf8c8b8ab82beab882175157650452c46493e"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"b5503b994ed5ed8dbfe821317e7b5b38acb065c5"},{"fixed":"ad5185735f7dab342fdd0dd41044da4c9ccfef67"}]}],"versions":["v4.10","v4.10-rc1","v4.10-rc2","v4.10-rc3","v4.10-rc4","v4.10-rc5","v4.10-rc6","v4.10-rc7","v4.10-rc8","v4.11","v4.11-rc1","v4.11-rc2","v4.11-rc3","v4.11-rc4","v4.11-rc5","v4.11-rc6","v4.11-rc7","v4.11-rc8","v4.12","v4.12-rc1","v4.12-rc2","v4.12-rc3","v4.12-rc4","v4.12-rc5","v4.12-rc6","v4.12-rc7","v4.13","v4.13-rc1","v4.13-rc2","v4.13-rc3","v4.13-rc4","v4.13-rc5","v4.13-rc6","v4.13-rc7","v4.14","v4.14-rc1","v4.14-rc2","v4.14-rc3","v4.14-rc4","v4.14-rc5","v4.14-rc6","v4.14-rc7","v4.14-rc8","v4.15","v4.15-rc1","v4.15-rc2","v4.15-rc3","v4.15-rc4","v4.15-rc5","v4.15-rc6","v4.15-rc7","v4.15-rc8","v4.15-rc9","v4.16","v4.16-rc1","v4.16-rc2","v4.16-rc3","v4.16-rc4","v4.16-rc5","v4.16-rc6","v4.16-rc7","v4.17","v4.17-rc1","v4.17-rc2","v4.17-rc3","v4.17-rc4","v4.17-rc5","v4.17-rc6","v4.17-rc7","v4.18","v4.18-rc1","v4.18-rc2","v4.18-rc3","v4.18-rc4","v4.18-rc5","v4.18-rc6","v4.18-rc7","v4.18-rc8","v4.19","v4.19-rc1","v4.19-rc2","v4.19-rc3","v4.19-rc4","v4.19-rc5","v4.19-rc6","v4.19-rc7","v4.19-rc8","v4.20","v4.20-rc1","v4.20-rc2","v4.20-rc3","v4.20-rc4","v4.20-rc5","v4.20-rc6","v4.20-rc7","v4.8","v4.8-rc7","v4.8-rc8","v4.9","v4.9-rc1","v4.9-rc2","v4.9-rc3","v4.9-rc4","v4.9-rc5","v4.9-rc6","v4.9-rc7","v4.9-rc8","v5.0","v5.0-rc1","v5.0-rc2","v5.0-rc3","v5.0-rc4","v5.0-rc5","v5.0-rc6","v5.0-rc7","v5.0-rc8","v5.1","v5.1-rc1","v5.1-rc2","v5.1-rc3","v5.1-rc4","v5.1-rc5","v5.1-rc6","v5.1-rc7","v5.10","v5.10-rc1","v5.10-rc2","v5.10-rc3","v5.10-rc4","v5.10-rc5","v5.10-rc6","v5.10-rc7","v5.11","v5.11-rc1","v5.11-rc2","v5.11-rc3","v5.11-rc4","v5.11-rc5","v5.11-rc6","v5.11-rc7","v5.12","v5.12-rc1","v5.12-rc1-dontuse","v5.12-rc2","v5.12-rc3","v5.12-rc4","v5.12-rc5","v5.12-rc6","v5.12-rc7","v5.12-rc8","v5.13","v5.13-rc1","v5.13-rc2","v5.13-rc3","v5.13-rc4","v5.13-rc5","v5.13-rc6","v5.13-rc7","v5.14","v5.14-rc1","v5.14-rc2","v5.14-rc3","v5.14-rc4","v5.14-rc5","v5.14-rc6","v5.14-rc7","v5.15","v5.15-rc1","v5.15-rc2","v5.15-rc3","v5.15-rc4","v5.15-rc5","v5.15-rc6","v5.15-rc7","v5.16","v5.16-rc1","v5.16-rc2","v5.16-rc3","v5.16-rc4","v5.16-rc5","v5.16-rc6","v5.16-rc7","v5.16-rc8","v5.16.1","v5.16.2","v5.16.3","v5.16.4","v5.16.5","v5.17-rc1","v5.2","v5.2-rc1","v5.2-rc2","v5.2-rc3","v5.2-rc4","v5.2-rc5","v5.2-rc6","v5.2-rc7","v5.3","v5.3-rc1","v5.3-rc2","v5.3-rc3","v5.3-rc4","v5.3-rc5","v5.3-rc6","v5.3-rc7","v5.3-rc8","v5.4","v5.4-rc1","v5.4-rc2","v5.4-rc3","v5.4-rc4","v5.4-rc5","v5.4-rc6","v5.4-rc7","v5.4-rc8","v5.5","v5.5-rc1","v5.5-rc2","v5.5-rc3","v5.5-rc4","v5.5-rc5","v5.5-rc6","v5.5-rc7","v5.6","v5.6-rc1","v5.6-rc2","v5.6-rc3","v5.6-rc4","v5.6-rc5","v5.6-rc6","v5.6-rc7","v5.7","v5.7-rc1","v5.7-rc2","v5.7-rc3","v5.7-rc4","v5.7-rc5","v5.7-rc6","v5.7-rc7","v5.8","v5.8-rc1","v5.8-rc2","v5.8-rc3","v5.8-rc4","v5.8-rc5","v5.8-rc6","v5.8-rc7","v5.9","v5.9-rc1","v5.9-rc2","v5.9-rc3","v5.9-rc4","v5.9-rc5","v5.9-rc6","v5.9-rc7","v5.9-rc8"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-48744.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"248266317017303390213245068479859595721","length":1156},"id":"CVE-2022-48744-09700339","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@8fbdf8c8b8ab82beab882175157650452c46493e","target":{"file":"drivers/net/ethernet/mellanox/mlx5/core/en/xdp.c","function":"mlx5e_xmit_xdp_frame"}},{"deprecated":false,"digest":{"line_hashes":["30019142934709821118405460992787273082","99738867092698768783048024117889606813","154581671205207260993174704272824837031","90603880427295173315380623445293488504","102034530286950751555334721322431122284","96739234934152961920157900553786704621","29452159303817741942874055022143685856","231321844717600949041712950556379881257","137868313266066090443705617328938932186"],"threshold":0.9},"id":"CVE-2022-48744-1d8193b4","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@8fbdf8c8b8ab82beab882175157650452c46493e","target":{"file":"drivers/net/ethernet/mellanox/mlx5/core/en.h"}},{"deprecated":false,"digest":{"line_hashes":["30019142934709821118405460992787273082","99738867092698768783048024117889606813","154581671205207260993174704272824837031","90603880427295173315380623445293488504","102034530286950751555334721322431122284","96739234934152961920157900553786704621","29452159303817741942874055022143685856","231321844717600949041712950556379881257","137868313266066090443705617328938932186"],"threshold":0.9},"id":"CVE-2022-48744-25c9ad45","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ad5185735f7dab342fdd0dd41044da4c9ccfef67","target":{"file":"drivers/net/ethernet/mellanox/mlx5/core/en.h"}},{"deprecated":false,"digest":{"line_hashes":["266840291559207468719776952155897063141","226178845071554161931602532384262769270","301938485161829352391108763175188080567","253866170139882458066053602703639324292","2377936131564965455172018623192956516"],"threshold":0.9},"id":"CVE-2022-48744-365e7720","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@8fbdf8c8b8ab82beab882175157650452c46493e","target":{"file":"drivers/net/ethernet/mellanox/mlx5/core/en/xdp.c"}},{"deprecated":false,"digest":{"line_hashes":["266840291559207468719776952155897063141","226178845071554161931602532384262769270","301938485161829352391108763175188080567","253866170139882458066053602703639324292","2377936131564965455172018623192956516"],"threshold":0.9},"id":"CVE-2022-48744-76b7b4ac","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ad5185735f7dab342fdd0dd41044da4c9ccfef67","target":{"file":"drivers/net/ethernet/mellanox/mlx5/core/en/xdp.c"}},{"deprecated":false,"digest":{"function_hash":"248266317017303390213245068479859595721","length":1156},"id":"CVE-2022-48744-9d6d9e31","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ad5185735f7dab342fdd0dd41044da4c9ccfef67","target":{"file":"drivers/net/ethernet/mellanox/mlx5/core/en/xdp.c","function":"mlx5e_xmit_xdp_frame"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"4.9.0"},{"fixed":"5.16.6"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-48744.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/8fbdf8c8b8ab82beab882175157650452c46493e"},{"type":"WEB","url":"https://git.kernel.org/stable/c/ad5185735f7dab342fdd0dd41044da4c9ccfef67"}]}