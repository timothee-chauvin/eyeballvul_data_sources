{"schema_version":"1.7.3","id":"CVE-2024-56788","published":"2025-01-11T12:35:47.985Z","modified":"2025-11-20T07:18:50.999846Z","summary":"net: ethernet: oa_tc6: fix tx skb race condition between reference pointers","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nnet: ethernet: oa_tc6: fix tx skb race condition between reference pointers\n\nThere are two skb pointers to manage tx skb's enqueued from n/w stack.\nwaiting_tx_skb pointer points to the tx skb which needs to be processed\nand ongoing_tx_skb pointer points to the tx skb which is being processed.\n\nSPI thread prepares the tx data chunks from the tx skb pointed by the\nongoing_tx_skb pointer. When the tx skb pointed by the ongoing_tx_skb is\nprocessed, the tx skb pointed by the waiting_tx_skb is assigned to\nongoing_tx_skb and the waiting_tx_skb pointer is assigned with NULL.\nWhenever there is a new tx skb from n/w stack, it will be assigned to\nwaiting_tx_skb pointer if it is NULL. Enqueuing and processing of a tx skb\nhandled in two different threads.\n\nConsider a scenario where the SPI thread processed an ongoing_tx_skb and\nit moves next tx skb from waiting_tx_skb pointer to ongoing_tx_skb pointer\nwithout doing any NULL check. At this time, if the waiting_tx_skb pointer\nis NULL then ongoing_tx_skb pointer is also assigned with NULL. After\nthat, if a new tx skb is assigned to waiting_tx_skb pointer by the n/w\nstack and there is a chance to overwrite the tx skb pointer with NULL in\nthe SPI thread. Finally one of the tx skb will be left as unhandled,\nresulting packet missing and memory leak.\n\n- Consider the below scenario where the TXC reported from the previous\ntransfer is 10 and ongoing_tx_skb holds an tx ethernet frame which can be\ntransported in 20 TXCs and waiting_tx_skb is still NULL.\n\ttx_credits = 10; /* 21 are filled in the previous transfer */\n\tongoing_tx_skb = 20;\n\twaiting_tx_skb = NULL; /* Still NULL */\n- So, (tc6->ongoing_tx_skb || tc6->waiting_tx_skb) becomes true.\n- After oa_tc6_prepare_spi_tx_buf_for_tx_skbs()\n\tongoing_tx_skb = 10;\n\twaiting_tx_skb = NULL; /* Still NULL */\n- Perform SPI transfer.\n- Process SPI rx buffer to get the TXC from footers.\n- Now let's assume previously filled 21 TXCs are freed so we are good to\ntransport the next remaining 10 tx chunks from ongoing_tx_skb.\n\ttx_credits = 21;\n\tongoing_tx_skb = 10;\n\twaiting_tx_skb = NULL;\n- So, (tc6->ongoing_tx_skb || tc6->waiting_tx_skb) becomes true again.\n- In the oa_tc6_prepare_spi_tx_buf_for_tx_skbs()\n\tongoing_tx_skb = NULL;\n\twaiting_tx_skb = NULL;\n\n- Now the below bad case might happen,\n\nThread1 (oa_tc6_start_xmit)\tThread2 (oa_tc6_spi_thread_handler)\n---------------------------\t-----------------------------------\n- if waiting_tx_skb is NULL\n\t\t\t\t- if ongoing_tx_skb is NULL\n\t\t\t\t- ongoing_tx_skb = waiting_tx_skb\n- waiting_tx_skb = skb\n\t\t\t\t- waiting_tx_skb = NULL\n\t\t\t\t...\n\t\t\t\t- ongoing_tx_skb = NULL\n- if waiting_tx_skb is NULL\n- waiting_tx_skb = skb\n\nTo overcome the above issue, protect the moving of tx skb reference from\nwaiting_tx_skb pointer to ongoing_tx_skb pointer and assigning new tx skb\nto waiting_tx_skb pointer, so that the other thread can't access the\nwaiting_tx_skb pointer until the current thread completes moving the tx\nskb reference safely.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"53fbde8ab21e8c2c6187159cc17fc10cbf20900a"},{"fixed":"1f2eb6c32bae04b375bb7a0aedbeefb6dbbcb775"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"53fbde8ab21e8c2c6187159cc17fc10cbf20900a"},{"fixed":"e592b5110b3e9393881b0a019d86832bbf71a47f"}]}],"versions":["v6.11","v6.11-rc7","v6.12","v6.12-rc1","v6.12-rc2","v6.12-rc3","v6.12-rc4","v6.12-rc5","v6.12-rc6","v6.12-rc7","v6.12.1","v6.12.2","v6.12.3","v6.12.4","v6.12.5","v6.12.6","v6.13-rc1","v6.13-rc2"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-56788.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"95433747710174371644373840551557240918","length":347},"id":"CVE-2024-56788-01ccc83b","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@e592b5110b3e9393881b0a019d86832bbf71a47f","target":{"file":"drivers/net/ethernet/oa_tc6.c","function":"oa_tc6_start_xmit"}},{"deprecated":false,"digest":{"line_hashes":["297422638695500631982190332337064347595","145183132191844353938524633035657790499","124685748687154246389757129376724535907","311709745363145934109811366154058421480","276853440573301255080696763499851549604","166407090261498793853833702105233514257","180913716707344743987930437454409659460","326082867482787034012687758391283032809","125055637833292397669244011086423138532","42061593897554339361793242949587350773","306559912665725396384884992589756836231","125260378139777124986920829095294714526","213293851068025373482750019792558326441","331483193982924689617670185035933235672","67894537907816932945004916362826384667","226994196333090265177820560790388419610","110816991873759740040210335092070638786","134939767113915310863752124517983953006"],"threshold":0.9},"id":"CVE-2024-56788-14ef01ff","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@e592b5110b3e9393881b0a019d86832bbf71a47f","target":{"file":"drivers/net/ethernet/oa_tc6.c"}},{"deprecated":false,"digest":{"function_hash":"222921810536616985891859506175969204407","length":329},"id":"CVE-2024-56788-41f761c4","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@e592b5110b3e9393881b0a019d86832bbf71a47f","target":{"file":"drivers/net/ethernet/oa_tc6.c","function":"oa_tc6_prepare_spi_tx_buf_for_tx_skbs"}},{"deprecated":false,"digest":{"function_hash":"222921810536616985891859506175969204407","length":329},"id":"CVE-2024-56788-4a01c6be","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1f2eb6c32bae04b375bb7a0aedbeefb6dbbcb775","target":{"file":"drivers/net/ethernet/oa_tc6.c","function":"oa_tc6_prepare_spi_tx_buf_for_tx_skbs"}},{"deprecated":false,"digest":{"function_hash":"141377788737615256564291931673950527391","length":2356},"id":"CVE-2024-56788-5e67f105","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1f2eb6c32bae04b375bb7a0aedbeefb6dbbcb775","target":{"file":"drivers/net/ethernet/oa_tc6.c","function":"oa_tc6_init"}},{"deprecated":false,"digest":{"function_hash":"141377788737615256564291931673950527391","length":2356},"id":"CVE-2024-56788-9046f589","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@e592b5110b3e9393881b0a019d86832bbf71a47f","target":{"file":"drivers/net/ethernet/oa_tc6.c","function":"oa_tc6_init"}},{"deprecated":false,"digest":{"function_hash":"95433747710174371644373840551557240918","length":347},"id":"CVE-2024-56788-939fa203","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1f2eb6c32bae04b375bb7a0aedbeefb6dbbcb775","target":{"file":"drivers/net/ethernet/oa_tc6.c","function":"oa_tc6_start_xmit"}},{"deprecated":false,"digest":{"line_hashes":["297422638695500631982190332337064347595","145183132191844353938524633035657790499","124685748687154246389757129376724535907","311709745363145934109811366154058421480","276853440573301255080696763499851549604","166407090261498793853833702105233514257","180913716707344743987930437454409659460","326082867482787034012687758391283032809","125055637833292397669244011086423138532","42061593897554339361793242949587350773","306559912665725396384884992589756836231","125260378139777124986920829095294714526","213293851068025373482750019792558326441","331483193982924689617670185035933235672","67894537907816932945004916362826384667","226994196333090265177820560790388419610","110816991873759740040210335092070638786","134939767113915310863752124517983953006"],"threshold":0.9},"id":"CVE-2024-56788-f8b20192","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@1f2eb6c32bae04b375bb7a0aedbeefb6dbbcb775","target":{"file":"drivers/net/ethernet/oa_tc6.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.12.0"},{"fixed":"6.12.7"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-56788.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/1f2eb6c32bae04b375bb7a0aedbeefb6dbbcb775"},{"type":"WEB","url":"https://git.kernel.org/stable/c/e592b5110b3e9393881b0a019d86832bbf71a47f"}]}