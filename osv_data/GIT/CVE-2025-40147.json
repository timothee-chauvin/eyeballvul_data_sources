{"schema_version":"1.7.3","id":"CVE-2025-40147","published":"2025-11-12T10:23:26Z","modified":"2025-11-12T20:06:45.354395Z","summary":"blk-throttle: fix access race during throttle policy activation","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nblk-throttle: fix access race during throttle policy activation\n\nOn repeated cold boots we occasionally hit a NULL pointer crash in\nblk_should_throtl() when throttling is consulted before the throttle\npolicy is fully enabled for the queue. Checking only q->td != NULL is\ninsufficient during early initialization, so blkg_to_pd() for the\nthrottle policy can still return NULL and blkg_to_tg() becomes NULL,\nwhich later gets dereferenced.\n\n Unable to handle kernel NULL pointer dereference\n at virtual address 0000000000000156\n ...\n pc : submit_bio_noacct+0x14c/0x4c8\n lr : submit_bio_noacct+0x48/0x4c8\n sp : ffff800087f0b690\n x29: ffff800087f0b690 x28: 0000000000005f90 x27: ffff00068af393c0\n x26: 0000000000080000 x25: 000000000002fbc0 x24: ffff000684ddcc70\n x23: 0000000000000000 x22: 0000000000000000 x21: 0000000000000000\n x20: 0000000000080000 x19: ffff000684ddcd08 x18: ffffffffffffffff\n x17: 0000000000000000 x16: ffff80008132a550 x15: 0000ffff98020fff\n x14: 0000000000000000 x13: 1fffe000d11d7021 x12: ffff000688eb810c\n x11: ffff00077ec4bb80 x10: ffff000688dcb720 x9 : ffff80008068ef60\n x8 : 00000a6fb8a86e85 x7 : 000000000000111e x6 : 0000000000000002\n x5 : 0000000000000246 x4 : 0000000000015cff x3 : 0000000000394500\n x2 : ffff000682e35e40 x1 : 0000000000364940 x0 : 000000000000001a\n Call trace:\n  submit_bio_noacct+0x14c/0x4c8\n  verity_map+0x178/0x2c8\n  __map_bio+0x228/0x250\n  dm_submit_bio+0x1c4/0x678\n  __submit_bio+0x170/0x230\n  submit_bio_noacct_nocheck+0x16c/0x388\n  submit_bio_noacct+0x16c/0x4c8\n  submit_bio+0xb4/0x210\n  f2fs_submit_read_bio+0x4c/0xf0\n  f2fs_mpage_readpages+0x3b0/0x5f0\n  f2fs_readahead+0x90/0xe8\n\nTighten blk_throtl_activated() to also require that the throttle policy\nbit is set on the queue:\n\n  return q->td != NULL &&\n         test_bit(blkcg_policy_throtl.plid, q->blkcg_pols);\n\nThis prevents blk_should_throtl() from accessing throttle group state\nuntil policy data has been attached to blkgs.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"a3166c51702bb00b8f8b84022090cbab8f37be1a"},{"fixed":"6a0c394300a7b0c05504596685de8a46707171fc"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"a3166c51702bb00b8f8b84022090cbab8f37be1a"},{"fixed":"bd9fd5be6bc0836820500f68fff144609fbd85a9"}]}],"versions":["v6.10","v6.10-rc1","v6.10-rc2","v6.10-rc3","v6.10-rc4","v6.10-rc5","v6.10-rc6","v6.10-rc7","v6.11","v6.11-rc1","v6.11-rc2","v6.11-rc3","v6.11-rc4","v6.11-rc5","v6.11-rc6","v6.11-rc7","v6.12","v6.12-rc1","v6.12-rc2","v6.12-rc3","v6.12-rc4","v6.12-rc5","v6.12-rc6","v6.12-rc7","v6.13","v6.13-rc1","v6.13-rc2","v6.13-rc3","v6.13-rc4","v6.13-rc5","v6.13-rc6","v6.13-rc7","v6.14","v6.14-rc1","v6.14-rc2","v6.14-rc3","v6.14-rc4","v6.14-rc5","v6.14-rc6","v6.14-rc7","v6.15","v6.15-rc1","v6.15-rc2","v6.15-rc3","v6.15-rc4","v6.15-rc5","v6.15-rc6","v6.15-rc7","v6.16","v6.16-rc1","v6.16-rc2","v6.16-rc3","v6.16-rc4","v6.16-rc5","v6.16-rc6","v6.16-rc7","v6.17","v6.17-rc1","v6.17-rc2","v6.17-rc3","v6.17-rc4","v6.17-rc5","v6.17-rc6","v6.17-rc7","v6.17.1","v6.17.2","v6.9","v6.9-rc3","v6.9-rc4","v6.9-rc5","v6.9-rc6","v6.9-rc7"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40147.json","vanir_signatures":[{"deprecated":false,"digest":{"line_hashes":["199149650321854434967143112219867281336","87929130010293756910629350907492546102","98617920388804064022298654931288343237","270709735713219188650987079472629081641","54889588224863689422529896133737788002","257870610831555070292561644222879379052","114426266888885082170540624146394377661","187640790462990359413759891174703137937"],"threshold":0.9},"id":"CVE-2025-40147-385bbedb","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6a0c394300a7b0c05504596685de8a46707171fc","target":{"file":"block/blk-cgroup.c"}},{"deprecated":false,"digest":{"function_hash":"244924011675457914321686809625413200241","length":79},"id":"CVE-2025-40147-3cccb595","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bd9fd5be6bc0836820500f68fff144609fbd85a9","target":{"file":"block/blk-throttle.h","function":"blk_throtl_activated"}},{"deprecated":false,"digest":{"line_hashes":["63556702088223996280391558437940660336","120954201110389287200079611168596883578","21865925190884374269209374236612788629","63902743228732678231183697637673922988","152007561234678247003660755126486798512","62366897314844292737849052167543385351","184161298795462201637713065752435965837","25395161122373514911325318818908285847","267058256562025954817768952749772891400","81065979853991210458139961029350853899"],"threshold":0.9},"id":"CVE-2025-40147-51184de1","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6a0c394300a7b0c05504596685de8a46707171fc","target":{"file":"block/blk-throttle.h"}},{"deprecated":false,"digest":{"function_hash":"244924011675457914321686809625413200241","length":79},"id":"CVE-2025-40147-5f4b4377","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6a0c394300a7b0c05504596685de8a46707171fc","target":{"file":"block/blk-throttle.h","function":"blk_throtl_activated"}},{"deprecated":false,"digest":{"line_hashes":["63556702088223996280391558437940660336","120954201110389287200079611168596883578","21865925190884374269209374236612788629","63902743228732678231183697637673922988","152007561234678247003660755126486798512","62366897314844292737849052167543385351","184161298795462201637713065752435965837","25395161122373514911325318818908285847","267058256562025954817768952749772891400","81065979853991210458139961029350853899"],"threshold":0.9},"id":"CVE-2025-40147-6573482a","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bd9fd5be6bc0836820500f68fff144609fbd85a9","target":{"file":"block/blk-throttle.h"}},{"deprecated":false,"digest":{"function_hash":"59366186613957100383485399917896047043","length":132},"id":"CVE-2025-40147-67a57e72","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bd9fd5be6bc0836820500f68fff144609fbd85a9","target":{"file":"block/blk-cgroup.c","function":"blkcg_policy_enabled"}},{"deprecated":false,"digest":{"line_hashes":["249106673238658663482948828877680416411","146792677619740515856525479024680875610","17516201426787878178045565832777373547"],"threshold":0.9},"id":"CVE-2025-40147-8990aea2","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bd9fd5be6bc0836820500f68fff144609fbd85a9","target":{"file":"block/blk-cgroup.h"}},{"deprecated":false,"digest":{"line_hashes":["249106673238658663482948828877680416411","146792677619740515856525479024680875610","17516201426787878178045565832777373547"],"threshold":0.9},"id":"CVE-2025-40147-9c64e766","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6a0c394300a7b0c05504596685de8a46707171fc","target":{"file":"block/blk-cgroup.h"}},{"deprecated":false,"digest":{"function_hash":"59366186613957100383485399917896047043","length":132},"id":"CVE-2025-40147-c7e7f114","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@6a0c394300a7b0c05504596685de8a46707171fc","target":{"file":"block/blk-cgroup.c","function":"blkcg_policy_enabled"}},{"deprecated":false,"digest":{"line_hashes":["199149650321854434967143112219867281336","87929130010293756910629350907492546102","98617920388804064022298654931288343237","270709735713219188650987079472629081641","54889588224863689422529896133737788002","257870610831555070292561644222879379052","114426266888885082170540624146394377661","187640790462990359413759891174703137937"],"threshold":0.9},"id":"CVE-2025-40147-d91a3ac7","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@bd9fd5be6bc0836820500f68fff144609fbd85a9","target":{"file":"block/blk-cgroup.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"6.10.0"},{"fixed":"6.17.3"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40147.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/6a0c394300a7b0c05504596685de8a46707171fc"},{"type":"WEB","url":"https://git.kernel.org/stable/c/bd9fd5be6bc0836820500f68fff144609fbd85a9"}]}