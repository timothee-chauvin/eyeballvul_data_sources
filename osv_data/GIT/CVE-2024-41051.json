{"schema_version":"1.7.3","id":"CVE-2024-41051","published":"2024-07-29T14:32:07.577Z","modified":"2025-11-20T05:17:21.700780Z","related":["MGASA-2024-0277","MGASA-2024-0278","SUSE-SU-2024:3194-1","SUSE-SU-2024:3195-1","SUSE-SU-2024:3383-1"],"summary":"cachefiles: wait for ondemand_object_worker to finish when dropping object","details":"In the Linux kernel, the following vulnerability has been resolved:\n\ncachefiles: wait for ondemand_object_worker to finish when dropping object\n\nWhen queuing ondemand_object_worker() to re-open the object,\ncachefiles_object is not pinned. The cachefiles_object may be freed when\nthe pending read request is completed intentionally and the related\nerofs is umounted. If ondemand_object_worker() runs after the object is\nfreed, it will incur use-after-free problem as shown below.\n\nprocess A  processs B  process C  process D\n\ncachefiles_ondemand_send_req()\n// send a read req X\n// wait for its completion\n\n           // close ondemand fd\n           cachefiles_ondemand_fd_release()\n           // set object as CLOSE\n\n                       cachefiles_ondemand_daemon_read()\n                       // set object as REOPENING\n                       queue_work(fscache_wq, &info->ondemand_work)\n\n                                // close /dev/cachefiles\n                                cachefiles_daemon_release\n                                cachefiles_flush_reqs\n                                complete(&req->done)\n\n// read req X is completed\n// umount the erofs fs\ncachefiles_put_object()\n// object will be freed\ncachefiles_ondemand_deinit_obj_info()\nkmem_cache_free(object)\n                       // both info and object are freed\n                       ondemand_object_worker()\n\nWhen dropping an object, it is no longer necessary to reopen the object,\nso use cancel_work_sync() to cancel or wait for ondemand_object_worker()\nto finish.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f17443d52d805c9a7fab5e67a4e8b973626fe1cd"},{"fixed":"ec9289369259d982e735a71437e32e6b4035290c"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"f740fd943bb1fbf79b7eaba3c71eb7536f437f51"},{"fixed":"d3179bae72b1b5e555ba839d6d9f40a350a4d78a"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"0a7e54c1959c0feb2de23397ec09c7692364313e"},{"fixed":"b26525b2183632f16a3a4108fe6a4bfa8afac6ed"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"0a7e54c1959c0feb2de23397ec09c7692364313e"},{"fixed":"12e009d60852f7bce0afc373ca0b320f14150418"}]}],"versions":["v6.1.95","v6.1.96","v6.1.97","v6.1.98","v6.1.99","v6.10-rc1","v6.6.35","v6.6.36","v6.6.37","v6.6.38","v6.6.39","v6.6.40","v6.7","v6.7-rc2","v6.7-rc3","v6.7-rc4","v6.7-rc5","v6.7-rc6","v6.7-rc7","v6.7-rc8","v6.8","v6.8-rc1","v6.8-rc2","v6.8-rc3","v6.8-rc4","v6.8-rc5","v6.8-rc6","v6.8-rc7","v6.9","v6.9-rc1","v6.9-rc2","v6.9-rc3","v6.9-rc4","v6.9-rc5","v6.9-rc6","v6.9-rc7","v6.9.1","v6.9.2","v6.9.3","v6.9.4","v6.9.5","v6.9.6","v6.9.7","v6.9.8","v6.9.9"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-41051.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"338926867019512750856461823384565295688","length":539},"id":"CVE-2024-41051-0caea7e7","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@b26525b2183632f16a3a4108fe6a4bfa8afac6ed","target":{"file":"fs/cachefiles/ondemand.c","function":"cachefiles_ondemand_clean_object"}},{"deprecated":false,"digest":{"line_hashes":["165873129412816112849378909141545798256","36558594450926878952663752787833946349","50394922721727847561775602402641855591","109425694493798618659584917706692029257"],"threshold":0.9},"id":"CVE-2024-41051-132da5ce","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@b26525b2183632f16a3a4108fe6a4bfa8afac6ed","target":{"file":"fs/cachefiles/ondemand.c"}},{"deprecated":false,"digest":{"function_hash":"338926867019512750856461823384565295688","length":539},"id":"CVE-2024-41051-1c962c17","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ec9289369259d982e735a71437e32e6b4035290c","target":{"file":"fs/cachefiles/ondemand.c","function":"cachefiles_ondemand_clean_object"}},{"deprecated":false,"digest":{"line_hashes":["165873129412816112849378909141545798256","36558594450926878952663752787833946349","50394922721727847561775602402641855591","109425694493798618659584917706692029257"],"threshold":0.9},"id":"CVE-2024-41051-1eda6a69","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d3179bae72b1b5e555ba839d6d9f40a350a4d78a","target":{"file":"fs/cachefiles/ondemand.c"}},{"deprecated":false,"digest":{"line_hashes":["165873129412816112849378909141545798256","36558594450926878952663752787833946349","50394922721727847561775602402641855591","109425694493798618659584917706692029257"],"threshold":0.9},"id":"CVE-2024-41051-2534b312","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ec9289369259d982e735a71437e32e6b4035290c","target":{"file":"fs/cachefiles/ondemand.c"}},{"deprecated":false,"digest":{"function_hash":"338926867019512750856461823384565295688","length":539},"id":"CVE-2024-41051-fd6e5735","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@d3179bae72b1b5e555ba839d6d9f40a350a4d78a","target":{"file":"fs/cachefiles/ondemand.c","function":"cachefiles_ondemand_clean_object"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"0"},{"fixed":"6.1.100"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.2.0"},{"fixed":"6.6.41"}]},{"type":"ECOSYSTEM","events":[{"introduced":"6.7.0"},{"fixed":"6.9.10"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-41051.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/12e009d60852f7bce0afc373ca0b320f14150418"},{"type":"WEB","url":"https://git.kernel.org/stable/c/b26525b2183632f16a3a4108fe6a4bfa8afac6ed"},{"type":"WEB","url":"https://git.kernel.org/stable/c/d3179bae72b1b5e555ba839d6d9f40a350a4d78a"},{"type":"WEB","url":"https://git.kernel.org/stable/c/ec9289369259d982e735a71437e32e6b4035290c"},{"type":"WEB","url":"https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html"}]}