{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-41045.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "function_hash": "17662491385183501572762014269004158450",
              "length": 1143.0
            },
            "id": "CVE-2024-41045-1c8a8c38",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7aa5a19279c3639ae8b758b63f05d0c616a39fa1",
            "target": {
              "file": "kernel/bpf/helpers.c",
              "function": "__bpf_async_init"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "167617959869780148063027738023233466092",
                "187183189766995426847357745504755197997",
                "307886355013889671190697701299807631551",
                "252785125288770908896571316173536172638",
                "79336806235732150856303059620957462902",
                "20361608993255053749670641265556727001",
                "171906274045416343120244284944045027586",
                "151317430427829740272075290451112595026",
                "37194434468112342840284030629907537190",
                "221500438604956185025446875880196240028",
                "263116199517780130348643206865056370716",
                "140827073577121312226489607764363763086",
                "93665256957403597650336465558868325852",
                "96055854063753201022486459249362860196",
                "147894533609443292223443214232782649401",
                "332130087590500462869083173520172262808",
                "271705112956884740698996070059018652372"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-41045-58ce5ef2",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7aa5a19279c3639ae8b758b63f05d0c616a39fa1",
            "target": {
              "file": "kernel/bpf/helpers.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "187951960127385819355079193799388419961",
              "length": 214.0
            },
            "id": "CVE-2024-41045-5d0097ee",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a6fcd19d7eac1335eb76bc16b6a66b7f574d1d69",
            "target": {
              "file": "kernel/bpf/helpers.c",
              "function": "bpf_timer_cancel_and_free"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "200093871015599225285051662867790822120",
              "length": 404.0
            },
            "id": "CVE-2024-41045-8f493274",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@7aa5a19279c3639ae8b758b63f05d0c616a39fa1",
            "target": {
              "file": "kernel/bpf/helpers.c",
              "function": "bpf_timer_cancel_and_free"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "267672331908477225422508617320500118601",
              "length": 1451.0
            },
            "id": "CVE-2024-41045-9264a5fa",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a6fcd19d7eac1335eb76bc16b6a66b7f574d1d69",
            "target": {
              "file": "kernel/bpf/helpers.c",
              "function": "__bpf_async_init"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "167617959869780148063027738023233466092",
                "187183189766995426847357745504755197997",
                "307886355013889671190697701299807631551",
                "252785125288770908896571316173536172638",
                "235125641780888980309200455044360145274",
                "186530797369576521780191822974525063570",
                "171906274045416343120244284944045027586",
                "237545209446228977431139275248664615216",
                "37194434468112342840284030629907537190",
                "221500438604956185025446875880196240028",
                "263116199517780130348643206865056370716",
                "27552023794877948096611274726020878258",
                "93665256957403597650336465558868325852",
                "96055854063753201022486459249362860196",
                "147894533609443292223443214232782649401",
                "6938651765972911291272703573346798163",
                "296325869828793157680340534155263190038"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-41045-b5e3edaf",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@a6fcd19d7eac1335eb76bc16b6a66b7f574d1d69",
            "target": {
              "file": "kernel/bpf/helpers.c"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "b00628b1c7d595ae5b544e059c27b1f5828314b4"
            },
            {
              "fixed": "7aa5a19279c3639ae8b758b63f05d0c616a39fa1"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "b00628b1c7d595ae5b544e059c27b1f5828314b4"
            },
            {
              "fixed": "a6fcd19d7eac1335eb76bc16b6a66b7f574d1d69"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v5.14",
        "v5.14-rc1",
        "v5.14-rc2",
        "v5.14-rc3",
        "v5.14-rc4",
        "v5.14-rc5",
        "v5.14-rc6",
        "v5.14-rc7",
        "v5.15",
        "v5.15-rc1",
        "v5.15-rc2",
        "v5.15-rc3",
        "v5.15-rc4",
        "v5.15-rc5",
        "v5.15-rc6",
        "v5.15-rc7",
        "v5.16",
        "v5.16-rc1",
        "v5.16-rc2",
        "v5.16-rc3",
        "v5.16-rc4",
        "v5.16-rc5",
        "v5.16-rc6",
        "v5.16-rc7",
        "v5.16-rc8",
        "v5.17",
        "v5.17-rc1",
        "v5.17-rc2",
        "v5.17-rc3",
        "v5.17-rc4",
        "v5.17-rc5",
        "v5.17-rc6",
        "v5.17-rc7",
        "v5.17-rc8",
        "v5.18",
        "v5.18-rc1",
        "v5.18-rc2",
        "v5.18-rc3",
        "v5.18-rc4",
        "v5.18-rc5",
        "v5.18-rc6",
        "v5.18-rc7",
        "v5.19",
        "v5.19-rc1",
        "v5.19-rc2",
        "v5.19-rc3",
        "v5.19-rc4",
        "v5.19-rc5",
        "v5.19-rc6",
        "v5.19-rc7",
        "v5.19-rc8",
        "v6.0",
        "v6.0-rc1",
        "v6.0-rc2",
        "v6.0-rc3",
        "v6.0-rc4",
        "v6.0-rc5",
        "v6.0-rc6",
        "v6.0-rc7",
        "v6.1",
        "v6.1-rc1",
        "v6.1-rc2",
        "v6.1-rc3",
        "v6.1-rc4",
        "v6.1-rc5",
        "v6.1-rc6",
        "v6.1-rc7",
        "v6.1-rc8",
        "v6.10-rc1",
        "v6.10-rc2",
        "v6.10-rc3",
        "v6.10-rc4",
        "v6.10-rc5",
        "v6.10-rc6",
        "v6.2",
        "v6.2-rc1",
        "v6.2-rc2",
        "v6.2-rc3",
        "v6.2-rc4",
        "v6.2-rc5",
        "v6.2-rc6",
        "v6.2-rc7",
        "v6.2-rc8",
        "v6.3",
        "v6.3-rc1",
        "v6.3-rc2",
        "v6.3-rc3",
        "v6.3-rc4",
        "v6.3-rc5",
        "v6.3-rc6",
        "v6.3-rc7",
        "v6.4",
        "v6.4-rc1",
        "v6.4-rc2",
        "v6.4-rc3",
        "v6.4-rc4",
        "v6.4-rc5",
        "v6.4-rc6",
        "v6.4-rc7",
        "v6.5",
        "v6.5-rc1",
        "v6.5-rc2",
        "v6.5-rc3",
        "v6.5-rc4",
        "v6.5-rc5",
        "v6.5-rc6",
        "v6.5-rc7",
        "v6.6",
        "v6.6-rc1",
        "v6.6-rc2",
        "v6.6-rc3",
        "v6.6-rc4",
        "v6.6-rc5",
        "v6.6-rc6",
        "v6.6-rc7",
        "v6.7",
        "v6.7-rc1",
        "v6.7-rc2",
        "v6.7-rc3",
        "v6.7-rc4",
        "v6.7-rc5",
        "v6.7-rc6",
        "v6.7-rc7",
        "v6.7-rc8",
        "v6.8",
        "v6.8-rc1",
        "v6.8-rc2",
        "v6.8-rc3",
        "v6.8-rc4",
        "v6.8-rc5",
        "v6.8-rc6",
        "v6.8-rc7",
        "v6.9",
        "v6.9-rc1",
        "v6.9-rc2",
        "v6.9-rc3",
        "v6.9-rc4",
        "v6.9-rc5",
        "v6.9-rc6",
        "v6.9-rc7",
        "v6.9.1",
        "v6.9.2",
        "v6.9.3",
        "v6.9.4",
        "v6.9.5",
        "v6.9.6",
        "v6.9.7",
        "v6.9.8",
        "v6.9.9"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-41045.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "5.15.0"
            },
            {
              "fixed": "6.9.10"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nbpf: Defer work in bpf_timer_cancel_and_free\n\nCurrently, the same case as previous patch (two timer callbacks trying\nto cancel each other) can be invoked through bpf_map_update_elem as\nwell, or more precisely, freeing map elements containing timers. Since\nthis relies on hrtimer_cancel as well, it is prone to the same deadlock\nsituation as the previous patch.\n\nIt would be sufficient to use hrtimer_try_to_cancel to fix this problem,\nas the timer cannot be enqueued after async_cancel_and_free. Once\nasync_cancel_and_free has been done, the timer must be reinitialized\nbefore it can be armed again. The callback running in parallel trying to\narm the timer will fail, and freeing bpf_hrtimer without waiting is\nsufficient (given kfree_rcu), and bpf_timer_cb will return\nHRTIMER_NORESTART, preventing the timer from being rearmed again.\n\nHowever, there exists a UAF scenario where the callback arms the timer\nbefore entering this function, such that if cancellation fails (due to\ntimer callback invoking this routine, or the target timer callback\nrunning concurrently). In such a case, if the timer expiration is\nsignificantly far in the future, the RCU grace period expiration\nhappening before it will free the bpf_hrtimer state and along with it\nthe struct hrtimer, that is enqueued.\n\nHence, it is clear cancellation needs to occur after\nasync_cancel_and_free, and yet it cannot be done inline due to deadlock\nissues. We thus modify bpf_timer_cancel_and_free to defer work to the\nglobal workqueue, adding a work_struct alongside rcu_head (both used at\n_different_ points of time, so can share space).\n\nUpdate existing code comments to reflect the new state of affairs.",
  "id": "CVE-2024-41045",
  "modified": "2025-10-15T12:30:33.932521Z",
  "published": "2024-07-29T14:32:02Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/7aa5a19279c3639ae8b758b63f05d0c616a39fa1"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/a6fcd19d7eac1335eb76bc16b6a66b7f574d1d69"
    }
  ],
  "related": [
    "SUSE-SU-2024:3190-1",
    "SUSE-SU-2024:3194-1",
    "SUSE-SU-2024:3195-1",
    "SUSE-SU-2024:3209-1",
    "SUSE-SU-2024:3383-1",
    "SUSE-SU-2024:3483-1"
  ],
  "schema_version": "1.7.3",
  "summary": "bpf: Defer work in bpf_timer_cancel_and_free"
}