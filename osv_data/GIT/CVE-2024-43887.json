{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-43887.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "314594011653261632752356906169052279631",
                "114908523173234764798632416780472979524",
                "332865117410169834560602729626445730803",
                "130755006505534908948378155106236672381",
                "205772176917577369371484405623667590426",
                "329879893503405655083684459964154208774",
                "221297688019568528441767437708674856903",
                "60340116986712427602197161697197222877",
                "271177541636678225037254386057750909444",
                "8520104705753231170763522281459331706",
                "25628056869760676692445719865574898475",
                "134088648756760499068618378938955225516",
                "169546209297767197475762991874483976954",
                "160840489115060718105954257168291799233",
                "336304397243234041499883368789678550234",
                "191651786830040820272534980629127452698",
                "208304909760886684564490129977571102071",
                "129703860433581247965773504554000092496",
                "339106543375058156544783766487971468066",
                "144384075251327845099491200983351050577",
                "231889012632341761535732669779707309634",
                "200039774660259380275537474485035998648",
                "163364813737470530657860262180216712234",
                "329466660245249632928229765910072138790",
                "271645718087177537111858991200075537537"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-43887-33c02bf1",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@954d55a59b2501f4a9bd693b40ce45a1c46cb2b3",
            "target": {
              "file": "net/ipv4/tcp_ao.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "232254532568382682097113039568262028332",
              "length": 638.0
            },
            "id": "CVE-2024-43887-3c185cff",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@14ab4792ee120c022f276a7e4768f4dcb08f0cdd",
            "target": {
              "file": "net/ipv4/tcp_ao.c",
              "function": "tcp_ao_destroy_sock"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "232254532568382682097113039568262028332",
              "length": 638.0
            },
            "id": "CVE-2024-43887-6e4e1b6f",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@954d55a59b2501f4a9bd693b40ce45a1c46cb2b3",
            "target": {
              "file": "net/ipv4/tcp_ao.c",
              "function": "tcp_ao_destroy_sock"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "314594011653261632752356906169052279631",
                "114908523173234764798632416780472979524",
                "332865117410169834560602729626445730803",
                "130755006505534908948378155106236672381",
                "205772176917577369371484405623667590426",
                "329879893503405655083684459964154208774",
                "221297688019568528441767437708674856903",
                "60340116986712427602197161697197222877",
                "271177541636678225037254386057750909444",
                "8520104705753231170763522281459331706",
                "25628056869760676692445719865574898475",
                "134088648756760499068618378938955225516",
                "169546209297767197475762991874483976954",
                "160840489115060718105954257168291799233",
                "336304397243234041499883368789678550234",
                "191651786830040820272534980629127452698",
                "208304909760886684564490129977571102071",
                "129703860433581247965773504554000092496",
                "339106543375058156544783766487971468066",
                "144384075251327845099491200983351050577",
                "231889012632341761535732669779707309634",
                "200039774660259380275537474485035998648",
                "163364813737470530657860262180216712234",
                "329466660245249632928229765910072138790",
                "271645718087177537111858991200075537537"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-43887-70ad6d37",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@14ab4792ee120c022f276a7e4768f4dcb08f0cdd",
            "target": {
              "file": "net/ipv4/tcp_ao.c"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "67fa83f7c86a86913ab9cd5a13b4bebd8d2ebb43"
            },
            {
              "fixed": "954d55a59b2501f4a9bd693b40ce45a1c46cb2b3"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "67fa83f7c86a86913ab9cd5a13b4bebd8d2ebb43"
            },
            {
              "fixed": "14ab4792ee120c022f276a7e4768f4dcb08f0cdd"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v6.10",
        "v6.10-rc1",
        "v6.10-rc2",
        "v6.10-rc3",
        "v6.10-rc4",
        "v6.10-rc5",
        "v6.10-rc6",
        "v6.10-rc7",
        "v6.10.1",
        "v6.10.2",
        "v6.10.3",
        "v6.10.4",
        "v6.11-rc1",
        "v6.6",
        "v6.7",
        "v6.7-rc1",
        "v6.7-rc2",
        "v6.7-rc3",
        "v6.7-rc4",
        "v6.7-rc5",
        "v6.7-rc6",
        "v6.7-rc7",
        "v6.7-rc8",
        "v6.8",
        "v6.8-rc1",
        "v6.8-rc2",
        "v6.8-rc3",
        "v6.8-rc4",
        "v6.8-rc5",
        "v6.8-rc6",
        "v6.8-rc7",
        "v6.9",
        "v6.9-rc1",
        "v6.9-rc2",
        "v6.9-rc3",
        "v6.9-rc4",
        "v6.9-rc5",
        "v6.9-rc6",
        "v6.9-rc7"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-43887.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "6.7.0"
            },
            {
              "fixed": "6.10.5"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet/tcp: Disable TCP-AO static key after RCU grace period\n\nThe lifetime of TCP-AO static_key is the same as the last\ntcp_ao_info. On the socket destruction tcp_ao_info ceases to be\nwith RCU grace period, while tcp-ao static branch is currently deferred\ndestructed. The static key definition is\n: DEFINE_STATIC_KEY_DEFERRED_FALSE(tcp_ao_needed, HZ);\n\nwhich means that if RCU grace period is delayed by more than a second\nand tcp_ao_needed is in the process of disablement, other CPUs may\nyet see tcp_ao_info which atent dead, but soon-to-be.\nAnd that breaks the assumption of static_key_fast_inc_not_disabled().\n\nSee the comment near the definition:\n> * The caller must make sure that the static key can't get disabled while\n> * in this function. It doesn't patch jump labels, only adds a user to\n> * an already enabled static key.\n\nOriginally it was introduced in commit eb8c507296f6 (\"jump_label:\nPrevent key->enabled int overflow\"), which is needed for the atomic\ncontexts, one of which would be the creation of a full socket from a\nrequest socket. In that atomic context, it's known by the presence\nof the key (md5/ao) that the static branch is already enabled.\nSo, the ref counter for that static branch is just incremented\ninstead of holding the proper mutex.\nstatic_key_fast_inc_not_disabled() is just a helper for such usage\ncase. But it must not be used if the static branch could get disabled\nin parallel as it's not protected by jump_label_mutex and as a result,\nraces with jump_label_update() implementation details.\n\nHappened on netdev test-bot[1], so not a theoretical issue:\n\n[] jump_label: Fatal kernel bug, unexpected op at tcp_inbound_hash+0x1a7/0x870 [ffffffffa8c4e9b7] (eb 50 0f 1f 44 != 66 90 0f 1f 00)) size:2 type:1\n[] ------------[ cut here ]------------\n[] kernel BUG at arch/x86/kernel/jump_label.c:73!\n[] Oops: invalid opcode: 0000 [#1] PREEMPT SMP KASAN NOPTI\n[] CPU: 3 PID: 243 Comm: kworker/3:3 Not tainted 6.10.0-virtme #1\n[] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.3-0-ga6ed6b701f0a-prebuilt.qemu.org 04/01/2014\n[] Workqueue: events jump_label_update_timeout\n[] RIP: 0010:__jump_label_patch+0x2f6/0x350\n...\n[] Call Trace:\n[]  <TASK>\n[]  arch_jump_label_transform_queue+0x6c/0x110\n[]  __jump_label_update+0xef/0x350\n[]  __static_key_slow_dec_cpuslocked.part.0+0x3c/0x60\n[]  jump_label_update_timeout+0x2c/0x40\n[]  process_one_work+0xe3b/0x1670\n[]  worker_thread+0x587/0xce0\n[]  kthread+0x28a/0x350\n[]  ret_from_fork+0x31/0x70\n[]  ret_from_fork_asm+0x1a/0x30\n[]  </TASK>\n[] Modules linked in: veth\n[] ---[ end trace 0000000000000000 ]---\n[] RIP: 0010:__jump_label_patch+0x2f6/0x350\n\n[1]: https://netdev-3.bots.linux.dev/vmksft-tcp-ao-dbg/results/696681/5-connect-deny-ipv6/stderr",
  "id": "CVE-2024-43887",
  "modified": "2025-10-15T13:43:22.800925Z",
  "published": "2024-08-26T10:10:39Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/14ab4792ee120c022f276a7e4768f4dcb08f0cdd"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/954d55a59b2501f4a9bd693b40ce45a1c46cb2b3"
    }
  ],
  "schema_version": "1.7.3",
  "summary": "net/tcp: Disable TCP-AO static key after RCU grace period"
}