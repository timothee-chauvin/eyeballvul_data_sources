{"schema_version":"1.7.3","id":"CVE-2022-49701","published":"2025-02-26T02:24:21Z","modified":"2025-10-21T10:31:22.727503Z","related":["SUSE-SU-2025:1027-1","SUSE-SU-2025:1176-1","SUSE-SU-2025:1183-1","SUSE-SU-2025:1194-1","SUSE-SU-2025:1241-1","SUSE-SU-2025:1263-1"],"summary":"scsi: ibmvfc: Allocate/free queue resource only during probe/remove","details":"In the Linux kernel, the following vulnerability has been resolved:\n\nscsi: ibmvfc: Allocate/free queue resource only during probe/remove\n\nCurrently, the sub-queues and event pool resources are allocated/freed for\nevery CRQ connection event such as reset and LPM. This exposes the driver\nto a couple issues. First the inefficiency of freeing and reallocating\nmemory that can simply be resued after being sanitized. Further, a system\nunder memory pressue runs the risk of allocation failures that could result\nin a crippled driver. Finally, there is a race window where command\nsubmission/compeletion can try to pull/return elements from/to an event\npool that is being deleted or already has been deleted due to the lack of\nhost state around freeing/allocating resources. The following is an example\nof list corruption following a live partition migration (LPM):\n\nOops: Exception in kernel mode, sig: 5 [#1]\nLE PAGE_SIZE=64K MMU=Hash SMP NR_CPUS=2048 NUMA pSeries\nModules linked in: vfat fat isofs cdrom ext4 mbcache jbd2 nft_counter nft_compat nf_tables nfnetlink rpadlpar_io rpaphp xsk_diag nfsv3 nfs_acl nfs lockd grace fscache netfs rfkill bonding tls sunrpc pseries_rng drm drm_panel_orientation_quirks xfs libcrc32c dm_service_time sd_mod t10_pi sg ibmvfc scsi_transport_fc ibmveth vmx_crypto dm_multipath dm_mirror dm_region_hash dm_log dm_mod ipmi_devintf ipmi_msghandler fuse\nCPU: 0 PID: 2108 Comm: ibmvfc_0 Kdump: loaded Not tainted 5.14.0-70.9.1.el9_0.ppc64le #1\nNIP: c0000000007c4bb0 LR: c0000000007c4bac CTR: 00000000005b9a10\nREGS: c00000025c10b760 TRAP: 0700  Not tainted (5.14.0-70.9.1.el9_0.ppc64le)\nMSR: 800000000282b033 <SF,VEC,VSX,EE,FP,ME,IR,DR,RI,LE> CR: 2800028f XER: 0000000f\nCFAR: c0000000001f55bc IRQMASK: 0\n        GPR00: c0000000007c4bac c00000025c10ba00 c000000002a47c00 000000000000004e\n        GPR04: c0000031e3006f88 c0000031e308bd00 c00000025c10b768 0000000000000027\n        GPR08: 0000000000000000 c0000031e3009dc0 00000031e0eb0000 0000000000000000\n        GPR12: c0000031e2ffffa8 c000000002dd0000 c000000000187108 c00000020fcee2c0\n        GPR16: 0000000000000000 0000000000000000 0000000000000000 0000000000000000\n        GPR20: 0000000000000000 0000000000000000 0000000000000000 c008000002f81300\n        GPR24: 5deadbeef0000100 5deadbeef0000122 c000000263ba6910 c00000024cc88000\n        GPR28: 000000000000003c c0000002430a0000 c0000002430ac300 000000000000c300\nNIP [c0000000007c4bb0] __list_del_entry_valid+0x90/0x100\nLR [c0000000007c4bac] __list_del_entry_valid+0x8c/0x100\nCall Trace:\n[c00000025c10ba00] [c0000000007c4bac] __list_del_entry_valid+0x8c/0x100 (unreliable)\n[c00000025c10ba60] [c008000002f42284] ibmvfc_free_queue+0xec/0x210 [ibmvfc]\n[c00000025c10bb10] [c008000002f4246c] ibmvfc_deregister_scsi_channel+0xc4/0x160 [ibmvfc]\n[c00000025c10bba0] [c008000002f42580] ibmvfc_release_sub_crqs+0x78/0x130 [ibmvfc]\n[c00000025c10bc20] [c008000002f4f6cc] ibmvfc_do_work+0x5c4/0xc70 [ibmvfc]\n[c00000025c10bce0] [c008000002f4fdec] ibmvfc_work+0x74/0x1e8 [ibmvfc]\n[c00000025c10bda0] [c0000000001872b8] kthread+0x1b8/0x1c0\n[c00000025c10be10] [c00000000000cd64] ret_from_kernel_thread+0x5c/0x64\nInstruction dump:\n40820034 38600001 38210060 4e800020 7c0802a6 7c641b78 3c62fe7a 7d254b78\n3863b590 f8010070 4ba309cd 60000000 <0fe00000> 7c0802a6 3c62fe7a 3863b640\n---[ end trace 11a2b65a92f8b66c ]---\nibmvfc 30000003: Send warning. Receive queue closed, will retry.\n\nAdd registration/deregistration helpers that are called instead during\nconnection resets to sanitize and reconfigure the queues.","affected":[{"ranges":[{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"3034ebe26389740bb6b4a463e05afb51dc93c336"},{"fixed":"161ec2a0807ddd58bc0f24f3e1e7e3d4fef5297f"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"3034ebe26389740bb6b4a463e05afb51dc93c336"},{"fixed":"9f23c499ca601b2a1e1d2e761d03964b739bca0e"}]},{"type":"GIT","repo":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git","events":[{"introduced":"3034ebe26389740bb6b4a463e05afb51dc93c336"},{"fixed":"72ea7fe0db73d65c7d977208842d8ade9b823de9"}]}],"versions":["v5.11","v5.11-rc3","v5.11-rc4","v5.11-rc5","v5.11-rc6","v5.11-rc7","v5.12","v5.12-rc1","v5.12-rc1-dontuse","v5.12-rc2","v5.12-rc3","v5.12-rc4","v5.12-rc5","v5.12-rc6","v5.12-rc7","v5.12-rc8","v5.13","v5.13-rc1","v5.13-rc2","v5.13-rc3","v5.13-rc4","v5.13-rc5","v5.13-rc6","v5.13-rc7","v5.14","v5.14-rc1","v5.14-rc2","v5.14-rc3","v5.14-rc4","v5.14-rc5","v5.14-rc6","v5.14-rc7","v5.15","v5.15-rc1","v5.15-rc2","v5.15-rc3","v5.15-rc4","v5.15-rc5","v5.15-rc6","v5.15-rc7","v5.15.1","v5.15.10","v5.15.11","v5.15.12","v5.15.13","v5.15.14","v5.15.15","v5.15.16","v5.15.17","v5.15.18","v5.15.19","v5.15.2","v5.15.20","v5.15.21","v5.15.22","v5.15.23","v5.15.24","v5.15.25","v5.15.26","v5.15.27","v5.15.28","v5.15.29","v5.15.3","v5.15.30","v5.15.31","v5.15.32","v5.15.33","v5.15.34","v5.15.35","v5.15.36","v5.15.37","v5.15.38","v5.15.39","v5.15.4","v5.15.40","v5.15.41","v5.15.42","v5.15.43","v5.15.44","v5.15.45","v5.15.46","v5.15.47","v5.15.48","v5.15.49","v5.15.5","v5.15.50","v5.15.6","v5.15.7","v5.15.8","v5.15.9","v5.16","v5.16-rc1","v5.16-rc2","v5.16-rc3","v5.16-rc4","v5.16-rc5","v5.16-rc6","v5.16-rc7","v5.16-rc8","v5.17","v5.17-rc1","v5.17-rc2","v5.17-rc3","v5.17-rc4","v5.17-rc5","v5.17-rc6","v5.17-rc7","v5.17-rc8","v5.18","v5.18-rc1","v5.18-rc2","v5.18-rc3","v5.18-rc4","v5.18-rc5","v5.18-rc6","v5.18-rc7","v5.18.1","v5.18.2","v5.18.3","v5.18.4","v5.18.5","v5.18.6","v5.18.7","v5.19-rc1"],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49701.json","vanir_signatures":[{"deprecated":false,"digest":{"function_hash":"15449499434714428015873274406789846670","length":625},"id":"CVE-2022-49701-35b7859d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@161ec2a0807ddd58bc0f24f3e1e7e3d4fef5297f","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_init_sub_crqs"}},{"deprecated":false,"digest":{"function_hash":"147861542618588878431613448126550739817","length":1284},"id":"CVE-2022-49701-3a2d1a92","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@161ec2a0807ddd58bc0f24f3e1e7e3d4fef5297f","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_register_scsi_channel"}},{"deprecated":false,"digest":{"function_hash":"224149737714816178388962400264234001598","length":317},"id":"CVE-2022-49701-4822f8af","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@161ec2a0807ddd58bc0f24f3e1e7e3d4fef5297f","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_release_sub_crqs"}},{"deprecated":false,"digest":{"line_hashes":["98887820102663420576073975334283636980","70665299365886872799872249722091165731","176425860014998495144369012342353926323","318203538868060895812082492878647099018","306329582898071434223561479557607348500","315033476893746438297547037416145703915","230297859855498295114928599262770788031","123502801465549448347630887108137750775","273394651512963073667000750571194991394","179801613860196571293768296487487955473","232557616559077954221711748424937204043","60773992686525363112019750603519243972","263457636310746703689277520360409600494","161180774497516319627121842473347718105","207359071432657018269858225813340189478","88087956546830857035099360703756483865","273394651512963073667000750571194991394","50456798428985994795921140317381524132","232557616559077954221711748424937204043","60773992686525363112019750603519243972","201971800822499591224543269150532629615","32158322352306812198549048199093844337","325052827659365708003345491709200663751","241280030904459968286376844061022723166","18674098901325407108315527232721494529","241618649379336588615859732751626258737","23761670989501904631656568202021944868","293754518793317756123175978325077755163","128295467477786289740838709105340748730","151084706100504405669252785008264470730","187515533075749554420731082091915712598","172648678499664737323098986525590127575","245451259480795329204372315099580159512","237524617021442308536926560413016806482","2269884905265176452137493799784095210","40104738042884515245759997548494689308","32405278105394252094276785632036064218","108033027166055839483116845119869036403","172068194651066207161846346151726270277","223460571100721461972744253847637115075","159333805573958689845055922543045565726","229221579340986149162411741699071716649","92086520892180829403234769201676655839","241071883031682970599976686565055487078","109157185042662377573759775506660335061","268469205456470193743714217673160970063","28361744807526386227108313691078646477","154547629121876334013540290281406536977","316467541820426644871304009908310907094","161660730126976342854726712597362373933","94210022176263964719589085312403604485","192531687051156014181836409299583352754","32739560893340599744615088146254527101","222067083996387618989099656685448310769","77610586330527485987029731988323309150","319242076662025702972846627708677817992","172087679501810371400589900738665618422","125801455468782484518277867930451735418","148832367740166557239402908068939052893","186582147860941829976334476684915931430","111515743574313778799603133652406926151"],"threshold":0.9},"id":"CVE-2022-49701-5b56992b","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@9f23c499ca601b2a1e1d2e761d03964b739bca0e","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c"}},{"deprecated":false,"digest":{"line_hashes":["98887820102663420576073975334283636980","70665299365886872799872249722091165731","176425860014998495144369012342353926323","318203538868060895812082492878647099018","306329582898071434223561479557607348500","315033476893746438297547037416145703915","230297859855498295114928599262770788031","123502801465549448347630887108137750775","273394651512963073667000750571194991394","179801613860196571293768296487487955473","232557616559077954221711748424937204043","60773992686525363112019750603519243972","263457636310746703689277520360409600494","161180774497516319627121842473347718105","207359071432657018269858225813340189478","88087956546830857035099360703756483865","273394651512963073667000750571194991394","50456798428985994795921140317381524132","232557616559077954221711748424937204043","60773992686525363112019750603519243972","201971800822499591224543269150532629615","32158322352306812198549048199093844337","325052827659365708003345491709200663751","241280030904459968286376844061022723166","18674098901325407108315527232721494529","241618649379336588615859732751626258737","23761670989501904631656568202021944868","293754518793317756123175978325077755163","128295467477786289740838709105340748730","151084706100504405669252785008264470730","187515533075749554420731082091915712598","172648678499664737323098986525590127575","245451259480795329204372315099580159512","237524617021442308536926560413016806482","2269884905265176452137493799784095210","40104738042884515245759997548494689308","32405278105394252094276785632036064218","108033027166055839483116845119869036403","172068194651066207161846346151726270277","223460571100721461972744253847637115075","159333805573958689845055922543045565726","229221579340986149162411741699071716649","92086520892180829403234769201676655839","241071883031682970599976686565055487078","109157185042662377573759775506660335061","268469205456470193743714217673160970063","28361744807526386227108313691078646477","154547629121876334013540290281406536977","316467541820426644871304009908310907094","161660730126976342854726712597362373933","94210022176263964719589085312403604485","192531687051156014181836409299583352754","32739560893340599744615088146254527101","222067083996387618989099656685448310769","77610586330527485987029731988323309150","319242076662025702972846627708677817992","172087679501810371400589900738665618422","125801455468782484518277867930451735418","148832367740166557239402908068939052893","186582147860941829976334476684915931430","111515743574313778799603133652406926151"],"threshold":0.9},"id":"CVE-2022-49701-7f28c687","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@72ea7fe0db73d65c7d977208842d8ade9b823de9","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c"}},{"deprecated":false,"digest":{"function_hash":"15449499434714428015873274406789846670","length":625},"id":"CVE-2022-49701-7f6af524","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@9f23c499ca601b2a1e1d2e761d03964b739bca0e","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_init_sub_crqs"}},{"deprecated":false,"digest":{"function_hash":"127511398841127190574755923080184033981","length":517},"id":"CVE-2022-49701-8896e259","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@72ea7fe0db73d65c7d977208842d8ade9b823de9","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_deregister_scsi_channel"}},{"deprecated":false,"digest":{"function_hash":"148871805000621335431882457718271316623","length":1307},"id":"CVE-2022-49701-96d836f2","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@72ea7fe0db73d65c7d977208842d8ade9b823de9","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_register_scsi_channel"}},{"deprecated":false,"digest":{"function_hash":"224149737714816178388962400264234001598","length":317},"id":"CVE-2022-49701-9911ed23","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@72ea7fe0db73d65c7d977208842d8ade9b823de9","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_release_sub_crqs"}},{"deprecated":false,"digest":{"function_hash":"15449499434714428015873274406789846670","length":625},"id":"CVE-2022-49701-9b64e6c2","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@72ea7fe0db73d65c7d977208842d8ade9b823de9","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_init_sub_crqs"}},{"deprecated":false,"digest":{"function_hash":"127511398841127190574755923080184033981","length":517},"id":"CVE-2022-49701-b1d8751d","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@161ec2a0807ddd58bc0f24f3e1e7e3d4fef5297f","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_deregister_scsi_channel"}},{"deprecated":false,"digest":{"function_hash":"224149737714816178388962400264234001598","length":317},"id":"CVE-2022-49701-c13dc266","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@9f23c499ca601b2a1e1d2e761d03964b739bca0e","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_release_sub_crqs"}},{"deprecated":false,"digest":{"function_hash":"127511398841127190574755923080184033981","length":517},"id":"CVE-2022-49701-d449f04e","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@9f23c499ca601b2a1e1d2e761d03964b739bca0e","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_deregister_scsi_channel"}},{"deprecated":false,"digest":{"function_hash":"147861542618588878431613448126550739817","length":1284},"id":"CVE-2022-49701-e34d1411","signature_type":"Function","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@9f23c499ca601b2a1e1d2e761d03964b739bca0e","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c","function":"ibmvfc_register_scsi_channel"}},{"deprecated":false,"digest":{"line_hashes":["98887820102663420576073975334283636980","70665299365886872799872249722091165731","176425860014998495144369012342353926323","318203538868060895812082492878647099018","306329582898071434223561479557607348500","315033476893746438297547037416145703915","230297859855498295114928599262770788031","123502801465549448347630887108137750775","273394651512963073667000750571194991394","179801613860196571293768296487487955473","232557616559077954221711748424937204043","60773992686525363112019750603519243972","263457636310746703689277520360409600494","161180774497516319627121842473347718105","207359071432657018269858225813340189478","88087956546830857035099360703756483865","273394651512963073667000750571194991394","50456798428985994795921140317381524132","232557616559077954221711748424937204043","60773992686525363112019750603519243972","201971800822499591224543269150532629615","32158322352306812198549048199093844337","325052827659365708003345491709200663751","241280030904459968286376844061022723166","18674098901325407108315527232721494529","241618649379336588615859732751626258737","23761670989501904631656568202021944868","293754518793317756123175978325077755163","128295467477786289740838709105340748730","151084706100504405669252785008264470730","187515533075749554420731082091915712598","172648678499664737323098986525590127575","245451259480795329204372315099580159512","237524617021442308536926560413016806482","2269884905265176452137493799784095210","40104738042884515245759997548494689308","32405278105394252094276785632036064218","108033027166055839483116845119869036403","172068194651066207161846346151726270277","223460571100721461972744253847637115075","159333805573958689845055922543045565726","229221579340986149162411741699071716649","92086520892180829403234769201676655839","241071883031682970599976686565055487078","109157185042662377573759775506660335061","268469205456470193743714217673160970063","28361744807526386227108313691078646477","154547629121876334013540290281406536977","316467541820426644871304009908310907094","161660730126976342854726712597362373933","94210022176263964719589085312403604485","192531687051156014181836409299583352754","32739560893340599744615088146254527101","222067083996387618989099656685448310769","77610586330527485987029731988323309150","319242076662025702972846627708677817992","172087679501810371400589900738665618422","125801455468782484518277867930451735418","148832367740166557239402908068939052893","186582147860941829976334476684915931430","111515743574313778799603133652406926151"],"threshold":0.9},"id":"CVE-2022-49701-f18c3a0f","signature_type":"Line","signature_version":"v1","source":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@161ec2a0807ddd58bc0f24f3e1e7e3d4fef5297f","target":{"file":"drivers/scsi/ibmvscsi/ibmvfc.c"}}]}},{"package":{"name":"Kernel","ecosystem":"Linux"},"ranges":[{"type":"ECOSYSTEM","events":[{"introduced":"5.12.0"},{"fixed":"5.15.51"}]},{"type":"ECOSYSTEM","events":[{"introduced":"5.16.0"},{"fixed":"5.18.8"}]}],"database_specific":{"source":"https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2022-49701.json"}}],"references":[{"type":"PACKAGE","url":"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"},{"type":"WEB","url":"https://git.kernel.org/stable/c/161ec2a0807ddd58bc0f24f3e1e7e3d4fef5297f"},{"type":"WEB","url":"https://git.kernel.org/stable/c/72ea7fe0db73d65c7d977208842d8ade9b823de9"},{"type":"WEB","url":"https://git.kernel.org/stable/c/9f23c499ca601b2a1e1d2e761d03964b739bca0e"}]}