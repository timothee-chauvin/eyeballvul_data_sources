{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40002.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "23287780743401437260569550849374979587",
                "151177139887663403217202786788514076157",
                "199713451608474827041291884430833071264",
                "180689805890494304525713564196302450460",
                "131236577316033403845471261330847448714",
                "244160099926127467230818672362808278808",
                "108184455836480399753075362003840436062",
                "104605280955623747600833516201074334034",
                "33553985583800977863584971908277733661"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2025-40002-10ac3ce0",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c07923f6a8729fc27ee652221a51702ff6654097",
            "target": {
              "file": "drivers/thunderbolt/tunnel.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "23287780743401437260569550849374979587",
                "151177139887663403217202786788514076157",
                "199713451608474827041291884430833071264",
                "180689805890494304525713564196302450460",
                "131236577316033403845471261330847448714",
                "244160099926127467230818672362808278808",
                "108184455836480399753075362003840436062",
                "104605280955623747600833516201074334034",
                "33553985583800977863584971908277733661"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2025-40002-12ec2bec",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@67600ccfc4f38ebd331b9332ac94717bfbc87ea7",
            "target": {
              "file": "drivers/thunderbolt/tunnel.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "170601450720475449959691857264774770791",
              "length": 611.0
            },
            "id": "CVE-2025-40002-6eb2d185",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c07923f6a8729fc27ee652221a51702ff6654097",
            "target": {
              "file": "drivers/thunderbolt/tunnel.c",
              "function": "tb_dp_dprx_work"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "126391960975574821900239636909139015206",
              "length": 197.0
            },
            "id": "CVE-2025-40002-966cd149",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@c07923f6a8729fc27ee652221a51702ff6654097",
            "target": {
              "file": "drivers/thunderbolt/tunnel.c",
              "function": "tb_dp_dprx_stop"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "126391960975574821900239636909139015206",
              "length": 197.0
            },
            "id": "CVE-2025-40002-a743c239",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@67600ccfc4f38ebd331b9332ac94717bfbc87ea7",
            "target": {
              "file": "drivers/thunderbolt/tunnel.c",
              "function": "tb_dp_dprx_stop"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "170601450720475449959691857264774770791",
              "length": 611.0
            },
            "id": "CVE-2025-40002-aba8fa04",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@67600ccfc4f38ebd331b9332ac94717bfbc87ea7",
            "target": {
              "file": "drivers/thunderbolt/tunnel.c",
              "function": "tb_dp_dprx_work"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "d6d458d42e1e1544a18f37f1d5c840e00d5261b9"
            },
            {
              "fixed": "c07923f6a8729fc27ee652221a51702ff6654097"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "d6d458d42e1e1544a18f37f1d5c840e00d5261b9"
            },
            {
              "fixed": "67600ccfc4f38ebd331b9332ac94717bfbc87ea7"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v6.13",
        "v6.13-rc5",
        "v6.13-rc6",
        "v6.13-rc7",
        "v6.14",
        "v6.14-rc1",
        "v6.14-rc2",
        "v6.14-rc3",
        "v6.14-rc4",
        "v6.14-rc5",
        "v6.14-rc6",
        "v6.14-rc7",
        "v6.15",
        "v6.15-rc1",
        "v6.15-rc2",
        "v6.15-rc3",
        "v6.15-rc4",
        "v6.15-rc5",
        "v6.15-rc6",
        "v6.15-rc7",
        "v6.16",
        "v6.16-rc1",
        "v6.16-rc2",
        "v6.16-rc3",
        "v6.16-rc4",
        "v6.16-rc5",
        "v6.16-rc6",
        "v6.16-rc7",
        "v6.17",
        "v6.17-rc1",
        "v6.17-rc2",
        "v6.17-rc3",
        "v6.17-rc4",
        "v6.17-rc5",
        "v6.17-rc6",
        "v6.17-rc7",
        "v6.17.1",
        "v6.17.2"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2025-40002.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "6.14.0"
            },
            {
              "fixed": "6.17.3"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nthunderbolt: Fix use-after-free in tb_dp_dprx_work\n\nThe original code relies on cancel_delayed_work() in tb_dp_dprx_stop(),\nwhich does not ensure that the delayed work item tunnel->dprx_work has\nfully completed if it was already running. This leads to use-after-free\nscenarios where tb_tunnel is deallocated by tb_tunnel_put(), while\ntunnel->dprx_work remains active and attempts to dereference tb_tunnel\nin tb_dp_dprx_work().\n\nA typical race condition is illustrated below:\n\nCPU 0                            | CPU 1\ntb_dp_tunnel_active()            |\n  tb_deactivate_and_free_tunnel()| tb_dp_dprx_start()\n    tb_tunnel_deactivate()       |   queue_delayed_work()\n      tb_dp_activate()           |\n        tb_dp_dprx_stop()        | tb_dp_dprx_work() //delayed worker\n          cancel_delayed_work()  |\n    tb_tunnel_put(tunnel);       |\n                                 |   tunnel = container_of(...); //UAF\n                                 |   tunnel-> //UAF\n\nReplacing cancel_delayed_work() with cancel_delayed_work_sync() is\nnot feasible as it would introduce a deadlock: both tb_dp_dprx_work()\nand the cleanup path acquire tb->lock, and cancel_delayed_work_sync()\nwould wait indefinitely for the work item that cannot proceed.\n\nInstead, implement proper reference counting:\n- If cancel_delayed_work() returns true (work is pending), we release\n  the reference in the stop function.\n- If it returns false (work is executing or already completed), the\n  reference is released in delayed work function itself.\n\nThis ensures the tb_tunnel remains valid during work item execution\nwhile preventing memory leaks.\n\nThis bug was found by static analysis.",
  "id": "CVE-2025-40002",
  "modified": "2025-10-22T16:42:24.061660Z",
  "published": "2025-10-18T08:03:22Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/67600ccfc4f38ebd331b9332ac94717bfbc87ea7"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/c07923f6a8729fc27ee652221a51702ff6654097"
    }
  ],
  "schema_version": "1.7.3",
  "summary": "thunderbolt: Fix use-after-free in tb_dp_dprx_work"
}