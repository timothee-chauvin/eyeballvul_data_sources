{
  "affected": [
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-27080.json",
        "vanir_signatures": [
          {
            "deprecated": false,
            "digest": {
              "function_hash": "268930044178115165101745301817519853450",
              "length": 1108.0
            },
            "id": "CVE-2024-27080-02f83f55",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@49d640d2946c35a17b051d54171a032dd95b0f50",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "emit_fiemap_extent"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "65791129411113109027237825494096325690",
              "length": 3660.0
            },
            "id": "CVE-2024-27080-205360b6",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ced63fffd63072c0ca55d5a451010d71bf08c0b3",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "extent_fiemap"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "177747826773794846506996399880698207168",
                "19470618092315029725582680321291530250",
                "113240885032868909614286439325356252411",
                "232908816888252348587558534365203282497",
                "38941388281364950164042015882555586974",
                "110008944086562867847968935352711678547",
                "177343425306399398512407034252154563140",
                "34923946395257046659329559808439339247",
                "215081061456782630972852435089659351275",
                "18459273156101070885185122849184860574",
                "115688388157276826282349321345723062840",
                "1021707666998278915916569401217249899",
                "184703857841684661494878518834599450093",
                "90338217603620586760305595784812659751",
                "305007558946791648434534960409447667257",
                "63267147629507493854764203087780434721",
                "91318427500185525062692627431656954589",
                "91493475786335632416583408697608176601",
                "272328103854599040984157470015121286988",
                "214815079567468559879679832028557909950",
                "230989949858860834376195718630002861561",
                "1814040148107543767230220621203462312",
                "234352615874856266283489926383557762509",
                "202395315413693400182873879655151327391",
                "126346312064373541093154724419094445759",
                "93590757973420108801810963428490006997",
                "230539760117709743735637864865213863161",
                "225557822235074797033313103425700463008",
                "190048387159605676871205361671536984758",
                "186431688056769400371540476653753482394",
                "334789071839831922012455391366943536934",
                "26894103946806592341770703265500013865",
                "194857724172718747523786168409267343684",
                "268194159898975247547674660974358478727",
                "242561127785269001166693342035910212880",
                "156779390919533343291244732620314957834",
                "74831938508779187263647363998422895003",
                "134704032570311423007601887092054931231",
                "161973529940986930799088847035264965859",
                "311887381077101013700804992194004060607",
                "165472340420448704607057270615475666574",
                "71419502785103307588297845811782383840",
                "257856330634998798545346629659201683336",
                "107318682099494180154845664422681102242",
                "119044089965918470592008300032550186379",
                "147638791145036105890054140500198612902",
                "179373172299700693216831764252931515166",
                "242288299658810654149765299439930040496",
                "40291557606353215983477170720148329447",
                "323560932313032620070620039711804498238",
                "203597367582648988601930983508827370894",
                "278000372179856546699697976544873869126",
                "214481081281752227484397399950671833966",
                "119432748297164155691688126172830506129",
                "276173153629207773854383903110189711581",
                "270535536907692620211927385995199079164",
                "41885572628140139902256523667586939181",
                "267969811308532300796581352728626687552",
                "197719623860764796501834773138578653460",
                "210485137032289455296037363258705267588",
                "156761961718849971081665569182641978862",
                "236065861631258176502680317507011562005",
                "10557326650389011044865805588488422360",
                "127917659350848125667579040474988327426",
                "338857921527979202990358820785793518896",
                "273840279373646775410894689276063792821",
                "129681419667984573193399495253437165206",
                "222726703577644485048658941990619877955",
                "124239182769737566728306733760899903443",
                "234515138214773789197717649238457757535",
                "58576341778186516605055312046743066512",
                "214632784022424343064047670361749417136",
                "49629414735191645320896226466613872592",
                "73696533886299735150634944172312981221",
                "166763957657389067938100113683335238763",
                "181585891956325853590491726599507585086",
                "274379413081362137430920424740341858902",
                "161257142503329131123929764494480475636",
                "258085507886979857359473193225074991813",
                "273179457048192233514809920655019233720",
                "49629414735191645320896226466613872592",
                "73696533886299735150634944172312981221",
                "117304799077971866758053987929925871451",
                "43296361082980057141069821107895705858",
                "4699296829292778952764057587519412068",
                "5080696618933524508261225007756355692",
                "70474866176802507905304484511110002155",
                "217581423038832095360325314282132397192",
                "101311852006650985953517187478665341354",
                "275944593548028075010481655546358085983",
                "324832492745027697028262998014729681939",
                "166890829364956723447416662393805076865",
                "328793017808847471574901113811656831183",
                "134445712141133632810800898407351037213",
                "158657844975759436335411632801120071113",
                "221965795486962688652391623812631893644",
                "266761768126987655337540541700741226041",
                "206485732796417847462285353420853502186",
                "329886442720110577652767987013445147201",
                "122190090791258275317016469678723226833",
                "14320357333699848647975406990492229439",
                "85989847781535375708434368366390057803",
                "50684965120132740346359774940636215437",
                "239939718114268405455007459139727581814",
                "146227648596541594798154376611677038090",
                "53561583391515769243441115390539779494",
                "120307225468790396367207948516417987608",
                "206542976023500412164234399043545372317",
                "135216777353577617502782454930615379890",
                "252732371475628807833070051149633160871",
                "155657379276212930310671355949406658046",
                "236102670894231254936184697435022754910",
                "289774694734898663863303357523393046810",
                "259832981333027617774428315296174118285",
                "199460167557207036614312017509237903877",
                "68690249838141248364548890907087821477",
                "135152286490362895872935743265880820810",
                "32816142055422993306087444986358006402",
                "107318682099494180154845664422681102242",
                "225229710622100200370931737622015113297",
                "238122964875001825516555909238660684034",
                "24597412360966158018496614470178640706",
                "254216596438929711425817887321933245320",
                "58204832147317705458400068768440534348",
                "296861081057319647777275823777027652502",
                "155564113417268642205354266081642759019",
                "214347360471069414927398184347136626827"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-27080-24adab87",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@49d640d2946c35a17b051d54171a032dd95b0f50",
            "target": {
              "file": "fs/btrfs/extent_io.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "199336154234139949944460526718854854771",
              "length": 1892.0
            },
            "id": "CVE-2024-27080-285a33bc",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ced63fffd63072c0ca55d5a451010d71bf08c0b3",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "fiemap_process_hole"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "268930044178115165101745301817519853450",
              "length": 1108.0
            },
            "id": "CVE-2024-27080-2ef06ef4",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@978b63f7464abcfd364a6c95f734282c50f3decf",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "emit_fiemap_extent"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "65791129411113109027237825494096325690",
              "length": 3660.0
            },
            "id": "CVE-2024-27080-3c25b758",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@978b63f7464abcfd364a6c95f734282c50f3decf",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "extent_fiemap"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "65791129411113109027237825494096325690",
              "length": 3660.0
            },
            "id": "CVE-2024-27080-4a238f8f",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@49d640d2946c35a17b051d54171a032dd95b0f50",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "extent_fiemap"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "199336154234139949944460526718854854771",
              "length": 1892.0
            },
            "id": "CVE-2024-27080-576938b9",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@978b63f7464abcfd364a6c95f734282c50f3decf",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "fiemap_process_hole"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "177747826773794846506996399880698207168",
                "19470618092315029725582680321291530250",
                "113240885032868909614286439325356252411",
                "232908816888252348587558534365203282497",
                "38941388281364950164042015882555586974",
                "110008944086562867847968935352711678547",
                "177343425306399398512407034252154563140",
                "34923946395257046659329559808439339247",
                "215081061456782630972852435089659351275",
                "18459273156101070885185122849184860574",
                "115688388157276826282349321345723062840",
                "1021707666998278915916569401217249899",
                "184703857841684661494878518834599450093",
                "90338217603620586760305595784812659751",
                "305007558946791648434534960409447667257",
                "63267147629507493854764203087780434721",
                "91318427500185525062692627431656954589",
                "91493475786335632416583408697608176601",
                "272328103854599040984157470015121286988",
                "214815079567468559879679832028557909950",
                "230989949858860834376195718630002861561",
                "1814040148107543767230220621203462312",
                "234352615874856266283489926383557762509",
                "202395315413693400182873879655151327391",
                "126346312064373541093154724419094445759",
                "93590757973420108801810963428490006997",
                "230539760117709743735637864865213863161",
                "225557822235074797033313103425700463008",
                "190048387159605676871205361671536984758",
                "186431688056769400371540476653753482394",
                "334789071839831922012455391366943536934",
                "26894103946806592341770703265500013865",
                "194857724172718747523786168409267343684",
                "268194159898975247547674660974358478727",
                "242561127785269001166693342035910212880",
                "156779390919533343291244732620314957834",
                "74831938508779187263647363998422895003",
                "134704032570311423007601887092054931231",
                "161973529940986930799088847035264965859",
                "311887381077101013700804992194004060607",
                "165472340420448704607057270615475666574",
                "71419502785103307588297845811782383840",
                "257856330634998798545346629659201683336",
                "107318682099494180154845664422681102242",
                "119044089965918470592008300032550186379",
                "147638791145036105890054140500198612902",
                "179373172299700693216831764252931515166",
                "242288299658810654149765299439930040496",
                "40291557606353215983477170720148329447",
                "323560932313032620070620039711804498238",
                "203597367582648988601930983508827370894",
                "278000372179856546699697976544873869126",
                "214481081281752227484397399950671833966",
                "119432748297164155691688126172830506129",
                "276173153629207773854383903110189711581",
                "270535536907692620211927385995199079164",
                "41885572628140139902256523667586939181",
                "267969811308532300796581352728626687552",
                "197719623860764796501834773138578653460",
                "210485137032289455296037363258705267588",
                "156761961718849971081665569182641978862",
                "236065861631258176502680317507011562005",
                "10557326650389011044865805588488422360",
                "127917659350848125667579040474988327426",
                "338857921527979202990358820785793518896",
                "273840279373646775410894689276063792821",
                "129681419667984573193399495253437165206",
                "222726703577644485048658941990619877955",
                "124239182769737566728306733760899903443",
                "234515138214773789197717649238457757535",
                "58576341778186516605055312046743066512",
                "214632784022424343064047670361749417136",
                "49629414735191645320896226466613872592",
                "73696533886299735150634944172312981221",
                "166763957657389067938100113683335238763",
                "181585891956325853590491726599507585086",
                "274379413081362137430920424740341858902",
                "161257142503329131123929764494480475636",
                "258085507886979857359473193225074991813",
                "273179457048192233514809920655019233720",
                "49629414735191645320896226466613872592",
                "73696533886299735150634944172312981221",
                "117304799077971866758053987929925871451",
                "43296361082980057141069821107895705858",
                "4699296829292778952764057587519412068",
                "5080696618933524508261225007756355692",
                "70474866176802507905304484511110002155",
                "217581423038832095360325314282132397192",
                "101311852006650985953517187478665341354",
                "275944593548028075010481655546358085983",
                "324832492745027697028262998014729681939",
                "166890829364956723447416662393805076865",
                "328793017808847471574901113811656831183",
                "134445712141133632810800898407351037213",
                "158657844975759436335411632801120071113",
                "221965795486962688652391623812631893644",
                "266761768126987655337540541700741226041",
                "206485732796417847462285353420853502186",
                "329886442720110577652767987013445147201",
                "122190090791258275317016469678723226833",
                "14320357333699848647975406990492229439",
                "85989847781535375708434368366390057803",
                "50684965120132740346359774940636215437",
                "239939718114268405455007459139727581814",
                "146227648596541594798154376611677038090",
                "53561583391515769243441115390539779494",
                "120307225468790396367207948516417987608",
                "206542976023500412164234399043545372317",
                "135216777353577617502782454930615379890",
                "252732371475628807833070051149633160871",
                "155657379276212930310671355949406658046",
                "236102670894231254936184697435022754910",
                "289774694734898663863303357523393046810",
                "259832981333027617774428315296174118285",
                "199460167557207036614312017509237903877",
                "68690249838141248364548890907087821477",
                "135152286490362895872935743265880820810",
                "32816142055422993306087444986358006402",
                "107318682099494180154845664422681102242",
                "225229710622100200370931737622015113297",
                "238122964875001825516555909238660684034",
                "24597412360966158018496614470178640706",
                "254216596438929711425817887321933245320",
                "58204832147317705458400068768440534348",
                "296861081057319647777275823777027652502",
                "155564113417268642205354266081642759019",
                "214347360471069414927398184347136626827"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-27080-84b3a6ba",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ced63fffd63072c0ca55d5a451010d71bf08c0b3",
            "target": {
              "file": "fs/btrfs/extent_io.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "199336154234139949944460526718854854771",
              "length": 1892.0
            },
            "id": "CVE-2024-27080-b92aab82",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@49d640d2946c35a17b051d54171a032dd95b0f50",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "fiemap_process_hole"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "line_hashes": [
                "177747826773794846506996399880698207168",
                "19470618092315029725582680321291530250",
                "113240885032868909614286439325356252411",
                "232908816888252348587558534365203282497",
                "38941388281364950164042015882555586974",
                "110008944086562867847968935352711678547",
                "177343425306399398512407034252154563140",
                "34923946395257046659329559808439339247",
                "215081061456782630972852435089659351275",
                "18459273156101070885185122849184860574",
                "115688388157276826282349321345723062840",
                "1021707666998278915916569401217249899",
                "184703857841684661494878518834599450093",
                "90338217603620586760305595784812659751",
                "305007558946791648434534960409447667257",
                "63267147629507493854764203087780434721",
                "91318427500185525062692627431656954589",
                "91493475786335632416583408697608176601",
                "272328103854599040984157470015121286988",
                "214815079567468559879679832028557909950",
                "230989949858860834376195718630002861561",
                "1814040148107543767230220621203462312",
                "234352615874856266283489926383557762509",
                "202395315413693400182873879655151327391",
                "126346312064373541093154724419094445759",
                "93590757973420108801810963428490006997",
                "230539760117709743735637864865213863161",
                "225557822235074797033313103425700463008",
                "190048387159605676871205361671536984758",
                "186431688056769400371540476653753482394",
                "334789071839831922012455391366943536934",
                "26894103946806592341770703265500013865",
                "194857724172718747523786168409267343684",
                "268194159898975247547674660974358478727",
                "242561127785269001166693342035910212880",
                "156779390919533343291244732620314957834",
                "74831938508779187263647363998422895003",
                "134704032570311423007601887092054931231",
                "161973529940986930799088847035264965859",
                "311887381077101013700804992194004060607",
                "165472340420448704607057270615475666574",
                "71419502785103307588297845811782383840",
                "257856330634998798545346629659201683336",
                "107318682099494180154845664422681102242",
                "119044089965918470592008300032550186379",
                "147638791145036105890054140500198612902",
                "179373172299700693216831764252931515166",
                "242288299658810654149765299439930040496",
                "40291557606353215983477170720148329447",
                "323560932313032620070620039711804498238",
                "203597367582648988601930983508827370894",
                "278000372179856546699697976544873869126",
                "214481081281752227484397399950671833966",
                "119432748297164155691688126172830506129",
                "276173153629207773854383903110189711581",
                "270535536907692620211927385995199079164",
                "41885572628140139902256523667586939181",
                "267969811308532300796581352728626687552",
                "197719623860764796501834773138578653460",
                "210485137032289455296037363258705267588",
                "156761961718849971081665569182641978862",
                "236065861631258176502680317507011562005",
                "10557326650389011044865805588488422360",
                "127917659350848125667579040474988327426",
                "338857921527979202990358820785793518896",
                "273840279373646775410894689276063792821",
                "129681419667984573193399495253437165206",
                "222726703577644485048658941990619877955",
                "124239182769737566728306733760899903443",
                "234515138214773789197717649238457757535",
                "58576341778186516605055312046743066512",
                "214632784022424343064047670361749417136",
                "49629414735191645320896226466613872592",
                "73696533886299735150634944172312981221",
                "166763957657389067938100113683335238763",
                "181585891956325853590491726599507585086",
                "274379413081362137430920424740341858902",
                "161257142503329131123929764494480475636",
                "258085507886979857359473193225074991813",
                "273179457048192233514809920655019233720",
                "49629414735191645320896226466613872592",
                "73696533886299735150634944172312981221",
                "117304799077971866758053987929925871451",
                "43296361082980057141069821107895705858",
                "4699296829292778952764057587519412068",
                "5080696618933524508261225007756355692",
                "70474866176802507905304484511110002155",
                "217581423038832095360325314282132397192",
                "101311852006650985953517187478665341354",
                "275944593548028075010481655546358085983",
                "324832492745027697028262998014729681939",
                "166890829364956723447416662393805076865",
                "328793017808847471574901113811656831183",
                "134445712141133632810800898407351037213",
                "158657844975759436335411632801120071113",
                "221965795486962688652391623812631893644",
                "266761768126987655337540541700741226041",
                "206485732796417847462285353420853502186",
                "329886442720110577652767987013445147201",
                "122190090791258275317016469678723226833",
                "14320357333699848647975406990492229439",
                "85989847781535375708434368366390057803",
                "50684965120132740346359774940636215437",
                "239939718114268405455007459139727581814",
                "146227648596541594798154376611677038090",
                "53561583391515769243441115390539779494",
                "120307225468790396367207948516417987608",
                "206542976023500412164234399043545372317",
                "135216777353577617502782454930615379890",
                "252732371475628807833070051149633160871",
                "155657379276212930310671355949406658046",
                "236102670894231254936184697435022754910",
                "289774694734898663863303357523393046810",
                "259832981333027617774428315296174118285",
                "199460167557207036614312017509237903877",
                "68690249838141248364548890907087821477",
                "135152286490362895872935743265880820810",
                "32816142055422993306087444986358006402",
                "107318682099494180154845664422681102242",
                "225229710622100200370931737622015113297",
                "238122964875001825516555909238660684034",
                "24597412360966158018496614470178640706",
                "254216596438929711425817887321933245320",
                "58204832147317705458400068768440534348",
                "296861081057319647777275823777027652502",
                "155564113417268642205354266081642759019",
                "214347360471069414927398184347136626827"
              ],
              "threshold": 0.9
            },
            "id": "CVE-2024-27080-d923fabe",
            "signature_type": "Line",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@978b63f7464abcfd364a6c95f734282c50f3decf",
            "target": {
              "file": "fs/btrfs/extent_io.c"
            }
          },
          {
            "deprecated": false,
            "digest": {
              "function_hash": "268930044178115165101745301817519853450",
              "length": 1108.0
            },
            "id": "CVE-2024-27080-e8039a19",
            "signature_type": "Function",
            "signature_version": "v1",
            "source": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git@ced63fffd63072c0ca55d5a451010d71bf08c0b3",
            "target": {
              "file": "fs/btrfs/extent_io.c",
              "function": "emit_fiemap_extent"
            }
          }
        ]
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "ded566b4637f1b6b4c9ba74e7d0b8493e93f19cf"
            },
            {
              "fixed": "49d640d2946c35a17b051d54171a032dd95b0f50"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "b0ad381fa7690244802aed119b478b4bdafc31dd"
            },
            {
              "fixed": "ced63fffd63072c0ca55d5a451010d71bf08c0b3"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "b0ad381fa7690244802aed119b478b4bdafc31dd"
            },
            {
              "fixed": "978b63f7464abcfd364a6c95f734282c50f3decf"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        },
        {
          "events": [
            {
              "introduced": "89bca7fe6382d61e88c67a0b0e7bce315986fb8b"
            }
          ],
          "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
          "type": "GIT"
        }
      ],
      "versions": [
        "v6.6.24",
        "v6.6.25",
        "v6.7",
        "v6.7-rc6",
        "v6.7-rc7",
        "v6.7-rc8",
        "v6.7.12",
        "v6.8",
        "v6.8-rc1",
        "v6.8-rc2",
        "v6.8-rc3",
        "v6.8-rc4",
        "v6.8-rc5",
        "v6.8-rc6",
        "v6.8-rc7",
        "v6.8.1"
      ]
    },
    {
      "database_specific": {
        "source": "https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-27080.json"
      },
      "package": {
        "ecosystem": "Linux",
        "name": "Kernel"
      },
      "ranges": [
        {
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "6.6.26"
            }
          ],
          "type": "ECOSYSTEM"
        },
        {
          "events": [
            {
              "introduced": "6.7.0"
            },
            {
              "fixed": "6.8.2"
            }
          ],
          "type": "ECOSYSTEM"
        }
      ],
      "versions": []
    }
  ],
  "details": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: fix race when detecting delalloc ranges during fiemap\n\nFor fiemap we recently stopped locking the target extent range for the\nwhole duration of the fiemap call, in order to avoid a deadlock in a\nscenario where the fiemap buffer happens to be a memory mapped range of\nthe same file. This use case is very unlikely to be useful in practice but\nit may be triggered by fuzz testing (syzbot, etc).\n\nThis however introduced a race that makes us miss delalloc ranges for\nfile regions that are currently holes, so the caller of fiemap will not\nbe aware that there's data for some file regions. This can be quite\nserious for some use cases - for example in coreutils versions before 9.0,\nthe cp program used fiemap to detect holes and data in the source file,\ncopying only regions with data (extents or delalloc) from the source file\nto the destination file in order to preserve holes (see the documentation\nfor its --sparse command line option). This means that if cp was used\nwith a source file that had delalloc in a hole, the destination file could\nend up without that data, which is effectively a data loss issue, if it\nhappened to hit the race described below.\n\nThe race happens like this:\n\n1) Fiemap is called, without the FIEMAP_FLAG_SYNC flag, for a file that\n   has delalloc in the file range [64M, 65M[, which is currently a hole;\n\n2) Fiemap locks the inode in shared mode, then starts iterating the\n   inode's subvolume tree searching for file extent items, without having\n   the whole fiemap target range locked in the inode's io tree - the\n   change introduced recently by commit b0ad381fa769 (\"btrfs: fix\n   deadlock with fiemap and extent locking\"). It only locks ranges in\n   the io tree when it finds a hole or prealloc extent since that\n   commit;\n\n3) Note that fiemap clones each leaf before using it, and this is to\n   avoid deadlocks when locking a file range in the inode's io tree and\n   the fiemap buffer is memory mapped to some file, because writing\n   to the page with btrfs_page_mkwrite() will wait on any ordered extent\n   for the page's range and the ordered extent needs to lock the range\n   and may need to modify the same leaf, therefore leading to a deadlock\n   on the leaf;\n\n4) While iterating the file extent items in the cloned leaf before\n   finding the hole in the range [64M, 65M[, the delalloc in that range\n   is flushed and its ordered extent completes - meaning the corresponding\n   file extent item is in the inode's subvolume tree, but not present in\n   the cloned leaf that fiemap is iterating over;\n\n5) When fiemap finds the hole in the [64M, 65M[ range by seeing the gap in\n   the cloned leaf (or a file extent item with disk_bytenr == 0 in case\n   the NO_HOLES feature is not enabled), it will lock that file range in\n   the inode's io tree and then search for delalloc by checking for the\n   EXTENT_DELALLOC bit in the io tree for that range and ordered extents\n   (with btrfs_find_delalloc_in_range()). But it finds nothing since the\n   delalloc in that range was already flushed and the ordered extent\n   completed and is gone - as a result fiemap will not report that there's\n   delalloc or an extent for the range [64M, 65M[, so user space will be\n   mislead into thinking that there's a hole in that range.\n\nThis could actually be sporadically triggered with test case generic/094\nfrom fstests, which reports a missing extent/delalloc range like this:\n\n  generic/094 2s ... - output mismatch (see /home/fdmanana/git/hub/xfstests/results//generic/094.out.bad)\n      --- tests/generic/094.out\t2020-06-10 19:29:03.830519425 +0100\n      +++ /home/fdmanana/git/hub/xfstests/results//generic/094.out.bad\t2024-02-28 11:00:00.381071525 +0000\n      @@ -1,3 +1,9 @@\n       QA output created by 094\n       fiemap run with sync\n       fiemap run without sync\n      +ERROR: couldn't find extent at 7\n      +map is 'HHDDHPPDPHPH'\n      +logical: [       5..       6] phys:\n---truncated---",
  "id": "CVE-2024-27080",
  "modified": "2025-10-15T09:45:53.221960Z",
  "published": "2024-05-01T13:05:02Z",
  "references": [
    {
      "type": "PACKAGE",
      "url": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/49d640d2946c35a17b051d54171a032dd95b0f50"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/978b63f7464abcfd364a6c95f734282c50f3decf"
    },
    {
      "type": "WEB",
      "url": "https://git.kernel.org/stable/c/ced63fffd63072c0ca55d5a451010d71bf08c0b3"
    }
  ],
  "related": [
    "SUSE-SU-2024:2135-1",
    "SUSE-SU-2024:2203-1",
    "SUSE-SU-2024:2973-1"
  ],
  "schema_version": "1.7.3",
  "summary": "btrfs: fix race when detecting delalloc ranges during fiemap"
}